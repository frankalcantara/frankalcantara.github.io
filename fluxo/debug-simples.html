<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Simples</title>
    
    <!-- CodeMirror 5.x -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #container { border: 1px solid #ccc; height: 300px; margin: 20px 0; }
        button { margin: 10px; padding: 10px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Debug Simples - CodeMirror</h1>
    
    <div id="logs" class="log">Logs aparecerÃ£o aqui...</div>
    
    <select id="example-select">
        <option value="">Selecione um exemplo</option>
        <option value="basico">BÃ¡sico</option>
        <option value="decisao">DecisÃ£o</option>
    </select>
    
    <button onclick="testInit()">1. Testar InicializaÃ§Ã£o</button>
    <button onclick="testSetValue()">2. Testar setValue</button>
    <button onclick="testExample()">3. Testar Exemplo</button>
    
    <div id="container"></div>
    
    <script src="codemirror-simple.js"></script>
    <script>
        let editorInstance = null;
        let logs = document.getElementById('logs');
        
        function log(msg) {
            console.log(msg);
            logs.innerHTML += msg + '<br>';
        }
        
        const examples = {
            basico: {
                nome: "BÃ¡sico",
                codigo: `flowchart TD
    A[InÃ­cio] --> B[Processo]
    B --> C[Fim]`
            },
            decisao: {
                nome: "DecisÃ£o",
                codigo: `flowchart TD
    A[InÃ­cio] --> B{DecisÃ£o}
    B -->|Sim| C[Sim]
    B -->|NÃ£o| D[NÃ£o]`
            }
        };
        
        async function testInit() {
            log('ðŸ”§ Testando inicializaÃ§Ã£o...');
            
            try {
                if (!window.simpleMermaidEditor) {
                    log('âŒ SimpleMermaidEditor nÃ£o encontrado');
                    return;
                }
                
                log('âœ… SimpleMermaidEditor encontrado');
                
                const success = await window.simpleMermaidEditor.initialize('container');
                log('ðŸ” Resultado initialize: ' + success);
                
                if (success) {
                    editorInstance = window.simpleMermaidEditor;
                    log('âœ… Editor inicializado com sucesso');
                    log('ðŸ” setValue exists: ' + (typeof editorInstance.setValue));
                    log('ðŸ” getValue exists: ' + (typeof editorInstance.getValue));
                } else {
                    log('âŒ Falha na inicializaÃ§Ã£o');
                }
                
            } catch (error) {
                log('âŒ Erro: ' + error.message);
            }
        }
        
        function testSetValue() {
            if (!editorInstance) {
                log('âŒ Editor nÃ£o inicializado');
                return;
            }
            
            try {
                const testCode = 'flowchart TD\n    A[Teste] --> B[OK]';
                editorInstance.setValue(testCode);
                log('âœ… setValue executado');
                
                const value = editorInstance.getValue();
                log('ðŸ” getValue retornou: ' + value.length + ' caracteres');
                
            } catch (error) {
                log('âŒ Erro setValue: ' + error.message);
            }
        }
        
        function testExample() {
            const select = document.getElementById('example-select');
            const key = select.value;
            
            if (!key) {
                log('âš ï¸ Nenhum exemplo selecionado');
                return;
            }
            
            if (!editorInstance) {
                log('âŒ Editor nÃ£o inicializado');
                return;
            }
            
            const example = examples[key];
            log('ðŸ“‹ Carregando: ' + example.nome);
            
            try {
                editorInstance.setValue(example.codigo);
                log('âœ… Exemplo carregado com sucesso');
            } catch (error) {
                log('âŒ Erro ao carregar exemplo: ' + error.message);
            }
        }
        
        // Auto-teste
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ðŸš€ PÃ¡gina carregada, testando...');
                testInit();
            }, 500);
        });
        
        // Event listener no select
        document.getElementById('example-select').addEventListener('change', function() {
            log('ðŸ”§ Select mudou para: ' + this.value);
            if (this.value) {
                testExample();
            }
        });
    </script>
</body>
</html>