<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Diagn√≥stico - Fluxograma Interativo</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f0f0f0; 
            line-height: 1.6;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            background: #fafafa; 
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .logs { 
            background: #000; 
            color: #0f0; 
            padding: 15px; 
            height: 200px; 
            overflow-y: auto; 
            font-family: monospace; 
            font-size: 12px; 
            margin: 10px 0;
            border-radius: 5px;
        }
        .example-selector { 
            padding: 15px; 
            background: #f8fafc; 
            border: 1px solid #e2e8f0; 
            border-radius: 5px; 
            margin: 10px 0; 
        }
        .example-selector h3 { 
            margin: 0 0 10px 0; 
            color: #4f46e5; 
            font-weight: 600; 
        }
        select { 
            width: 100%; 
            padding: 10px; 
            border: 2px solid #e2e8f0; 
            border-radius: 6px; 
            font-size: 0.9rem; 
            margin: 5px 0;
        }
        button { 
            padding: 10px 20px; 
            background: #10b981; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
            font-size: 0.9rem;
        }
        button:hover { background: #059669; }
        button:disabled { opacity: 0.5; cursor: not-allowed; background: #9ca3af; }
        textarea { 
            width: 100%; 
            height: 150px; 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 5px; 
            margin: 10px 0; 
            font-family: monospace; 
            font-size: 0.9rem;
            resize: vertical;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            .test-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Diagn√≥stico - Fluxograma Interativo</h1>
        <p><strong>Objetivo:</strong> Identificar por que a caixa de sele√ß√£o n√£o est√° carregando os exemplos no editor.</p>
        
        <div class="test-section">
            <h2>üìã 1. Teste da Interface do Seletor</h2>
            <div class="example-selector">
                <h3>Exemplos Predefinidos</h3>
                <select id="example-selector">
                    <option value="">Selecione um exemplo para carregar automaticamente...</option>
                    <option value="basico">1. B√°sico - Sequ√™ncia Simples</option>
                    <option value="decisao">2. Intermedi√°rio - Com Decis√£o</option>
                    <option value="calculadora">3. Avan√ßado - Calculadora</option>
                </select>
                <button id="manual-load">Carregar Manualmente</button>
                <button onclick="testAutoLoad()">Testar Carregamento Autom√°tico</button>
            </div>
            <div id="selector-status" class="status info">Aguardando teste...</div>
        </div>

        <div class="test-grid">
            <div class="test-section">
                <h2>üìù 2. Editor de C√≥digo</h2>
                <textarea id="mermaid-editor" placeholder="O c√≥digo do exemplo aparecer√° aqui quando carregado..."></textarea>
                <div id="editor-status" class="status info">Aguardando carregamento de exemplo...</div>
            </div>
            
            <div class="test-section">
                <h2>‚öôÔ∏è 3. Status dos Componentes</h2>
                <div id="component-status"></div>
                <button onclick="checkComponents()">Verificar Componentes</button>
                <button onclick="testMermaid()">Testar Mermaid</button>
                <button onclick="loadExampleDirect('decisao')">For√ßar Carregamento</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üîç 4. Logs de Debug</h2>
            <div id="debug-logs" class="logs"></div>
            <button onclick="clearLogs()">Limpar Logs</button>
            <button onclick="runFullDiagnostic()">Diagn√≥stico Completo</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        // Exemplos para teste
        const examples = {
            basico: {
                nome: "B√°sico - Sequ√™ncia Simples",
                codigo: `flowchart TD
    A[In√≠cio] --> B[Ler nome]
    B --> C[Mostrar sauda√ß√£o]
    C --> D[Fim]`
            },
            decisao: {
                nome: "Intermedi√°rio - Com Decis√£o",
                codigo: `flowchart TD
    A[In√≠cio] --> B[Ler idade]
    B --> C{Maior que 18?}
    C -->|Sim| D[Pode votar]
    C -->|N√£o| E[N√£o pode votar]
    D --> F[Fim]
    E --> F`
            },
            calculadora: {
                nome: "Avan√ßado - Calculadora",
                codigo: `flowchart TD
    A[In√≠cio] --> B[Ler primeiro n√∫mero]
    B --> C[Ler segundo n√∫mero]
    C --> D[Ler opera√ß√£o]
    D --> E{Opera√ß√£o √© +?}
    E -->|Sim| F[Somar n√∫meros]
    E -->|N√£o| G{Opera√ß√£o √© -?}
    G -->|Sim| H[Subtrair n√∫meros]
    G -->|N√£o| I[Opera√ß√£o inv√°lida]
    F --> J[Mostrar resultado]
    H --> J
    I --> J
    J --> K[Fim]`
            }
        };
        
        // Elementos DOM
        let exampleSelector, editor, manualLoadBtn;
        
        function debugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            
            const logsContainer = document.getElementById('debug-logs');
            const color = type === 'error' ? '#f00' : 
                         type === 'success' ? '#0f0' : 
                         type === 'warning' ? '#ff0' : '#0f0';
            logsContainer.innerHTML += `<div style="color: ${color};">${logEntry}</div>`;
            logsContainer.scrollTop = logsContainer.scrollHeight;
            
            console.log(logEntry);
        }
        
        function updateStatus(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = `status ${type}`;
            }
        }
        
        function clearLogs() {
            document.getElementById('debug-logs').innerHTML = '';
            debugLog('=== LOGS LIMPOS ===', 'info');
        }
        
        function loadExampleDirect(exampleKey) {
            debugLog(`Carregamento direto: ${exampleKey}`, 'info');
            
            const example = examples[exampleKey];
            if (!example) {
                debugLog(`Exemplo '${exampleKey}' n√£o encontrado`, 'error');
                updateStatus('editor-status', `Erro: Exemplo '${exampleKey}' n√£o encontrado`, 'error');
                return false;
            }
            
            if (!editor) {
                debugLog('Editor n√£o dispon√≠vel', 'error');
                updateStatus('editor-status', 'Erro: Editor n√£o dispon√≠vel', 'error');
                return false;
            }
            
            // Carregar c√≥digo no editor
            editor.value = example.codigo;
            debugLog(`C√≥digo carregado: ${example.codigo.length} caracteres`, 'success');
            updateStatus('editor-status', `‚úÖ Carregado: ${example.nome}`, 'success');
            
            return true;
        }
        
        function testAutoLoad() {
            debugLog('=== TESTE DE CARREGAMENTO AUTOM√ÅTICO ===', 'warning');
            
            if (!exampleSelector) {
                debugLog('Seletor n√£o encontrado', 'error');
                updateStatus('selector-status', 'Erro: Seletor n√£o encontrado', 'error');
                return;
            }
            
            // Simular sele√ß√£o autom√°tica
            exampleSelector.value = 'decisao';
            debugLog('Valor do seletor definido para: decisao', 'info');
            
            // Simular evento change
            const event = new Event('change', { bubbles: true });
            exampleSelector.dispatchEvent(event);
            debugLog('Evento change disparado', 'info');
            
            // Verificar resultado ap√≥s um delay
            setTimeout(() => {
                if (editor && editor.value.trim()) {
                    debugLog('‚úÖ Carregamento autom√°tico funcionou!', 'success');
                    updateStatus('selector-status', '‚úÖ Carregamento autom√°tico funcionando', 'success');
                } else {
                    debugLog('‚ùå Carregamento autom√°tico falhou', 'error');
                    updateStatus('selector-status', '‚ùå Carregamento autom√°tico n√£o funcionou', 'error');
                }
            }, 500);
        }
        
        function checkComponents() {
            debugLog('=== VERIFICA√á√ÉO DE COMPONENTES ===', 'warning');
            
            const components = {
                'Mermaid': typeof mermaid !== 'undefined',
                'Example Selector': !!document.getElementById('example-selector'),
                'Editor': !!document.getElementById('mermaid-editor'),
                'Logs Container': !!document.getElementById('debug-logs')
            };
            
            let statusHtml = '<h4>Status dos Componentes:</h4><ul>';
            let allGood = true;
            
            for (const [name, status] of Object.entries(components)) {
                const icon = status ? '‚úÖ' : '‚ùå';
                const color = status ? '#155724' : '#721c24';
                statusHtml += `<li style="color: ${color};">${icon} ${name}: ${status ? 'OK' : 'FALHA'}</li>`;
                debugLog(`${icon} ${name}: ${status ? 'OK' : 'FALHA'}`, status ? 'success' : 'error');
                if (!status) allGood = false;
            }
            
            statusHtml += '</ul>';
            document.getElementById('component-status').innerHTML = statusHtml;
            
            if (allGood) {
                updateStatus('selector-status', '‚úÖ Todos os componentes carregados', 'success');
            } else {
                updateStatus('selector-status', '‚ö†Ô∏è Alguns componentes com problema', 'warning');
            }
        }
        
        function testMermaid() {
            debugLog('=== TESTE DO MERMAID ===', 'warning');
            
            if (typeof mermaid === 'undefined') {
                debugLog('‚ùå Mermaid n√£o carregado', 'error');
                return;
            }
            
            try {
                mermaid.initialize({
                    startOnLoad: false,
                    theme: 'default'
                });
                debugLog('‚úÖ Mermaid inicializado com sucesso', 'success');
            } catch (error) {
                debugLog(`‚ùå Erro ao inicializar Mermaid: ${error.message}`, 'error');
            }
        }
        
        function runFullDiagnostic() {
            debugLog('=== DIAGN√ìSTICO COMPLETO INICIADO ===', 'warning');
            
            // 1. Verificar componentes
            checkComponents();
            
            // 2. Testar Mermaid
            setTimeout(() => testMermaid(), 200);
            
            // 3. Testar carregamento manual
            setTimeout(() => {
                debugLog('Testando carregamento manual...', 'info');
                if (loadExampleDirect('basico')) {
                    debugLog('‚úÖ Carregamento manual funcionou', 'success');
                } else {
                    debugLog('‚ùå Carregamento manual falhou', 'error');
                }
            }, 400);
            
            // 4. Testar carregamento autom√°tico
            setTimeout(() => testAutoLoad(), 600);
            
            debugLog('=== DIAGN√ìSTICO COMPLETO FINALIZADO ===', 'warning');
        }
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('=== DIAGN√ìSTICO INICIALIZADO ===', 'warning');
            
            // Inicializar elementos
            exampleSelector = document.getElementById('example-selector');
            editor = document.getElementById('mermaid-editor');
            manualLoadBtn = document.getElementById('manual-load');
            
            // Event listeners
            if (exampleSelector) {
                exampleSelector.addEventListener('change', function() {
                    const selectedValue = this.value;
                    debugLog(`Seletor mudou para: ${selectedValue}`, 'info');
                    if (selectedValue) {
                        debugLog('Tentando carregamento autom√°tico...', 'info');
                        if (loadExampleDirect(selectedValue)) {
                            debugLog('‚úÖ Carregamento autom√°tico bem-sucedido', 'success');
                            updateStatus('selector-status', '‚úÖ Exemplo carregado automaticamente', 'success');
                        } else {
                            debugLog('‚ùå Falha no carregamento autom√°tico', 'error');
                            updateStatus('selector-status', '‚ùå Falha no carregamento autom√°tico', 'error');
                        }
                        // Reset ap√≥s delay
                        setTimeout(() => {
                            this.value = '';
                        }, 1000);
                    }
                });
                debugLog('‚úÖ Event listener do seletor configurado', 'success');
            }
            
            if (manualLoadBtn) {
                manualLoadBtn.addEventListener('click', function() {
                    const selectedValue = exampleSelector.value;
                    if (selectedValue) {
                        loadExampleDirect(selectedValue);
                    } else {
                        debugLog('Nenhum exemplo selecionado para carregamento manual', 'warning');
                        updateStatus('selector-status', 'Selecione um exemplo primeiro', 'warning');
                    }
                });
                debugLog('‚úÖ Event listener do bot√£o manual configurado', 'success');
            }
            
            debugLog('Inicializa√ß√£o conclu√≠da - pronto para diagn√≥stico!', 'success');
            updateStatus('selector-status', '‚úÖ Sistema pronto para diagn√≥stico', 'success');
        });
    </script>
</body>
</html>