<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>RobotZero - 9&nbsp; Line Follower Simulator Architecture</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./optLineFollower1.html" rel="next">
<link href="./testing_guide.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles/styles.css">
<meta property="og:title" content="RobotZero - 9&nbsp; Line Follower Simulator Architecture">
<meta property="og:description" content="">
<meta property="og:site_name" content="RobotZero">
<meta name="twitter:title" content="RobotZero - 9&nbsp; Line Follower Simulator Architecture">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./archSim.html">Line Follower Simulator</a></li><li class="breadcrumb-item"><a href="./archSim.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Line Follower Simulator Architecture</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">RobotZero</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/frankalcantara/RoboTZero" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction RoboTZero</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./installation-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Development Environment Installation Guide</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Line Follower</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introLineFollower.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction Follower</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./oper.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Line Following Robot Operation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./block.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">RobotZero Modules Description</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./config_layer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Configuration Layer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./control_layer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Control Layer Implementation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Testing Guide</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Line Follower Simulator</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./archSim.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Line Follower Simulator Architecture</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optLineFollower1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Optimization Methods for Line Follower Simulation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">9.1</span> Overview</a></li>
  <li><a href="#project-objectives" id="toc-project-objectives" class="nav-link" data-scroll-target="#project-objectives"><span class="header-section-number">9.2</span> Project Objectives</a></li>
  <li><a href="#three-layer-architecture" id="toc-three-layer-architecture" class="nav-link" data-scroll-target="#three-layer-architecture"><span class="header-section-number">9.3</span> Three-Layer Architecture</a>
  <ul class="collapse">
  <li><a href="#layer-1-user-interface" id="toc-layer-1-user-interface" class="nav-link" data-scroll-target="#layer-1-user-interface"><span class="header-section-number">9.3.1</span> Layer 1: User Interface</a></li>
  <li><a href="#layer-2-simulation-and-optimization" id="toc-layer-2-simulation-and-optimization" class="nav-link" data-scroll-target="#layer-2-simulation-and-optimization"><span class="header-section-number">9.3.2</span> Layer 2: Simulation and Optimization</a></li>
  <li><a href="#layer-3-3d-visualization" id="toc-layer-3-3d-visualization" class="nav-link" data-scroll-target="#layer-3-3d-visualization"><span class="header-section-number">9.3.3</span> Layer 3: 3D Visualization</a></li>
  </ul></li>
  <li><a href="#communication-between-components" id="toc-communication-between-components" class="nav-link" data-scroll-target="#communication-between-components"><span class="header-section-number">9.4</span> Communication Between Components</a>
  <ul class="collapse">
  <li><a href="#javascript-webassembly-binding" id="toc-javascript-webassembly-binding" class="nav-link" data-scroll-target="#javascript-webassembly-binding"><span class="header-section-number">9.4.1</span> JavaScript ↔︎ WebAssembly Binding</a></li>
  <li><a href="#asynchronous-execution" id="toc-asynchronous-execution" class="nav-link" data-scroll-target="#asynchronous-execution"><span class="header-section-number">9.4.2</span> Asynchronous Execution</a></li>
  </ul></li>
  <li><a href="#persistence-and-sharing" id="toc-persistence-and-sharing" class="nav-link" data-scroll-target="#persistence-and-sharing"><span class="header-section-number">9.5</span> Persistence and Sharing</a>
  <ul class="collapse">
  <li><a href="#local-storage" id="toc-local-storage" class="nav-link" data-scroll-target="#local-storage"><span class="header-section-number">9.5.1</span> Local Storage</a></li>
  <li><a href="#file-format" id="toc-file-format" class="nav-link" data-scroll-target="#file-format"><span class="header-section-number">9.5.2</span> File Format</a></li>
  <li><a href="#url-sharing" id="toc-url-sharing" class="nav-link" data-scroll-target="#url-sharing"><span class="header-section-number">9.5.3</span> URL Sharing</a></li>
  </ul></li>
  <li><a href="#complete-technology-stack" id="toc-complete-technology-stack" class="nav-link" data-scroll-target="#complete-technology-stack"><span class="header-section-number">9.6</span> Complete Technology Stack</a>
  <ul class="collapse">
  <li><a href="#frontend" id="toc-frontend" class="nav-link" data-scroll-target="#frontend"><span class="header-section-number">9.6.1</span> Frontend</a></li>
  <li><a href="#core-engine" id="toc-core-engine" class="nav-link" data-scroll-target="#core-engine"><span class="header-section-number">9.6.2</span> Core Engine</a></li>
  <li><a href="#deployment" id="toc-deployment" class="nav-link" data-scroll-target="#deployment"><span class="header-section-number">9.6.3</span> Deployment</a></li>
  </ul></li>
  <li><a href="#directory-structure" id="toc-directory-structure" class="nav-link" data-scroll-target="#directory-structure"><span class="header-section-number">9.7</span> Directory Structure</a></li>
  <li><a href="#development-plan-in-phases" id="toc-development-plan-in-phases" class="nav-link" data-scroll-target="#development-plan-in-phases"><span class="header-section-number">9.8</span> Development Plan in Phases</a>
  <ul class="collapse">
  <li><a href="#phase-1-foundation-and-basic-simulation" id="toc-phase-1-foundation-and-basic-simulation" class="nav-link" data-scroll-target="#phase-1-foundation-and-basic-simulation"><span class="header-section-number">9.8.1</span> Phase 1: Foundation and Basic Simulation</a></li>
  <li><a href="#phase-2-artifact-based-optimization" id="toc-phase-2-artifact-based-optimization" class="nav-link" data-scroll-target="#phase-2-artifact-based-optimization"><span class="header-section-number">9.8.2</span> Phase 2: Artifact-Based Optimization</a></li>
  <li><a href="#phase-3-arduino-emulation-future" id="toc-phase-3-arduino-emulation-future" class="nav-link" data-scroll-target="#phase-3-arduino-emulation-future"><span class="header-section-number">9.8.3</span> Phase 3: Arduino Emulation (Future)</a></li>
  </ul></li>
  <li><a href="#performance-considerations" id="toc-performance-considerations" class="nav-link" data-scroll-target="#performance-considerations"><span class="header-section-number">9.9</span> Performance Considerations</a>
  <ul class="collapse">
  <li><a href="#performance-targets" id="toc-performance-targets" class="nav-link" data-scroll-target="#performance-targets"><span class="header-section-number">9.9.1</span> Performance Targets</a></li>
  <li><a href="#planned-optimizations" id="toc-planned-optimizations" class="nav-link" data-scroll-target="#planned-optimizations"><span class="header-section-number">9.9.2</span> Planned Optimizations</a></li>
  </ul></li>
  <li><a href="#testing-and-quality" id="toc-testing-and-quality" class="nav-link" data-scroll-target="#testing-and-quality"><span class="header-section-number">9.10</span> Testing and Quality</a>
  <ul class="collapse">
  <li><a href="#testing-strategy" id="toc-testing-strategy" class="nav-link" data-scroll-target="#testing-strategy"><span class="header-section-number">9.10.1</span> Testing Strategy</a></li>
  <li><a href="#tools" id="toc-tools" class="nav-link" data-scroll-target="#tools"><span class="header-section-number">9.10.2</span> Tools</a></li>
  </ul></li>
  <li><a href="#system-requirements" id="toc-system-requirements" class="nav-link" data-scroll-target="#system-requirements"><span class="header-section-number">9.11</span> System Requirements</a>
  <ul class="collapse">
  <li><a href="#supported-browsers" id="toc-supported-browsers" class="nav-link" data-scroll-target="#supported-browsers"><span class="header-section-number">9.11.1</span> Supported Browsers</a></li>
  <li><a href="#hardware-requirements" id="toc-hardware-requirements" class="nav-link" data-scroll-target="#hardware-requirements"><span class="header-section-number">9.11.2</span> Hardware Requirements</a></li>
  </ul></li>
  <li><a href="#licensing" id="toc-licensing" class="nav-link" data-scroll-target="#licensing"><span class="header-section-number">9.12</span> Licensing</a></li>
  <li><a href="#technical-references" id="toc-technical-references" class="nav-link" data-scroll-target="#technical-references"><span class="header-section-number">9.13</span> Technical References</a>
  <ul class="collapse">
  <li><a href="#documentation" id="toc-documentation" class="nav-link" data-scroll-target="#documentation"><span class="header-section-number">9.13.1</span> Documentation</a></li>
  <li><a href="#learning-resources" id="toc-learning-resources" class="nav-link" data-scroll-target="#learning-resources"><span class="header-section-number">9.13.2</span> Learning Resources</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/frankalcantara/RoboTZero/edit/main/archSim.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/frankalcantara/RoboTZero/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./archSim.html">Line Follower Simulator</a></li><li class="breadcrumb-item"><a href="./archSim.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Line Follower Simulator Architecture</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Line Follower Simulator Architecture</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">9.1</span> Overview</h2>
<p>Simulation and optimization system for line follower robots that runs entirely in a web browser. The project is completely static, hosted on GitHub Pages, allowing users to create tracks, configure robots, run realistic physical simulations, and find optimal configurations through optimization algorithms.</p>
</section>
<section id="project-objectives" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="project-objectives"><span class="header-section-number">9.2</span> Project Objectives</h2>
<ul>
<li>Enable visual creation and editing of complex tracks with curves, straights, and artifacts</li>
<li>Simulate realistic robot physics considering mass, friction, temperature, pressure, and other environmental variables</li>
<li>Find optimal control configurations for maximum efficiency in each track section</li>
<li>Visualize competition in 3D with playback controls</li>
<li>Save and share projects, tracks, and robot configurations</li>
<li>Function completely offline after initial loading</li>
</ul>
</section>
<section id="three-layer-architecture" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="three-layer-architecture"><span class="header-section-number">9.3</span> Three-Layer Architecture</h2>
<section id="layer-1-user-interface" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="layer-1-user-interface"><span class="header-section-number">9.3.1</span> Layer 1: User Interface</h3>
<p><strong>Technology:</strong> JavaScript/Svelte</p>
<p><strong>Rationale:</strong> Svelte compiles components to optimized vanilla JavaScript with no runtime overhead, offering efficient reactivity through simple assignments, ideal for updating the UI with continuous simulation data.</p>
<p><strong>Responsibilities:</strong> - Visual track editor with curve and segment manipulation - Robot and simulation parameter configuration panels - Animation playback controls (play, pause, timeline, speed) - Saved project management and export/import interface - Optimization results visualization and convergence graphs</p>
<p><strong>State Management:</strong> - Svelte Stores for global state shared between components - Local reactive state in each component - Automatic synchronization with IndexedDB for persistence</p>
</section>
<section id="layer-2-simulation-and-optimization" class="level3" data-number="9.3.2">
<h3 data-number="9.3.2" class="anchored" data-anchor-id="layer-2-simulation-and-optimization"><span class="header-section-number">9.3.2</span> Layer 2: Simulation and Optimization</h3>
<p><strong>Technology:</strong> C++ compiled to WebAssembly via Emscripten</p>
<p><strong>Rationale:</strong> Near-native performance (80-95%) for intensive physics and optimization calculations, with full control over memory allocation and predictable execution.</p>
<section id="physics-module" class="level4" data-number="9.3.2.1">
<h4 data-number="9.3.2.1" class="anchored" data-anchor-id="physics-module"><span class="header-section-number">9.3.2.1</span> Physics Module</h4>
<p><strong>Library:</strong> Box2D (official WebAssembly port)</p>
<p><strong>Rationale:</strong> Complete 2D rigid body physics engine with collision detection and stable numerical integration, eliminating the need to implement subtle stability details.</p>
<p><strong>Implementation:</strong> - Dynamic robot model with two independent motors (differential drive) - Kinematics calculations considering mass, inertia, and geometry - Friction simulation between wheels and surface - Collision detection with track edges - Infrared sensor system simulating analog line reading</p>
<p><strong>Environmental Factors:</strong> - Temperature: affects friction and motor response - Atmospheric pressure: influences air density and drag - Robot weight: determines inertia and grip - Friction coefficient: varies by surface type</p>
</section>
<section id="mathematics-module" class="level4" data-number="9.3.2.2">
<h4 data-number="9.3.2.2" class="anchored" data-anchor-id="mathematics-module"><span class="header-section-number">9.3.2.2</span> Mathematics Module</h4>
<p><strong>Library:</strong> Eigen</p>
<p><strong>Rationale:</strong> Header-only linear algebra library that works perfectly with Emscripten, offering optimized matrix operations and solvers essential for optimization algorithms.</p>
<p><strong>Usage:</strong> - Vector and matrix operations for kinematic calculations - Linear system solvers - Geometric transformation calculations</p>
</section>
<section id="optimization-module" class="level4" data-number="9.3.2.3">
<h4 data-number="9.3.2.3" class="anchored" data-anchor-id="optimization-module"><span class="header-section-number">9.3.2.3</span> Optimization Module</h4>
<p><strong>Strategy:</strong> Artifact-Based Hierarchical Decomposition</p>
<p><strong>Rationale:</strong> Instead of optimizing the entire track as a complex global problem, the system decomposes the track into known geometric primitives (artifacts) and applies analytical or semi-analytical solutions specific to each type. This approach drastically reduces the search space, provides provably optimal solutions for known cases, and enables interpretability of applied strategies.</p>
<section id="phase-1-pattern-recognition" class="level5" data-number="9.3.2.3.1">
<h5 data-number="9.3.2.3.1" class="anchored" data-anchor-id="phase-1-pattern-recognition"><span class="header-section-number">9.3.2.3.1</span> Phase 1: Pattern Recognition</h5>
<p><strong>Pattern Recognizer:</strong> Analyzes track geometry and identifies known artifacts.</p>
<p><strong>Artifacts Supported in Library:</strong> - Simple straight: linear segment without curvature - Circular curve: circle arc with constant radius - Straight-curve-straight transition: common sequence in racing tracks - S-Curve: two consecutive curves in opposite directions - Chicane: rapid sequence of alternating curves - Hairpin: tight 180-degree turn - Spiral: curve with continuously varying radius</p>
<p><strong>Recognition Process:</strong> 1. Scan track segments sequentially 2. Attempt pattern matching from most specific to most generic 3. When a match is found, mark segments as part of the artifact 4. Unrecognized segments are marked as “complex artifacts” for numerical optimization</p>
</section>
<section id="phase-2-analytical-strategy-library" class="level5" data-number="9.3.2.3.2">
<h5 data-number="9.3.2.3.2" class="anchored" data-anchor-id="phase-2-analytical-strategy-library"><span class="header-section-number">9.3.2.3.2</span> Phase 2: Analytical Strategy Library</h5>
<p>Each artifact in the library has a specific optimization strategy based on established physical principles and control theory.</p>
<p><strong>Straight:</strong> - Strategy: accelerate to maximum robot velocity and maintain - Instantaneous calculation, trivially optimal solution</p>
<p><strong>Circular Curve:</strong> - Maximum velocity: <code>v_max = sqrt(μ * g * R)</code> where μ is friction coefficient, g gravity, R radius - Racing line: enter wide, cut apex (innermost point), exit wide to maximize effective radius - Analytical solution based on classical vehicle dynamics</p>
<p><strong>Straight-Curve-Straight Transition:</strong> - Braking distance: <code>d = (v_initial² - v_curve²) / (2 * a_max)</code> - Braking start point calculated analytically - Strategy: brake as late as possible before curve, cut apex, accelerate as early as possible on exit - Based on optimal racing line theory</p>
<p><strong>S-Curve and Chicane:</strong> - Smoothed trajectory to minimize abrupt direction changes - Modulated velocity to maintain grip in transitions - Uses Bézier splines or clothoids for smooth transitions</p>
<p><strong>Hairpin:</strong> - Very reduced velocity at apex - Wide entry, late apex, accelerate on exit - Calculation based on robot’s minimum turning radius</p>
<p><strong>Spiral:</strong> - Velocity inversely proportional to local curvature - Racing line follows varying radius - Calculation by integration along curve</p>
</section>
<section id="phase-3-transition-optimization" class="level5" data-number="9.3.2.3.3">
<h5 data-number="9.3.2.3.3" class="anchored" data-anchor-id="phase-3-transition-optimization"><span class="header-section-number">9.3.2.3.3</span> Phase 3: Transition Optimization</h5>
<p><strong>Reduced Problem:</strong> For N artifacts, optimize only N-1 transition velocities between consecutive artifacts.</p>
<p><strong>Approach:</strong> - Intelligent initialization using physical estimates - Optimization by numerical (finite differences) or analytical gradient if available - Problem typically with 5-15 variables (much smaller than global optimization) - Fast convergence due to reduced search space</p>
<p><strong>Algorithm:</strong> 1. Calculate optimal local strategy for each artifact assuming initial transition velocities 2. Optimize transition velocities to minimize total time 3. Recalculate local strategies with optimized velocities 4. Iterate until convergence (typically 3-5 iterations)</p>
</section>
<section id="phase-4-complex-artifact-optimization" class="level5" data-number="9.3.2.3.4">
<h5 data-number="9.3.2.3.4" class="anchored" data-anchor-id="phase-4-complex-artifact-optimization"><span class="header-section-number">9.3.2.3.4</span> Phase 4: Complex Artifact Optimization</h5>
<p>For geometries that do not fit known patterns, apply advanced numerical optimization techniques only locally to that artifact.</p>
<p><strong>Available Techniques:</strong></p>
<p><strong>Gradient-Based Optimization:</strong> - L-BFGS: quasi-Newton method without Hessian requirement, fast convergence - Gradient Descent with momentum: for cases with noisy objective function - Automatic Differentiation via CppAD: computes exact gradients without approximations - Finite Differences: numerical approximation when automatic differentiation is not applicable</p>
<p><strong>Model Predictive Control (MPC):</strong> - Repeatedly solves finite-horizon optimization problem - Suitable for artifacts with complex constraints or variable geometry - Allows incorporation of future state prediction - Used in modern automotive control and mobile robotics systems</p>
<p><strong>Sequential Quadratic Programming (SQP):</strong> - For nonlinear problems with equality and inequality constraints - Approximates problem locally by quadratic program - Superlinear convergence when close to solution</p>
<p><strong>Direct Collocation:</strong> - Discretizes trajectory into control points - Transforms optimal control problem into nonlinear parameter optimization - Effective for complex trajectories with multiple constraints</p>
<p><strong>Shooting Methods:</strong> - Integrates dynamics equations forward with candidate controls - Adjusts controls to satisfy boundary conditions - Single shooting (simple) or Multiple shooting (more robust)</p>
<p><strong>Fallback - Stochastic Algorithms:</strong> Only when deterministic methods fail due to multiple local minima: - Particle Swarm Optimization (PSO): generally faster than GA - Genetic Algorithm: robust but computationally expensive - Simulated Annealing: for highly non-convex search spaces</p>
</section>
<section id="optimizable-parameters" class="level5" data-number="9.3.2.3.5">
<h5 data-number="9.3.2.3.5" class="anchored" data-anchor-id="optimizable-parameters"><span class="header-section-number">9.3.2.3.5</span> Optimizable Parameters</h5>
<p><strong>Artifact Level:</strong> - Entry and exit velocities - Braking/acceleration start points - Trajectory (racing line) for curves - Maneuver aggressiveness</p>
<p><strong>Global Level:</strong> - PID controller gains (Kp, Ki, Kd) via established tuning methods (Ziegler-Nichols, Cohen-Coon) - Maximum robot velocity in different environmental conditions - Safety margins (minimum distance from edges)</p>
</section>
<section id="objective-function" class="level5" data-number="9.3.2.3.6">
<h5 data-number="9.3.2.3.6" class="anchored" data-anchor-id="objective-function"><span class="header-section-number">9.3.2.3.6</span> Objective Function</h5>
<p><strong>Primary:</strong> Total time to complete track</p>
<p><strong>Secondary (weighted):</strong> - Trajectory smoothness: penalizes abrupt accelerations and oscillations - Energy consumption: integral of power along path - Safety margin: penalizes excessive proximity to edges - Mechanical wear: penalizes maneuvers that stress components</p>
</section>
<section id="advantages-of-artifact-based-approach" class="level5" data-number="9.3.2.3.7">
<h5 data-number="9.3.2.3.7" class="anchored" data-anchor-id="advantages-of-artifact-based-approach"><span class="header-section-number">9.3.2.3.7</span> Advantages of Artifact-Based Approach</h5>
<p><strong>Computational Efficiency:</strong> - 80-95% reduction in number of variables to optimize - Analytical solutions are instantaneous (microseconds) - Numerical optimization applied only where necessary</p>
<p><strong>Interpretability:</strong> - User sees specific strategy applied to each artifact - Detailed feedback: “In this 8m radius curve, limited by grip to 1.2 m/s” - Educational value about vehicle dynamics and racing strategies</p>
<p><strong>Robustness:</strong> - Analytical solutions are provably optimal within physical constraints - No risk of convergence to poor local minima in known artifacts - Deterministic and reproducible results</p>
<p><strong>Scalability:</strong> - Artifact library can grow incrementally - Advanced users can contribute new artifacts - Each artifact is independent testable module</p>
</section>
</section>
<section id="operating-modes" class="level4" data-number="9.3.2.4">
<h4 data-number="9.3.2.4" class="anchored" data-anchor-id="operating-modes"><span class="header-section-number">9.3.2.4</span> Operating Modes</h4>
<p><strong>Batch Mode (Optimization):</strong> - Executes thousands of complete simulations without visualization - Returns only final results (fitness, time, parameters) - Optimized for maximum execution speed - Runs in Web Worker to not block interface</p>
<p><strong>Step Mode (Visualization):</strong> - Advances simulation incrementally synchronized with animation - Returns complete state at each step (position, velocity, sensors) - Generates complete state log for later playback - Allows fine control of simulation rate</p>
</section>
</section>
<section id="layer-3-3d-visualization" class="level3" data-number="9.3.3">
<h3 data-number="9.3.3" class="anchored" data-anchor-id="layer-3-3d-visualization"><span class="header-section-number">9.3.3</span> Layer 3: 3D Visualization</h3>
<p><strong>Technology:</strong> Three.js</p>
<p><strong>Rationale:</strong> Mature and performant library for 3D rendering in browser with extensive ecosystem and documentation.</p>
<p><strong>Scene Components:</strong> - Track surface (plane or textured mesh) - Black line as extruded geometry or texture - 3D robot model (simple geometry with orientation indicator) - Sensor visualization (rays or cones showing detection) - Configurable camera (free perspective or following robot) - Lighting and shadows for visual depth</p>
<p><strong>Playback System:</strong> - Simulation runs independently generating complete state log - Animation reproduces log synchronized with browser clock time - Controls: play, pause, stop, timeline scrubbing - Adjustable speed (slow motion, real-time, accelerated) - Optimized storage via keyframes with interpolation</p>
<p><strong>Performance Optimization:</strong> - Instanced rendering for repetitive track elements - Texture atlases to reduce draw calls - Object pooling to avoid creation/destruction - Frustum culling and occlusion culling</p>
</section>
</section>
<section id="communication-between-components" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="communication-between-components"><span class="header-section-number">9.4</span> Communication Between Components</h2>
<section id="javascript-webassembly-binding" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="javascript-webassembly-binding"><span class="header-section-number">9.4.1</span> JavaScript ↔︎ WebAssembly Binding</h3>
<p><strong>Technology:</strong> Embind (provided by Emscripten)</p>
<p><strong>Structure:</strong></p>
<pre><code>Svelte Interface (JS)
       ↕
   Embind API
       ↕
Core Engine (C++ WASM)</code></pre>
<p><strong>Exposed Types:</strong> - RobotConfig: complete robot configuration - TrackSegment: track segment definition - SimulationState: instantaneous simulation state - OptimizationResult: optimization process results</p>
<p><strong>Transfer Optimization:</strong> - Shared memory via TypedArrays for frequent data - JSON serialization for sporadic configurations - Reusable buffers to avoid repeated allocations</p>
</section>
<section id="asynchronous-execution" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2" class="anchored" data-anchor-id="asynchronous-execution"><span class="header-section-number">9.4.2</span> Asynchronous Execution</h3>
<p><strong>Web Workers:</strong> - Long optimization operations run in dedicated workers - Interface remains responsive during intensive processing - Communication via postMessage with serializable data - Progress callbacks for progress bar updates</p>
</section>
</section>
<section id="persistence-and-sharing" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="persistence-and-sharing"><span class="header-section-number">9.5</span> Persistence and Sharing</h2>
<section id="local-storage" class="level3" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored" data-anchor-id="local-storage"><span class="header-section-number">9.5.1</span> Local Storage</h3>
<p><strong>Technology:</strong> IndexedDB via Dexie.js</p>
<p><strong>Rationale:</strong> Dexie.js provides simplified IndexedDB wrapper with Promise-based API and advanced query capabilities.</p>
<p><strong>Schemas:</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>projects<span class="op">:</span> <span class="st">"++id, name, modified"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>tracks<span class="op">:</span> <span class="st">"++id, name, created"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>robots<span class="op">:</span> <span class="st">"++id, name, created"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>simulations<span class="op">:</span> <span class="st">"++id, projectId, timestamp"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Capacity:</strong> - 50MB to several GB depending on browser - Sufficient for hundreds of complex projects</p>
<p><strong>Compaction Strategy:</strong> - Simulation logs stored as keyframes - Gzip compression for large data - Automatic cleanup of old data (optional)</p>
</section>
<section id="file-format" class="level3" data-number="9.5.2">
<h3 data-number="9.5.2" class="anchored" data-anchor-id="file-format"><span class="header-section-number">9.5.2</span> File Format</h3>
<p><strong>Extension:</strong> .lfsim (structured JSON)</p>
<p><strong>Structure:</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"version"</span><span class="fu">:</span> <span class="st">"1.0"</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"metadata"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"author"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"created"</span><span class="fu">:</span> <span class="st">"timestamp"</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"modified"</span><span class="fu">:</span> <span class="st">"timestamp"</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"track"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"width"</span><span class="fu">:</span> <span class="st">"number"</span><span class="fu">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"height"</span><span class="fu">:</span> <span class="st">"number"</span><span class="fu">,</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"segments"</span><span class="fu">:</span> <span class="ot">[</span><span class="er">...</span><span class="ot">]</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"robot"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"mass"</span><span class="fu">:</span> <span class="st">"number"</span><span class="fu">,</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"wheelbase"</span><span class="fu">:</span> <span class="st">"number"</span><span class="fu">,</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"sensors"</span><span class="fu">:</span> <span class="fu">{</span><span class="er">...</span><span class="fu">},</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"pid"</span><span class="fu">:</span> <span class="fu">{</span><span class="er">...</span><span class="fu">}</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"simulation"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"parameters"</span><span class="fu">:</span> <span class="fu">{</span><span class="er">...</span><span class="fu">},</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"results"</span><span class="fu">:</span> <span class="fu">{</span><span class="er">...</span><span class="fu">}</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="url-sharing" class="level3" data-number="9.5.3">
<h3 data-number="9.5.3" class="anchored" data-anchor-id="url-sharing"><span class="header-section-number">9.5.3</span> URL Sharing</h3>
<p><strong>Technology:</strong> Pako (gzip compression)</p>
<p><strong>Process:</strong> 1. Serialize project to JSON 2. Compress with gzip (Pako) 3. Encode in Base64 4. Include in URL query parameter</p>
<p><strong>Practical Limit:</strong> - URLs up to ~2KB work in all browsers - URLs up to ~8KB work in most cases - Large projects require file export</p>
</section>
</section>
<section id="complete-technology-stack" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="complete-technology-stack"><span class="header-section-number">9.6</span> Complete Technology Stack</h2>
<section id="frontend" class="level3" data-number="9.6.1">
<h3 data-number="9.6.1" class="anchored" data-anchor-id="frontend"><span class="header-section-number">9.6.1</span> Frontend</h3>
<p><strong>Runtime:</strong> - Svelte: Reactive UI framework - JavaScript/TypeScript: Primary language - Three.js: 3D rendering - Dexie.js: IndexedDB wrapper - Pako: Gzip compression</p>
<p><strong>Build Tools:</strong> - Vite: Modern bundler with native WASM support - TypeScript (optional): Static typing - ESLint: JavaScript code linting - Prettier: Code formatting</p>
</section>
<section id="core-engine" class="level3" data-number="9.6.2">
<h3 data-number="9.6.2" class="anchored" data-anchor-id="core-engine"><span class="header-section-number">9.6.2</span> Core Engine</h3>
<p><strong>Language:</strong> C++17</p>
<p><strong>Libraries:</strong> - Box2D: 2D physics engine - Eigen: Linear algebra (header-only) - Emscripten: Toolchain for WASM - CppAD (optional): Automatic differentiation for gradient-based optimization - NLopt (optional): Nonlinear optimization algorithm library</p>
<p><strong>Build Tools:</strong> - CMake: Build system - Emscripten SDK (emsdk): C++ → WASM compiler</p>
<p><strong>Compilation Flags:</strong></p>
<pre><code>-O3                          # Maximum optimization
-s WASM=1                    # Generate WebAssembly
-s MODULARIZE=1              # ES6 module
-s ALLOW_MEMORY_GROWTH=1     # Dynamic memory
-s INITIAL_MEMORY=16MB       # Initial memory
-s MAXIMUM_MEMORY=512MB      # Memory limit
--bind                       # Enable Embind</code></pre>
</section>
<section id="deployment" class="level3" data-number="9.6.3">
<h3 data-number="9.6.3" class="anchored" data-anchor-id="deployment"><span class="header-section-number">9.6.3</span> Deployment</h3>
<p><strong>Hosting:</strong> GitHub Pages</p>
<p><strong>CI/CD:</strong> GitHub Actions</p>
<p><strong>Pipeline:</strong> 1. Compile C++ to WASM via Emscripten 2. Bundle JavaScript/Svelte via Vite 3. Optimize assets (images, fonts) 4. Deploy to gh-pages branch</p>
<p><strong>Requirements:</strong> - Public repository or GitHub Pro - GitHub Actions enabled - GitHub Pages configuration pointing to gh-pages branch</p>
</section>
</section>
<section id="directory-structure" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="directory-structure"><span class="header-section-number">9.7</span> Directory Structure</h2>
<pre><code>line-follower-simulator/
├── README.md
├── ARCHITECTURE.md
├── package.json
├── vite.config.js
├── tsconfig.json (optional)
│
├── .github/
│   └── workflows/
│       └── deploy.yml
│
├── public/
│   ├── assets/
│   └── favicon.ico
│
├── src/
│   ├── lib/
│   │   ├── components/       # Svelte components
│   │   │   ├── TrackEditor.svelte
│   │   │   ├── RobotConfig.svelte
│   │   │   ├── SimulationView.svelte
│   │   │   └── Viewer3D.svelte
│   │   │
│   │   ├── stores/          # Svelte stores
│   │   │   ├── project.js
│   │   │   ├── simulation.js
│   │   │   └── ui.js
│   │   │
│   │   ├── storage/         # Persistence
│   │   │   ├── database.js
│   │   │   ├── serializer.js
│   │   │   └── url-encoder.js
│   │   │
│   │   └── three/          # 3D visualization
│   │       ├── scene.js
│   │       ├── robot.js
│   │       └── track.js
│   │
│   ├── workers/
│   │   └── optimization.worker.js
│   │
│   ├── App.svelte
│   └── main.js
│
├── cpp/
│   ├── CMakeLists.txt
│   ├── include/
│   │   ├── simulator.hpp
│   │   ├── optimizer.hpp
│   │   ├── physics.hpp
│   │   ├── pattern_recognizer.hpp
│   │   ├── artifacts/
│   │   │   ├── artifact_base.hpp
│   │   │   ├── straight.hpp
│   │   │   ├── circular_curve.hpp
│   │   │   ├── s_curve.hpp
│   │   │   ├── chicane.hpp
│   │   │   ├── hairpin.hpp
│   │   │   ├── spiral.hpp
│   │   │   └── complex.hpp
│   │   └── optimizers/
│   │       ├── gradient_descent.hpp
│   │       ├── lbfgs.hpp
│   │       ├── mpc.hpp
│   │       └── direct_collocation.hpp
│   │
│   ├── src/
│   │   ├── simulator.cpp
│   │   ├── optimizer.cpp
│   │   ├── physics.cpp
│   │   ├── pattern_recognizer.cpp
│   │   ├── artifacts/
│   │   │   ├── straight.cpp
│   │   │   ├── circular_curve.cpp
│   │   │   ├── s_curve.cpp
│   │   │   ├── chicane.cpp
│   │   │   ├── hairpin.cpp
│   │   │   ├── spiral.cpp
│   │   │   └── complex.cpp
│   │   ├── optimizers/
│   │   │   ├── gradient_descent.cpp
│   │   │   ├── lbfgs.cpp
│   │   │   ├── mpc.cpp
│   │   │   └── direct_collocation.cpp
│   │   └── bindings.cpp
│   │
│   └── external/
│       ├── box2d/
│       ├── eigen/
│       └── cppad/           # Automatic differentiation (optional)
│
└── dist/                   # Build output (generated)
    ├── index.html
    ├── assets/
    ├── simulator.js
    └── simulator.wasm</code></pre>
</section>
<section id="development-plan-in-phases" class="level2" data-number="9.8">
<h2 data-number="9.8" class="anchored" data-anchor-id="development-plan-in-phases"><span class="header-section-number">9.8</span> Development Plan in Phases</h2>
<section id="phase-1-foundation-and-basic-simulation" class="level3" data-number="9.8.1">
<h3 data-number="9.8.1" class="anchored" data-anchor-id="phase-1-foundation-and-basic-simulation"><span class="header-section-number">9.8.1</span> Phase 1: Foundation and Basic Simulation</h3>
<p><strong>Objective:</strong> Create functional system with abstract control model</p>
<p><strong>Components:</strong> 1. Basic Svelte interface - Simple track editor (straight lines and curves) - Robot parameter configuration panel - Basic 2D visualization of simulation state</p>
<ol start="2" type="1">
<li>Physical simulator in C++/WASM
<ul>
<li>Robot kinematic model</li>
<li>Simulated sensor system</li>
<li>Configurable PID controller</li>
<li>Stable numerical integration</li>
</ul></li>
<li>3D visualization with Three.js
<ul>
<li>Basic scene with track and robot</li>
<li>Camera controls</li>
<li>Recorded simulation playback</li>
</ul></li>
<li>Basic persistence
<ul>
<li>Save/load projects in IndexedDB</li>
<li>Export/import .lfsim files</li>
</ul></li>
</ol>
<p><strong>Deliverable:</strong> Functional simulator where users can create tracks, configure robots, and visualize simulations.</p>
<p><strong>Estimated Duration:</strong> 2-3 months</p>
</section>
<section id="phase-2-artifact-based-optimization" class="level3" data-number="9.8.2">
<h3 data-number="9.8.2" class="anchored" data-anchor-id="phase-2-artifact-based-optimization"><span class="header-section-number">9.8.2</span> Phase 2: Artifact-Based Optimization</h3>
<p><strong>Objective:</strong> Implement hierarchical optimization system with artifact decomposition</p>
<p><strong>Components:</strong> 1. Pattern Recognition System - Pattern Recognizer to identify geometric artifacts - Complete implementation in C++ - Visualization of track decomposition into artifacts - Interface to adjust recognition tolerances</p>
<ol start="2" type="1">
<li>Artifact Library
<ul>
<li>Implement basic artifacts: straight, circular curve, straight-curve-straight transition</li>
<li>Analytical solutions for each artifact type</li>
<li>Physics-based strategies (racing line, maximum velocity in curves)</li>
<li>Extensible system to add new artifacts</li>
</ul></li>
<li>Transition Optimizer
<ul>
<li>Implement numerical gradient via finite differences</li>
<li>Optimization of velocities between consecutive artifacts</li>
<li>Intelligent initialization using physical heuristics</li>
<li>Visualization of convergence and impact of each transition</li>
</ul></li>
<li>Advanced Optimizers for Complex Artifacts
<ul>
<li>L-BFGS for efficient optimization with many variables</li>
<li>Automatic differentiation via CppAD (optional)</li>
<li>Fallback to stochastic methods when necessary</li>
<li>Performance metrics comparing different methods</li>
</ul></li>
<li>Optimization Interface
<ul>
<li>Visualization of decomposition into identified artifacts</li>
<li>Artifact-specific feedback (limitations, applied strategy)</li>
<li>Real-time progress control</li>
<li>Comparison of results between different configurations</li>
<li>Sensitivity analysis (how changes affect performance)</li>
</ul></li>
<li>Simulation Improvements
<ul>
<li>Environmental factors (temperature, friction) integrated into analytical formulas</li>
<li>Sensor noise for realistic simulation</li>
<li>More detailed motor models</li>
<li>Automatic PID tuning using established methods (Ziegler-Nichols)</li>
</ul></li>
<li>Sharing
<ul>
<li>Generation of URLs with compressed projects</li>
<li>Export optimized strategies as detailed report</li>
<li>Community project gallery with strategy analyses</li>
</ul></li>
</ol>
<p><strong>Deliverable:</strong> Complete optimization system that decomposes tracks into artifacts, applies analytical solutions where possible, and optimizes numerically only when necessary. Users can visualize and understand strategies applied to each track section.</p>
<p><strong>Estimated Duration:</strong> 3-4 months</p>
</section>
<section id="phase-3-arduino-emulation-future" class="level3" data-number="9.8.3">
<h3 data-number="9.8.3" class="anchored" data-anchor-id="phase-3-arduino-emulation-future"><span class="header-section-number">9.8.3</span> Phase 3: Arduino Emulation (Future)</h3>
<p><strong>Objective:</strong> Enable execution of real Arduino code in simulation</p>
<p><strong>Possible Approaches:</strong></p>
<p><strong>Option A - High-Level Interpreter:</strong> - Create interpreter for Arduino API subset - Support essential functions (pinMode, analogRead, analogWrite, etc.) - Real-time code parsing and execution - Instrumentation for visual debugging</p>
<p><strong>Option B - Complete Emulation:</strong> - Integrate AVR emulator (SimAVR or similar) - Load and execute compiled code (.hex) - Precise synchronization with physical simulation - Absolute fidelity with real hardware</p>
<p><strong>Decision:</strong> Will be made after validation of phases 1 and 2 with real users, considering demand and available resources.</p>
<p><strong>Deliverable:</strong> System allowing development and testing of real Arduino code in simulator.</p>
<p><strong>Estimated Duration:</strong> 3-6 months (depending on approach)</p>
</section>
</section>
<section id="performance-considerations" class="level2" data-number="9.9">
<h2 data-number="9.9" class="anchored" data-anchor-id="performance-considerations"><span class="header-section-number">9.9</span> Performance Considerations</h2>
<section id="performance-targets" class="level3" data-number="9.9.1">
<h3 data-number="9.9.1" class="anchored" data-anchor-id="performance-targets"><span class="header-section-number">9.9.1</span> Performance Targets</h3>
<p><strong>Simulation:</strong> - Batch mode: 1000+ simulations/second (optimization) - Step mode: 60 FPS with stable physics</p>
<p><strong>Rendering:</strong> - Constant 60 FPS on modern hardware - Minimum 30 FPS on older hardware - Graceful quality degradation if necessary</p>
<p><strong>Loading:</strong> - Initial download: &lt;5 MB - Initialization time: &lt;2 seconds - Project loading: &lt;500 ms</p>
</section>
<section id="planned-optimizations" class="level3" data-number="9.9.2">
<h3 data-number="9.9.2" class="anchored" data-anchor-id="planned-optimizations"><span class="header-section-number">9.9.2</span> Planned Optimizations</h3>
<p><strong>C++ WASM:</strong> - Compilation with -O3 and link-time optimization - SIMD for vector operations when available - Memory pools to avoid repeated allocations - Profile-guided optimization in hot paths</p>
<p><strong>Three.js:</strong> - Geometry instancing for repeated elements - Texture atlases to reduce draw calls - Object pooling to avoid creation/destruction - Frustum culling and occlusion culling</p>
<p><strong>JavaScript:</strong> - Code splitting for on-demand loading - Tree shaking to eliminate unused code - Gzip/brotli compression of assets - Service Worker for offline cache</p>
</section>
</section>
<section id="testing-and-quality" class="level2" data-number="9.10">
<h2 data-number="9.10" class="anchored" data-anchor-id="testing-and-quality"><span class="header-section-number">9.10</span> Testing and Quality</h2>
<section id="testing-strategy" class="level3" data-number="9.10.1">
<h3 data-number="9.10.1" class="anchored" data-anchor-id="testing-strategy"><span class="header-section-number">9.10.1</span> Testing Strategy</h3>
<p><strong>Unit Tests:</strong> - Mathematical and physical functions in C++ - Isolated Svelte components - Serialization/deserialization functions</p>
<p><strong>Integration:</strong> - JavaScript ↔︎ WASM communication - Complete persistence pipeline - Recorded simulation playback</p>
<p><strong>E2E:</strong> - Complete user flows (create, simulate, save) - Cross-browser compatibility - Performance on different hardware</p>
</section>
<section id="tools" class="level3" data-number="9.10.2">
<h3 data-number="9.10.2" class="anchored" data-anchor-id="tools"><span class="header-section-number">9.10.2</span> Tools</h3>
<ul>
<li>Vitest: JavaScript unit tests</li>
<li>Google Test: C++ unit tests</li>
<li>Playwright: E2E tests</li>
<li>Lighthouse: Performance audit</li>
</ul>
</section>
</section>
<section id="system-requirements" class="level2" data-number="9.11">
<h2 data-number="9.11" class="anchored" data-anchor-id="system-requirements"><span class="header-section-number">9.11</span> System Requirements</h2>
<section id="supported-browsers" class="level3" data-number="9.11.1">
<h3 data-number="9.11.1" class="anchored" data-anchor-id="supported-browsers"><span class="header-section-number">9.11.1</span> Supported Browsers</h3>
<ul>
<li>Chrome/Edge 90+</li>
<li>Firefox 88+</li>
<li>Safari 14+</li>
<li>Modern mobile browsers (limited functionality)</li>
</ul>
</section>
<section id="hardware-requirements" class="level3" data-number="9.11.2">
<h3 data-number="9.11.2" class="anchored" data-anchor-id="hardware-requirements"><span class="header-section-number">9.11.2</span> Hardware Requirements</h3>
<p><strong>Minimum:</strong> - CPU: Dual-core 2.0 GHz - RAM: 4 GB - GPU: WebGL 2.0 support</p>
<p><strong>Recommended:</strong> - CPU: Quad-core 3.0 GHz+ - RAM: 8 GB+ - GPU: Dedicated with WebGL 2.0 support</p>
</section>
</section>
<section id="licensing" class="level2" data-number="9.12">
<h2 data-number="9.12" class="anchored" data-anchor-id="licensing"><span class="header-section-number">9.12</span> Licensing</h2>
<p><strong>Own Code:</strong> To be defined (MIT or GPL suggested)</p>
<p><strong>Dependencies:</strong> - Svelte: MIT License - Three.js: MIT License - Box2D: MIT License - Eigen: MPL2 License - Emscripten: MIT/LLVM License - Dexie.js: Apache License 2.0 - Pako: MIT License</p>
</section>
<section id="technical-references" class="level2" data-number="9.13">
<h2 data-number="9.13" class="anchored" data-anchor-id="technical-references"><span class="header-section-number">9.13</span> Technical References</h2>
<section id="documentation" class="level3" data-number="9.13.1">
<h3 data-number="9.13.1" class="anchored" data-anchor-id="documentation"><span class="header-section-number">9.13.1</span> Documentation</h3>
<ul>
<li><strong>Svelte:</strong> https://svelte.dev/docs</li>
<li><strong>Three.js:</strong> https://threejs.org/docs</li>
<li><strong>Emscripten:</strong> https://emscripten.org/docs</li>
<li><strong>Box2D:</strong> https://box2d.org/documentation</li>
<li><strong>Eigen:</strong> https://eigen.tuxfamily.org/dox</li>
<li><strong>Dexie.js:</strong> https://dexie.org</li>
</ul>
</section>
<section id="learning-resources" class="level3" data-number="9.13.2">
<h3 data-number="9.13.2" class="anchored" data-anchor-id="learning-resources"><span class="header-section-number">9.13.2</span> Learning Resources</h3>
<ul>
<li><strong>WebAssembly:</strong> https://webassembly.org</li>
<li><strong>Genetic Algorithms:</strong> “An Introduction to Genetic Algorithms” - Mitchell (1998)</li>
<li><strong>PID Controllers:</strong> “PID Controllers” - Åström &amp; Hägglund (1995)</li>
<li><strong>Mobile Robotics:</strong> “Introduction to Autonomous Mobile Robots” - Siegwart et al.&nbsp;(2011)</li>
</ul>
<hr>
<p><strong>Document Version:</strong> 1.0<br>
<strong>Last Updated:</strong> 2025-11-04<br>
<strong>Status:</strong> Architecture defined, awaiting implementation start</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/frankalcantara\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./testing_guide.html" class="pagination-link" aria-label="Testing Guide">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Testing Guide</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./optLineFollower1.html" class="pagination-link" aria-label="Optimization Methods for Line Follower Simulation">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Optimization Methods for Line Follower Simulation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright © 2024 Frank de Alcantara</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/frankalcantara/RoboTZero/edit/main/archSim.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/frankalcantara/RoboTZero/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>