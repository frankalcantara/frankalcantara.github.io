<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Sistemas Operacionais - 5&nbsp; Criando Processos de Forma Programática: O Modelo Linux</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./gerproc2.html" rel="next">
<link href="./gerproc.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles/styles.css">
<meta property="og:title" content="Sistemas Operacionais - 5&nbsp; Criando Processos de Forma Programática: O Modelo Linux">
<meta property="og:description" content="">
<meta property="og:site_name" content="Sistemas Operacionais">
<meta name="twitter:title" content="Sistemas Operacionais - 5&nbsp; Criando Processos de Forma Programática: O Modelo Linux">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./gerproc.html">Gerenciamento de Processos: Introdução</a></li><li class="breadcrumb-item"><a href="./gerproc1.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Criando Processos de Forma Programática: O Modelo Linux</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Sistemas Operacionais</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/frankalcantara/linefollower" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Apresentação</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Desvendando o Invisível: Uma Introdução aos Sistemas Operacionais</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Sistemas Operacionais: Equilibrando Recursos e Simplicidade</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Exercícios</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introdução: Referências</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./gerproc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gerenciamento de Processos: Introdução</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gerproc1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Criando Processos de Forma Programática: O Modelo Linux</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gerproc2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Processos de Sistema: <strong>Linux</strong> vs.&nbsp;Windows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gerproc3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Controle de Processos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gerproc4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Untitled</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gerproc5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Simuladores e Projetos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gerproc6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Referências</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12germem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Gestão de Memória</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13gerfiles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Gestão de Arquivos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14geres.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Gestão de Entrada/Saída</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15gerredes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Gestão de Conectividade e Comunicação</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16gerseg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Segurança</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2arqui.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Arquiteturas de Sistemas Operacionais: Estruturando a Complexidade</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3heterox.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Tendências Avançadas em Sistemas Operacionais</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18glossa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Glossário - Sistemas Operacionais: Fundamentos e Evolução</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19exerc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Exercícios Resolvidos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#filosofias-de-design-dois-paradigmas-duas-visões" id="toc-filosofias-de-design-dois-paradigmas-duas-visões" class="nav-link active" data-scroll-target="#filosofias-de-design-dois-paradigmas-duas-visões"><span class="header-section-number">5.0.1</span> Filosofias de Design: Dois Paradigmas, Duas Visões</a></li>
  <li><a href="#o-modelo-linux-a-composição-de-fork-e-exec" id="toc-o-modelo-linux-a-composição-de-fork-e-exec" class="nav-link" data-scroll-target="#o-modelo-linux-a-composição-de-fork-e-exec"><span class="header-section-number">5.0.2</span> O Modelo Linux: A Composição de <code>fork()</code> e <code>exec()</code></a></li>
  <li><a href="#o-modelo-windows-a-configuração-com-createprocess" id="toc-o-modelo-windows-a-configuração-com-createprocess" class="nav-link" data-scroll-target="#o-modelo-windows-a-configuração-com-createprocess"><span class="header-section-number">5.0.3</span> O Modelo Windows: A Configuração com CreateProcess</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/frankalcantara/linefollower/edit/main/gerproc1.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/frankalcantara/linefollower/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./gerproc.html">Gerenciamento de Processos: Introdução</a></li><li class="breadcrumb-item"><a href="./gerproc1.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Criando Processos de Forma Programática: O Modelo Linux</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Criando Processos de Forma Programática: O Modelo Linux</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Até a esforçada leitora estudou a anatomia de um processo, seu ciclo de vida, e viu como podemos listar os processos existentes em um <strong>Sistema Operacional</strong>. Vimos que um clique duplo em um ícone ou a execução de um comando em um terminal são ações de alto nível que resultam na criação de um novo processo. Mas como o <strong>Sistema Operacional</strong> realmente executa essa mágica? Como ele pode criar processos? A resposta, como a perspicaz leitora já deve suspeitar, reside em um conjunto de chamadas de sistema, as interfaces programáticas que o <code>Kernel</code> oferece aos programas de usuário. Nesta seção, vamos explorar como criar processos de forma programática, tanto no <strong>Linux</strong> quanto no Windows, e entender as diferenças fundamentais entre esses dois mundos.</p>
<p>Criar um processo de forma programática é uma das tarefas mais fundamentais em programação de sistemas. É o que permite que um servidor web inicie processos de trabalho para lidar com requisições, que um compilador chame o <code>linker</code>, que um <code>shell</code> execute os comandos que você digita. No entanto, os conceitos e as filosofias por trás dessa criação diferem drasticamente entre os mundos <strong>Linux</strong> e Windows, refletindo seus legados e suas prioridades de design.</p>
<section id="filosofias-de-design-dois-paradigmas-duas-visões" class="level3" data-number="5.0.1">
<h3 data-number="5.0.1" class="anchored" data-anchor-id="filosofias-de-design-dois-paradigmas-duas-visões"><span class="header-section-number">5.0.1</span> Filosofias de Design: Dois Paradigmas, Duas Visões</h3>
<p>A diferença entre os modelos de criação de processos do <strong>Linux</strong> e <strong>Windows</strong> transcende aspectos meramente técnicos, refletindo filosofias fundamentalmente distintas de design de <strong>Sistemas Operacionais</strong>. Estas filosofias, forjadas por contextos históricos e objetivos diferentes, moldam não apenas como processos são criados, mas como desenvolvedores pensam sobre abstrações de sistema.</p>
<section id="a-herança-unix-simplicidade-ortogonalidade-e-composição" class="level4" data-number="5.0.1.1">
<h4 data-number="5.0.1.1" class="anchored" data-anchor-id="a-herança-unix-simplicidade-ortogonalidade-e-composição"><span class="header-section-number">5.0.1.1</span> A Herança UNIX: Simplicidade, Ortogonalidade e Composição</h4>
<p>O modelo <strong>fork()/exec()</strong> do <strong>Linux</strong> herda diretamente a filosofia <strong>UNIX</strong>, articulada na década de 1970 por <a href="https://en.wikipedia.org/wiki/Ken_Thompson">Ken Thompson</a>, <a href="https://en.wikipedia.org/wiki/Dennis_Ritchie">Dennis Ritchie</a> e seus colegas nos Bell Labs. O modelo <code>fork()/exec()</code> emergiu em um contexto de recursos limitados, PDP-11 com 64KB de memória, mas com necessidades de multitarefa. A separação conceitual permitiu que fosse atingido um grau significativo, para época, de eficiência de memória, graças ao <strong>CoW</strong> que minimiza uso de memória. Também existiram ganhos de flexibilidade nos processos de <code>E/S</code> e, finalmente, uma simplicidade de implementação que favoreceu a manutenção e evolução do <code>kernel</code>.</p>
<p>A filosofia que suporta o modelo <code>fork()/exec()</code> pode ser resumida em três princípios fundamentais:</p>
<ol type="1">
<li><p><strong>Princípio da Responsabilidade Única</strong>: cada ferramenta deve fazer uma coisa e fazê-la bem. No contexto de processos, <code>fork()</code> tem uma única responsabilidade: criar uma cópia do processo atual. <code>exec()</code> tem outra responsabilidade distinta: substituir a imagem do processo por um novo programa.</p></li>
<li><p><strong>Princípio da Ortogonalidade</strong>: funcionalidades independentes devem ser implementadas de forma independente. <code>fork()</code> e <code>exec()</code> são operações ortogonais que podem ser combinadas de maneiras imprevistas pelos criadores originais. Esta separação permite, por exemplo, que um processo filho modifique seus descritores de arquivo antes de executar <code>exec()</code>, possibilitando redirecionamento de <code>E/S</code>.</p></li>
<li><p><strong>Princípio da Composição</strong>: ferramentas simples devem poder ser combinadas para criar funcionalidades complexas. O modelo <code>fork()/exec()</code> permite composições sofisticadas como pipelines, onde múltiplos processos são criados e conectados através de pipes.</p></li>
</ol>
</section>
<section id="a-visão-windows-configuração-completude-e-determinismo" class="level4" data-number="5.0.1.2">
<h4 data-number="5.0.1.2" class="anchored" data-anchor-id="a-visão-windows-configuração-completude-e-determinismo"><span class="header-section-number">5.0.1.2</span> A Visão Windows: Configuração, Completude e Determinismo</h4>
<p>O modelo <code>CreateProcess</code> do <strong>Windows</strong> reflete uma filosofia diferente, moldada pelas necessidades de um <strong>Sistema Operacional</strong> comercial projetado para facilidade de uso e robustez. A atenta leitora não pode esquecer que o <strong>Windows</strong> NT foi projetado para ser comercialmente robusto e atrativo. O modelo <code>CreateProcess</code> também pode ser resumido em três princípios:</p>
<ol type="1">
<li><p><strong>Princípio da Configuração Determinística</strong>: O estado inicial de um processo deve ser completamente especificável no momento da criação. <code>CreateProcess</code> permite que o processo pai defina precisamente como o filho deve iniciar, incluindo visibilidade de janela, prioridade, ambiente, e redirecionamentos de <code>E/S</code>.</p></li>
<li><p><strong>Princípio da Atomicidade</strong>: Operações críticas devem ser atômicas para evitar estados inconsistentes. A criação de processo é uma operação única que ou sucede completamente ou falha, sem deixar o sistema em um estado intermediário.</p></li>
<li><p><strong>Princípio da Completude</strong>: <code>APIs</code>devem fornecer controle completo sobre os recursos que gerenciam. <code>CreateProcess</code> oferece controle granular sobre quase todos os aspectos da criação de processo através de suas estruturas de parâmetros.</p></li>
</ol>
</section>
<section id="implicações-práticas-das-filosofias" class="level4" data-number="5.0.1.3">
<h4 data-number="5.0.1.3" class="anchored" data-anchor-id="implicações-práticas-das-filosofias"><span class="header-section-number">5.0.1.3</span> Implicações Práticas das Filosofias</h4>
<p>A diferença filosófica se manifesta claramente na implementação de <code>shell</code>s de comando. Enquanto <strong>Shells UNIX/Linux</strong> podem implementar pipelines e redirecionamento de forma natural:</p>
<pre class="pseudocode"><code>// Pseudocódigo para "cmd1 | cmd2 &gt; output.txt"
pipe(fd);
if (fork() == 0) {
    // Filho 1: cmd1
    close(fd[0]);
    dup2(fd[1], STDOUT_FILENO);
    close(fd[1]);
    exec("cmd1");
}
if (fork() == 0) {
    // Filho 2: cmd2
    close(fd[1]);
    dup2(fd[0], STDIN_FILENO);
    close(fd[0]);
    int outfd = open("output.txt", O_WRONLY|O_CREAT);
    dup2(outfd, STDOUT_FILENO);
    exec("cmd2");
}</code></pre>
<p>Os <strong>Shells Windows</strong> requerem configuração prévia mais complexa através de <code>STARTUPINFO</code>:</p>
<pre class="pseudocode"><code>// Configuração mais verbosa necessária
STARTUPINFO si1, si2;
// ... configuração detalhada de pipes e redirecionamentos
// em estruturas antes da criação dos processos
CreateProcess(..., &amp;si1, ...);
CreateProcess(..., &amp;si2, ...);</code></pre>
<p>As diferenças filosóficas também terão impacto no desenvolvimento de servidores. Enquanto o <strong>Modelo Linux</strong> favorece servidores que fazem fork por requisição:</p>
<pre class="pseudocode"><code>while (true) {
    int client = accept(server_socket);
    if (fork() == 0) {
        // Processo filho específico para este cliente
        close(server_socket);
        handle_client(client);
        exit(0);
    }
    close(client);
}</code></pre>
<p>O <strong>Modelo Windows</strong> favorece arquiteturas baseadas em <code>threads</code> ou <code>E/s</code> assíncrono:</p>
<pre class="pseudocode"><code>// Criar novo processo por requisição
// Preferência por thread pools ou completion ports
HANDLE completionPort = CreateIoCompletionPort(...);
while (true) {
    OVERLAPPED* overlapped;
    GetQueuedCompletionStatus(completionPort, &amp;overlapped, ...);
    // Processa requisição em thread pool
}</code></pre>
</section>
<section id="síntese-e-filosofias-de-design-convergência-e-divergência" class="level4" data-number="5.0.1.4">
<h4 data-number="5.0.1.4" class="anchored" data-anchor-id="síntese-e-filosofias-de-design-convergência-e-divergência"><span class="header-section-number">5.0.1.4</span> Síntese e Filosofias de Design: Convergência e Divergência</h4>
<p>Ao longo desta seção, a arguta leitora pode ter tido a impressão de que os mundos <strong>Linux</strong> e <strong>Windows</strong> são universos paralelos, destinados a nunca se encontrar. Contudo, o cenário da computação moderna é mais fluido, e nos últimos anos temos observado uma fascinante convergência em certas áreas. As tecnologias de contêineres no <strong>Linux</strong>, por exemplo, embora baseadas em primitivas do <code>Kernel</code> como <code>namespaces</code> e <code>cgroups</code>, são frequentemente gerenciadas por ferramentas com uma abordagem mais voltada a facilidade de configuração e adaptação, como os manifestos declarativos. Do outro lado do espectro, o <strong>W</strong>indows <strong>S</strong>ubsystem for <strong>L</strong>inux, <strong>WSL</strong>, representa um passo monumental da Microsoft em direção à interoperabilidade, integrando um ambiente <strong>UNIX</strong> quase completo dentro do <strong>Windows</strong>. Até mesmo no coração do <strong>Linux</strong>, a ascensão do <code>systemd</code> como gerenciador de serviços e inicialização introduziu um modelo de gerenciamento mais centralizado e determinístico, afastando-se da simplicidade dos scripts <code>shell</code> tradicionais do <a href="https://en.wikipedia.org/wiki/UNIX_System_V">System V</a>.</p>
<p>Apesar dessa aproximação, seria um engano declarar o fim das diferenças. As divergências fundamentais persistem, pois estão enraizadas em filosofias de design profundamente distintas. A começar pela filosofia de tratamento de erros: o <strong>Linux</strong>, herdeiro da tradição <strong>UNIX</strong>, geralmente favorece o <code>fail-fast</code>, no qual um componente falha de forma rápida e visível. O <strong>Windows</strong>, por outro lado, muitas vezes se esforça para conseguir uma <code>degradação graciosa</code>, tentando manter a aplicação ou o sistema em funcionamento, mesmo que em um estado limitado. A modularidade é outro ponto de contraste: o ecossistema <strong>Linux</strong> preza por processos pequenos e especializados, enquanto aplicações <strong>Windows</strong> tendem a ser mais monolíticas, utilizando <code>threads</code> para concorrência interna. Por fim, a abordagem de configuração permanece um divisor de águas: o <strong>Linux</strong> confia em arquivos de texto simples e legíveis por humanos, enquanto o <strong>Windows</strong> centraliza a configuração em bancos de dados como o <strong>Registry</strong> e a expõe através de <strong>API</strong>s complexas.</p>
<p>Essas divergências são a manifestação de duas visões de mundo distintas. A essência do modelo <strong>UNIX</strong> reside em seus três pilares: <strong>ortogonalidade</strong>, <strong>simplicidade</strong> e <strong>composição</strong>. As primitivas, como <code>fork()</code>, <code>exec()</code> e <code>pipes</code>, são simples e independentes umas das outras. Essa simplicidade facilita o raciocínio sobre o comportamento do sistema. E é a capacidade de compor essas ferramentas ortogonais que gera uma funcionalidade emergente e poderosa, permitindo usos que seus criadores originais talvez nem tivessem previsto.</p>
<p>Em contrapartida, o modelo do <strong>Windows</strong> é construído sobre os pilares do <strong>determinismo</strong>, da <strong>configuração rica</strong> e da <strong>atomicidade</strong>. A <code>atomicidade</code> de chamadas como <code>CreateProcess</code> garante que a criação de um processo seja uma operação de tudo ou nada, o que simplifica o tratamento de erros e aumenta a previsibilidade. Esse é o <strong>determinismo</strong> do sistema. A <strong>API</strong> oferece uma <strong>configuração rica</strong> e explícita, que, embora complexa, reduz a quantidade de código repetitivo <code>boilerplate</code>, que o desenvolvedor precisa escrever para configurar o ambiente de um novo processo. A escolha entre os dois modelos, portanto, não é uma questão de superioridade, mas sim um reflexo de qual conjunto de compromissos, flexibilidade composicional ou robustez configuracional, é mais valorizado.</p>
<p>A <a href="#tbl-linux-windows-summary" class="quarto-xref">Table&nbsp;<span>5.1</span></a> resume as principais diferenças entre os dois modelos.</p>
<div id="tbl-linux-windows-summary" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-linux-windows-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.1: Filosofias de criação de processos entre Linux e Windows
</figcaption>
<div aria-describedby="tbl-linux-windows-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 35%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th>Dimensão</th>
<th><strong>Linux</strong> (fork/exec)</th>
<th><strong>Windows</strong> (CreateProcess)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Filosofia de Design</strong></td>
<td>Composicional, minimalista</td>
<td>Configuracional, abrangente</td>
</tr>
<tr class="even">
<td><strong>Unidades de Abstração</strong></td>
<td>Operações ortogonais separadas</td>
<td>Operação monolítica configurável</td>
</tr>
<tr class="odd">
<td><strong>Flexibilidade Temporal</strong></td>
<td>Janela entre fork/exec para customização</td>
<td>Configuração prévia à criação</td>
</tr>
<tr class="even">
<td><strong>Modelo Mental</strong></td>
<td>Clonagem + substituição</td>
<td>Instanciação configurada</td>
</tr>
<tr class="odd">
<td><strong>Tratamento de Erro</strong></td>
<td>Falhas em pontos distintos</td>
<td>Falha ou sucesso atômico</td>
</tr>
<tr class="even">
<td><strong>Overhead Conceitual</strong></td>
<td>Baixo (2 conceitos simples)</td>
<td>Alto (estruturas complexas)</td>
</tr>
<tr class="odd">
<td><strong>Poder Expressivo</strong></td>
<td>Alto através de composição</td>
<td>Alto através de configuração</td>
</tr>
<tr class="even">
<td><strong>Previsibilidade</strong></td>
<td>Comportamento emergente</td>
<td>Comportamento determinístico</td>
</tr>
<tr class="odd">
<td><strong>Curva de Aprendizado</strong></td>
<td>Íngreme inicialmente, platô baixo</td>
<td>Gradual, platô alto</td>
</tr>
<tr class="even">
<td><strong>Debugging</strong></td>
<td>Pontos de falha isolados</td>
<td>Diagnóstico de configuração complexa</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Ambas as abordagens são válidas e refletem os contextos históricos, técnicos e comerciais em que evoluíram. A compreensão profunda dessas filosofias permite que desenvolvedores não apenas utilizem as APIs, mas pensem de forma nativa sobre problemas em cada plataforma, aproveitando as forças inerentes de cada modelo para criar software mais elegante e eficiente.</p>
</section>
</section>
<section id="o-modelo-linux-a-composição-de-fork-e-exec" class="level3" data-number="5.0.2">
<h3 data-number="5.0.2" class="anchored" data-anchor-id="o-modelo-linux-a-composição-de-fork-e-exec"><span class="header-section-number">5.0.2</span> O Modelo Linux: A Composição de <code>fork()</code> e <code>exec()</code></h3>
<p>O universo <strong>UNIX</strong>, e por herança <strong>Linux</strong>, adota um modelo elegante para a criação de processos, baseado na composição de duas ações ortogonais: clonar e substituir. Este paradigma é realizado através de duas famílias de chamadas de sistema: <code>fork()</code> e <code>exec()</code>.</p>
<ol type="1">
<li><p><strong><code>fork()</code>: A Clonagem do Processo</strong>: a chamada de sistema <code>fork()</code> é o único método para criar um novo processo no Linux. Esta chamada cria um processo filho que será uma cópia quase exata do processo pai que a invocou. O filho herda o espaço de endereçamento do pai (código, dados, pilha), descritores de arquivos abertos, e outras informações de contexto. Para tornar esta operação eficiente, os sistemas modernos implementam <code>fork()</code> usando a técnica <strong>C</strong>opy-<strong>o</strong>n-<strong>W</strong>rite, <strong>COW</strong>, o inglês para copiar ao escrever. Com <strong>COW</strong>, o espaço de endereçamento não é fisicamente duplicado. Em vez disso, pai e filho compartilham as mesmas páginas de memória, que são marcadas como somente leitura. Uma cópia física da página só é criada quando um dos processos tenta escrever nela, tornando a chamada <code>fork()</code> extremamente rápida.</p>
<p>A genialidade do <code>fork()</code> está em seu valor de retorno:</p>
<ul>
<li>no processo <strong>pai</strong>, <code>fork()</code> retorna o <strong>PID</strong> (ID do Processo) do filho recém-criado;</li>
<li>no processo <strong>filho</strong>, <code>fork()</code> retorna <strong>0</strong>;</li>
<li>se a criação falhar, <code>fork()</code> retorna <strong>-1</strong>.</li>
</ul>
<p>Essa diferença no valor de retorno permite que o programa, após a chamada, siga caminhos de execução diferentes dependendo se ele é o pai ou o filho.</p></li>
<li><p><strong><code>exec()</code>: A Substituição da Imagem do Processo</strong>: após o <code>fork()</code>, o processo filho geralmente precisa executar um programa diferente. A família de chamadas de sistema <code>exec</code> (como <code>execvp</code>, <code>execl</code>, <code>execve</code>) serve a este propósito. Uma chamada <code>exec</code> substitui completamente a imagem de memória do processo atual pelo novo programa especificado, carregando seus segmentos de texto, dados e <code>BSS</code> do arquivo executável. O <strong>PID</strong> do processo não muda, pois nenhum novo processo é criado; o processo existente é simplesmente transformado. Se a chamada <code>exec</code> for bem-sucedida, ela <strong>nunca retorna</strong> ao código que a cham , pois esse código foi substituído.</p></li>
</ol>
<p>A separação entre <code>fork()</code> e <code>exec()</code> é a base da flexibilidade do <code>shell</code> <strong>UNIX</strong>. Essa separação cria uma janela de oportunidade na qual o processo filho, antes de se transformar no novo programa com <code>exec()</code>, pode manipular seu próprio ambiente, como redirecionar a entrada e saída padrão (<code>stdin</code>, <code>stdout</code>) para implementar <code>pipes</code> e redirecionamentos de arquivo.</p>
<p>Para garantir a sincronia, o processo pai geralmente usa chamadas como <code>wait()</code> ou <code>waitpid()</code> para aguardar a terminação do filho. Isso não só permite a sincronização, mas também é o mecanismo pelo qual o pai recupera o status de saída do filho, evitando que este se torne um processo zumbi.</p>
<p>Vai ficar mais claro se a esforçada leitora tentar um exemplo em C++23. O <a href="#lst-cpplinux-create" class="quarto-xref">Listing&nbsp;<span>5.1</span></a> demonstra o ciclo completo <code>fork-exec-wait</code>.</p>
<div id="lst-cpplinux-create" class="listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst quarto-uncaptioned" id="lst-cpplinux-create-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;5.1
</figcaption>
<div aria-describedby="lst-cpplinux-create-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="lst-cpplinux-create"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-cpplinux-create-1"><a href="#lst-cpplinux-create-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-cpplinux-create-2"><a href="#lst-cpplinux-create-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@file</span><span class="co"> </span><span class="cv">process_linux_create.cpp</span></span>
<span id="lst-cpplinux-create-3"><a href="#lst-cpplinux-create-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstração da criação de processos no **Linux** com fork() e execvp().</span></span>
<span id="lst-cpplinux-create-4"><a href="#lst-cpplinux-create-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@author</span><span class="co"> Livro de Sistemas Operacionais</span></span>
<span id="lst-cpplinux-create-5"><a href="#lst-cpplinux-create-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@version</span><span class="co"> </span><span class="cv">1.0</span></span>
<span id="lst-cpplinux-create-6"><a href="#lst-cpplinux-create-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@date</span><span class="co"> 2025</span></span>
<span id="lst-cpplinux-create-7"><a href="#lst-cpplinux-create-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="lst-cpplinux-create-8"><a href="#lst-cpplinux-create-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * Este programa demonstra o paradigma fork-exec-wait. O processo pai</span></span>
<span id="lst-cpplinux-create-9"><a href="#lst-cpplinux-create-9" aria-hidden="true" tabindex="-1"></a><span class="co"> * cria um filho, que por sua vez se substitui pelo comando 'ls -l /tmp'.</span></span>
<span id="lst-cpplinux-create-10"><a href="#lst-cpplinux-create-10" aria-hidden="true" tabindex="-1"></a><span class="co"> * O pai espera a conclusão do filho e imprime seu status de saída.</span></span>
<span id="lst-cpplinux-create-11"><a href="#lst-cpplinux-create-11" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-cpplinux-create-12"><a href="#lst-cpplinux-create-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-13"><a href="#lst-cpplinux-create-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-cpplinux-create-14"><a href="#lst-cpplinux-create-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span>
<span id="lst-cpplinux-create-15"><a href="#lst-cpplinux-create-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string&gt;</span></span>
<span id="lst-cpplinux-create-16"><a href="#lst-cpplinux-create-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span><span class="pp">      </span><span class="co">// Para fork(), execvp(), getpid()</span></span>
<span id="lst-cpplinux-create-17"><a href="#lst-cpplinux-create-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span><span class="pp">    </span><span class="co">// Para waitpid()</span></span>
<span id="lst-cpplinux-create-18"><a href="#lst-cpplinux-create-18" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;system_error&gt;</span><span class="pp">  </span><span class="co">// Para std::error_code</span></span>
<span id="lst-cpplinux-create-19"><a href="#lst-cpplinux-create-19" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span><span class="pp">       </span><span class="co">// Para strerror</span></span>
<span id="lst-cpplinux-create-20"><a href="#lst-cpplinux-create-20" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;format&gt;</span><span class="pp">        </span><span class="co">// Para std::format</span></span>
<span id="lst-cpplinux-create-21"><a href="#lst-cpplinux-create-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-22"><a href="#lst-cpplinux-create-22" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-cpplinux-create-23"><a href="#lst-cpplinux-create-23" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Ponto de entrada principal do programa.</span></span>
<span id="lst-cpplinux-create-24"><a href="#lst-cpplinux-create-24" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-cpplinux-create-25"><a href="#lst-cpplinux-create-25" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-cpplinux-create-26"><a href="#lst-cpplinux-create-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"Processo pai (PID: </span><span class="sc">{}</span><span class="st">) iniciando...</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> getpid<span class="op">());</span></span>
<span id="lst-cpplinux-create-27"><a href="#lst-cpplinux-create-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-28"><a href="#lst-cpplinux-create-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// A chamada de sistema fork() cria um novo processo.</span></span>
<span id="lst-cpplinux-create-29"><a href="#lst-cpplinux-create-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pid_t</span> <span class="op">**</span>PID<span class="op">**</span> <span class="op">=</span> fork<span class="op">();</span></span>
<span id="lst-cpplinux-create-30"><a href="#lst-cpplinux-create-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-31"><a href="#lst-cpplinux-create-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-cpplinux-create-32"><a href="#lst-cpplinux-create-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// **PID** &lt; 0: Ocorreu um erro ao criar o processo filho.</span></span>
<span id="lst-cpplinux-create-33"><a href="#lst-cpplinux-create-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cerr <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"Falha no fork: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> <span class="bu">std::</span>strerror<span class="op">(</span>errno<span class="op">));</span></span>
<span id="lst-cpplinux-create-34"><a href="#lst-cpplinux-create-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="lst-cpplinux-create-35"><a href="#lst-cpplinux-create-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-cpplinux-create-36"><a href="#lst-cpplinux-create-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-37"><a href="#lst-cpplinux-create-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-cpplinux-create-38"><a href="#lst-cpplinux-create-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// --- CÓDIGO DO PROCESSO FILHO ---</span></span>
<span id="lst-cpplinux-create-39"><a href="#lst-cpplinux-create-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// **PID** == 0: Este bloco de código é executado apenas pelo processo filho.</span></span>
<span id="lst-cpplinux-create-40"><a href="#lst-cpplinux-create-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"Processo filho (PID: </span><span class="sc">{}</span><span class="st">) executando.</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> getpid<span class="op">());</span></span>
<span id="lst-cpplinux-create-41"><a href="#lst-cpplinux-create-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Filho irá executar 'ls -l /tmp'...</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-cpplinux-create-42"><a href="#lst-cpplinux-create-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-43"><a href="#lst-cpplinux-create-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Prepara os argumentos para execvp.</span></span>
<span id="lst-cpplinux-create-44"><a href="#lst-cpplinux-create-44" aria-hidden="true" tabindex="-1"></a>        <span class="co">// O primeiro argumento é o nome do programa a ser executado.</span></span>
<span id="lst-cpplinux-create-45"><a href="#lst-cpplinux-create-45" aria-hidden="true" tabindex="-1"></a>        <span class="co">// A lista de argumentos deve ser terminada com um ponteiro nulo.</span></span>
<span id="lst-cpplinux-create-46"><a href="#lst-cpplinux-create-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;</span> args<span class="op">;</span></span>
<span id="lst-cpplinux-create-47"><a href="#lst-cpplinux-create-47" aria-hidden="true" tabindex="-1"></a>        args<span class="op">.</span>push_back<span class="op">(</span><span class="kw">const_cast</span><span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;(</span><span class="st">"ls"</span><span class="op">));</span></span>
<span id="lst-cpplinux-create-48"><a href="#lst-cpplinux-create-48" aria-hidden="true" tabindex="-1"></a>        args<span class="op">.</span>push_back<span class="op">(</span><span class="kw">const_cast</span><span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;(</span><span class="st">"-l"</span><span class="op">));</span></span>
<span id="lst-cpplinux-create-49"><a href="#lst-cpplinux-create-49" aria-hidden="true" tabindex="-1"></a>        args<span class="op">.</span>push_back<span class="op">(</span><span class="kw">const_cast</span><span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;(</span><span class="st">"/tmp"</span><span class="op">));</span></span>
<span id="lst-cpplinux-create-50"><a href="#lst-cpplinux-create-50" aria-hidden="true" tabindex="-1"></a>        args<span class="op">.</span>push_back<span class="op">(</span><span class="kw">nullptr</span><span class="op">);</span></span>
<span id="lst-cpplinux-create-51"><a href="#lst-cpplinux-create-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-52"><a href="#lst-cpplinux-create-52" aria-hidden="true" tabindex="-1"></a>        <span class="co">// execvp substitui a imagem do processo atual pelo novo programa.</span></span>
<span id="lst-cpplinux-create-53"><a href="#lst-cpplinux-create-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Se for bem-sucedido, esta função NUNCA retorna.</span></span>
<span id="lst-cpplinux-create-54"><a href="#lst-cpplinux-create-54" aria-hidden="true" tabindex="-1"></a>        execvp<span class="op">(</span>args<span class="op">[</span><span class="dv">0</span><span class="op">],</span> args<span class="op">.</span>data<span class="op">());</span></span>
<span id="lst-cpplinux-create-55"><a href="#lst-cpplinux-create-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-56"><a href="#lst-cpplinux-create-56" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Este código só é executado se execvp falhar.</span></span>
<span id="lst-cpplinux-create-57"><a href="#lst-cpplinux-create-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cerr <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"Falha no execvp no processo filho: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> <span class="bu">std::</span>strerror<span class="op">(</span>errno<span class="op">));</span></span>
<span id="lst-cpplinux-create-58"><a href="#lst-cpplinux-create-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">// É fundamental sair em caso de falha para não continuar executando o código do pai.</span></span>
<span id="lst-cpplinux-create-59"><a href="#lst-cpplinux-create-59" aria-hidden="true" tabindex="-1"></a>        _exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="lst-cpplinux-create-60"><a href="#lst-cpplinux-create-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-61"><a href="#lst-cpplinux-create-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-cpplinux-create-62"><a href="#lst-cpplinux-create-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">// --- CÓDIGO DO PROCESSO PAI ---</span></span>
<span id="lst-cpplinux-create-63"><a href="#lst-cpplinux-create-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">// **PID** &gt; 0: Este bloco é executado pelo pai, e 'pid' contém o **PID** do filho.</span></span>
<span id="lst-cpplinux-create-64"><a href="#lst-cpplinux-create-64" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"Pai (PID: </span><span class="sc">{}</span><span class="st">) criou o filho com PID: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> getpid<span class="op">(),</span> pid<span class="op">);</span></span>
<span id="lst-cpplinux-create-65"><a href="#lst-cpplinux-create-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Pai esperando o filho terminar...</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-cpplinux-create-66"><a href="#lst-cpplinux-create-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-67"><a href="#lst-cpplinux-create-67" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> status<span class="op">;</span></span>
<span id="lst-cpplinux-create-68"><a href="#lst-cpplinux-create-68" aria-hidden="true" tabindex="-1"></a>        <span class="co">// waitpid espera por uma mudança de estado no filho especificado.</span></span>
<span id="lst-cpplinux-create-69"><a href="#lst-cpplinux-create-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">// O ponteiro para 'status' receberá informações sobre a terminação.</span></span>
<span id="lst-cpplinux-create-70"><a href="#lst-cpplinux-create-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>waitpid<span class="op">(</span>pid<span class="op">,</span> <span class="op">&amp;</span>status<span class="op">,</span> <span class="dv">0</span><span class="op">)</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-cpplinux-create-71"><a href="#lst-cpplinux-create-71" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cerr <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"Falha no waitpid: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> <span class="bu">std::</span>strerror<span class="op">(</span>errno<span class="op">));</span></span>
<span id="lst-cpplinux-create-72"><a href="#lst-cpplinux-create-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="lst-cpplinux-create-73"><a href="#lst-cpplinux-create-73" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-cpplinux-create-74"><a href="#lst-cpplinux-create-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-75"><a href="#lst-cpplinux-create-75" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Analisa o status de saída do filho.</span></span>
<span id="lst-cpplinux-create-76"><a href="#lst-cpplinux-create-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>WIFEXITED<span class="op">(</span>status<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-cpplinux-create-77"><a href="#lst-cpplinux-create-77" aria-hidden="true" tabindex="-1"></a>            <span class="co">// O filho terminou normalmente via exit() ou _exit().</span></span>
<span id="lst-cpplinux-create-78"><a href="#lst-cpplinux-create-78" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> exit_code <span class="op">=</span> WEXITSTATUS<span class="op">(</span>status<span class="op">);</span></span>
<span id="lst-cpplinux-create-79"><a href="#lst-cpplinux-create-79" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Pai: Filho terminou com o código de saída: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> exit_code<span class="op">);</span></span>
<span id="lst-cpplinux-create-80"><a href="#lst-cpplinux-create-80" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>WIFSIGNALED<span class="op">(</span>status<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-cpplinux-create-81"><a href="#lst-cpplinux-create-81" aria-hidden="true" tabindex="-1"></a>            <span class="co">// O filho foi terminado por um sinal.</span></span>
<span id="lst-cpplinux-create-82"><a href="#lst-cpplinux-create-82" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> term_signal <span class="op">=</span> WTERMSIG<span class="op">(</span>status<span class="op">);</span></span>
<span id="lst-cpplinux-create-83"><a href="#lst-cpplinux-create-83" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Pai: Filho foi terminado pelo sinal: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> term_signal<span class="op">);</span></span>
<span id="lst-cpplinux-create-84"><a href="#lst-cpplinux-create-84" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-cpplinux-create-85"><a href="#lst-cpplinux-create-85" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st">Pai: Filho terminou de forma anormal.</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-cpplinux-create-86"><a href="#lst-cpplinux-create-86" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-cpplinux-create-87"><a href="#lst-cpplinux-create-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-cpplinux-create-88"><a href="#lst-cpplinux-create-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cpplinux-create-89"><a href="#lst-cpplinux-create-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-cpplinux-create-90"><a href="#lst-cpplinux-create-90" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<p>O código em <a href="#lst-cpplinux-create" class="quarto-xref">Listing&nbsp;<span>5.1</span></a> encapsula o ciclo de vida da criação de processos no Linux. A chamada fork() divide o fluxo de execução em dois. O processo filho, identificado por <strong>PID</strong> == 0, prepara um std::vector de ponteiros para char para os argumentos do comando ls e chama execvp(). Esta função procura pelo executável ls no PATH do sistema e, se encontrar, sobrepõe o processo filho com ele. O processo pai, por sua vez, entra no bloco else, onde usa waitpid(pid, &amp;status, 0) para se suspender até que o processo filho (cujo <strong>PID</strong> ele conhece) termine. Uma vez que o filho termina, o pai acorda e usa as macros WIFEXITED e WEXITSTATUS para inspecionar a variável status e determinar se o filho concluiu com sucesso.</p>
<section id="hierarquia-de-processos-e-controle-de-ambiente-no-linux" class="level4" data-number="5.0.2.1">
<h4 data-number="5.0.2.1" class="anchored" data-anchor-id="hierarquia-de-processos-e-controle-de-ambiente-no-linux"><span class="header-section-number">5.0.2.1</span> Hierarquia de Processos e Controle de Ambiente no Linux</h4>
<p>O modelo de processos do <strong>Linux</strong> oferece mecanismos sofisticados para organização hierárquica e controle de ambiente que vão além da simples relação pai-filho. Dois conceitos fundamentais emergem: <strong>Process Groups</strong> e <strong>Sessions</strong>, que formam a base do controle de tarefas (<code>job control</code>) implementado pelos shells modernos.</p>
<section id="process-groups-agrupamento-lógico-de-processos" class="level5" data-number="5.0.2.1.1">
<h5 data-number="5.0.2.1.1" class="anchored" data-anchor-id="process-groups-agrupamento-lógico-de-processos"><span class="header-section-number">5.0.2.1.1</span> Process Groups: Agrupamento Lógico de Processos</h5>
<p>Um <strong>Process Group</strong> é uma coleção de processos relacionados que podem ser tratados como uma unidade para propósitos de sinalização. Todo processo pertence exatamente a um group, identificado por um <strong>Process Group ID (PGID)</strong>. O processo cujo <strong>PID</strong> é igual ao <strong>PGID</strong> é denominado <strong>process group leader</strong>.</p>
<p>Process groups são fundamentais para implementar pipelines de comandos. Quando um shell executa <code>ls | grep txt | sort</code>, os três processos são colocados no mesmo process group, permitindo que sinais como <code>SIGINT</code> (Ctrl+C) sejam enviados para todos simultaneamente.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Sinais?</strong> Pense nos sinais como um sistema de <strong>notificações de emergência</strong> para processos. Os sinais são uma forma de comunicação assíncrona, o que significa que um processo pode ser interrompido a qualquer momento para ser notificado de um evento importante. É como o alarme de incêndio de um prédio: não importa o que você esteja fazendo, quando ele toca, você precisa reagir imediatamente.</p>
<p>Formalmente, <strong>um sinal é uma notificação de software enviada a um processo pelo <code>kernel</code> para informá-lo de que um evento ocorreu</strong>. Esses eventos podem ser gerados por um usuário ao pressionar combinações de teclas no terminal, como <code>Ctrl+C</code> ou <code>Ctrl+Z</code>. Os sinais também podem ser emitidos pelo próprio <code>Kernel</code> para notificar o processo de um erro grave, como uma divisão por zero ou um acesso a uma área de memória inválida, o que gera uma <strong>Segmentation Fault</strong>. Além disso, Um processo pode enviar um sinal para outro (se tiver permissão) usando a chamada de sistema <code>kill()</code>.</p>
<p>Quando um processo recebe um sinal, ele precisa tomar uma atitude chamada de disposição, em inglês <em>disposition</em>, e há três opções:</p>
<ol type="1">
<li><p><strong>Executar a Ação Padrão</strong>: cada sinal tem uma ação padrão definida pelo <code>Kernel</code>. Para muitos sinais, a ação padrão é simplesmente terminar o processo. Para outros, pode ser ignorar o sinal ou suspender o processo.</p></li>
<li><p><strong>Ignorar o Sinal</strong>: o processo pode explicitamente instruir o <code>Kernel</code> a ignorar o sinal. A notificação é recebida e descartada, e o processo continua sua execução como se nada tivesse acontecido.</p></li>
<li><p><strong>Capturar o Sinal</strong>: esta é a opção mais poderosa. O processo pode registrar uma função especial, chamada de manipulador de sinal, em inglês <em>signal handler</em>, que será executada quando o sinal for recebido. Isso permite que o programa intercepte o evento e execute uma lógica customizada.</p></li>
</ol>
</div>
</div>
<p>As funções principais para manipulação de <em>process groups</em> são:</p>
<ul>
<li><code>setpgid(pid, pgid)</code>: move o processo <code>pid</code> para o process group <code>pgid</code></li>
<li><code>getpgid(pid)</code>: retorna o <strong>PGID</strong> do processo <code>pid</code></li>
<li><code>getpgrp()</code>: retorna o <strong>PGID</strong> do processo atual</li>
</ul>
</section>
<section id="sessions-isolamento-e-controle-de-terminal" class="level5" data-number="5.0.2.1.2">
<h5 data-number="5.0.2.1.2" class="anchored" data-anchor-id="sessions-isolamento-e-controle-de-terminal"><span class="header-section-number">5.0.2.1.2</span> Sessions: Isolamento e Controle de Terminal</h5>
<p>Uma <strong>Session</strong> é uma coleção de process groups, tipicamente associada a um terminal de controle. Sessions proporcionam isolamento entre diferentes contextos de execução. O processo que cria uma nova session torna-se o <strong>session leader</strong>.</p>
<p>A função <code>setsid()</code> cria uma nova session, remove o processo de seu terminal de controle atual, e o torna session leader. Esta operação é fundamental na criação de daemons, processos que executam em background sem associação a terminal.</p>
</section>
<section id="exemplo-prático-implementando-job-control" class="level5" data-number="5.0.2.1.3">
<h5 data-number="5.0.2.1.3" class="anchored" data-anchor-id="exemplo-prático-implementando-job-control"><span class="header-section-number">5.0.2.1.3</span> Exemplo Prático: Implementando Job Control</h5>
<p>O <a href="#lst-linux-job-control" class="quarto-xref">Listing&nbsp;<span>5.2</span></a> demonstra uma implementação simplificada de job control, mostrando como <em>process groups</em> e sessions podem ser utilizados para gerenciar tarefas em background e foreground.</p>
<div id="lst-linux-job-control" class="listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst quarto-uncaptioned" id="lst-linux-job-control-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;5.2
</figcaption>
<div aria-describedby="lst-linux-job-control-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="lst-linux-job-control"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-linux-job-control-1"><a href="#lst-linux-job-control-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-job-control-2"><a href="#lst-linux-job-control-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@file</span><span class="co"> </span><span class="cv">linux_job_control.cpp</span></span>
<span id="lst-linux-job-control-3"><a href="#lst-linux-job-control-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstração de process groups, sessions e job control no Linux.</span></span>
<span id="lst-linux-job-control-4"><a href="#lst-linux-job-control-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@author</span><span class="co"> Livro de Sistemas Operacionais</span></span>
<span id="lst-linux-job-control-5"><a href="#lst-linux-job-control-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@version</span><span class="co"> </span><span class="cv">1.0</span></span>
<span id="lst-linux-job-control-6"><a href="#lst-linux-job-control-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@date</span><span class="co"> 2025</span></span>
<span id="lst-linux-job-control-7"><a href="#lst-linux-job-control-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="lst-linux-job-control-8"><a href="#lst-linux-job-control-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * Este programa ilustra o uso de _process groups_ e sessions para implementar</span></span>
<span id="lst-linux-job-control-9"><a href="#lst-linux-job-control-9" aria-hidden="true" tabindex="-1"></a><span class="co"> * um controle básico de tarefas, similar ao que shells modernos fazem.</span></span>
<span id="lst-linux-job-control-10"><a href="#lst-linux-job-control-10" aria-hidden="true" tabindex="-1"></a><span class="co"> * Demonstra execução em foreground/background e manipulação de sinais.</span></span>
<span id="lst-linux-job-control-11"><a href="#lst-linux-job-control-11" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-job-control-12"><a href="#lst-linux-job-control-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-job-control-13"><a href="#lst-linux-job-control-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-linux-job-control-14"><a href="#lst-linux-job-control-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span>
<span id="lst-linux-job-control-15"><a href="#lst-linux-job-control-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string&gt;</span></span>
<span id="lst-linux-job-control-16"><a href="#lst-linux-job-control-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="lst-linux-job-control-17"><a href="#lst-linux-job-control-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span></span>
<span id="lst-linux-job-control-18"><a href="#lst-linux-job-control-18" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="lst-linux-job-control-19"><a href="#lst-linux-job-control-19" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;termios.h&gt;</span></span>
<span id="lst-linux-job-control-20"><a href="#lst-linux-job-control-20" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="lst-linux-job-control-21"><a href="#lst-linux-job-control-21" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;format&gt;</span></span>
<span id="lst-linux-job-control-22"><a href="#lst-linux-job-control-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-job-control-23"><a href="#lst-linux-job-control-23" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-job-control-24"><a href="#lst-linux-job-control-24" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Estrutura para representar uma tarefa (job).</span></span>
<span id="lst-linux-job-control-25"><a href="#lst-linux-job-control-25" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-job-control-26"><a href="#lst-linux-job-control-26" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Job <span class="op">{</span></span>
<span id="lst-linux-job-control-27"><a href="#lst-linux-job-control-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pid_t</span> pgid<span class="op">;</span>                    <span class="co">///&lt; Process Group ID da tarefa</span></span>
<span id="lst-linux-job-control-28"><a href="#lst-linux-job-control-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string command<span class="op">;</span>           <span class="co">///&lt; Comando executado</span></span>
<span id="lst-linux-job-control-29"><a href="#lst-linux-job-control-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> is_background<span class="op">;</span>            <span class="co">///&lt; true se executando em background</span></span>
<span id="lst-linux-job-control-30"><a href="#lst-linux-job-control-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> is_completed<span class="op">;</span>             <span class="co">///&lt; true se tarefa foi concluída</span></span>
<span id="lst-linux-job-control-31"><a href="#lst-linux-job-control-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-32"><a href="#lst-linux-job-control-32" aria-hidden="true" tabindex="-1"></a>    Job<span class="op">(</span><span class="dt">pid_t</span> pg<span class="op">,</span> <span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> cmd<span class="op">,</span> <span class="dt">bool</span> bg<span class="op">)</span> </span>
<span id="lst-linux-job-control-33"><a href="#lst-linux-job-control-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> pgid<span class="op">(</span>pg<span class="op">),</span> command<span class="op">(</span>cmd<span class="op">),</span> is_background<span class="op">(</span>bg<span class="op">),</span> is_completed<span class="op">(</span><span class="kw">false</span><span class="op">)</span> <span class="op">{}</span></span>
<span id="lst-linux-job-control-34"><a href="#lst-linux-job-control-34" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-linux-job-control-35"><a href="#lst-linux-job-control-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-job-control-36"><a href="#lst-linux-job-control-36" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-job-control-37"><a href="#lst-linux-job-control-37" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Classe para gerenciar jobs (controle de tarefas).</span></span>
<span id="lst-linux-job-control-38"><a href="#lst-linux-job-control-38" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-job-control-39"><a href="#lst-linux-job-control-39" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobManager <span class="op">{</span></span>
<span id="lst-linux-job-control-40"><a href="#lst-linux-job-control-40" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="lst-linux-job-control-41"><a href="#lst-linux-job-control-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span>Job<span class="op">&gt;</span> jobs<span class="op">;</span>                    <span class="co">///&lt; Lista de jobs ativos</span></span>
<span id="lst-linux-job-control-42"><a href="#lst-linux-job-control-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pid_t</span> shell_pgid<span class="op">;</span>                         <span class="co">///&lt; PGID do shell</span></span>
<span id="lst-linux-job-control-43"><a href="#lst-linux-job-control-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> termios shell_tmodes<span class="op">;</span>              <span class="co">///&lt; Modos do terminal do shell</span></span>
<span id="lst-linux-job-control-44"><a href="#lst-linux-job-control-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-45"><a href="#lst-linux-job-control-45" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-linux-job-control-46"><a href="#lst-linux-job-control-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-linux-job-control-47"><a href="#lst-linux-job-control-47" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Construtor - inicializa o job manager.</span></span>
<span id="lst-linux-job-control-48"><a href="#lst-linux-job-control-48" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-linux-job-control-49"><a href="#lst-linux-job-control-49" aria-hidden="true" tabindex="-1"></a>    JobManager<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-50"><a href="#lst-linux-job-control-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Obtém o PGID do shell</span></span>
<span id="lst-linux-job-control-51"><a href="#lst-linux-job-control-51" aria-hidden="true" tabindex="-1"></a>        shell_pgid <span class="op">=</span> getpid<span class="op">();</span></span>
<span id="lst-linux-job-control-52"><a href="#lst-linux-job-control-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-job-control-53"><a href="#lst-linux-job-control-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Se executando interativamente, toma controle do terminal</span></span>
<span id="lst-linux-job-control-54"><a href="#lst-linux-job-control-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>isatty<span class="op">(</span>STDIN_FILENO<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-55"><a href="#lst-linux-job-control-55" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Move o shell para seu próprio process group</span></span>
<span id="lst-linux-job-control-56"><a href="#lst-linux-job-control-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>setpgid<span class="op">(</span>shell_pgid<span class="op">,</span> shell_pgid<span class="op">)</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-57"><a href="#lst-linux-job-control-57" aria-hidden="true" tabindex="-1"></a>                perror<span class="op">(</span><span class="st">"setpgid"</span><span class="op">);</span></span>
<span id="lst-linux-job-control-58"><a href="#lst-linux-job-control-58" aria-hidden="true" tabindex="-1"></a>                exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="lst-linux-job-control-59"><a href="#lst-linux-job-control-59" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-linux-job-control-60"><a href="#lst-linux-job-control-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-61"><a href="#lst-linux-job-control-61" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Toma controle do terminal</span></span>
<span id="lst-linux-job-control-62"><a href="#lst-linux-job-control-62" aria-hidden="true" tabindex="-1"></a>            tcsetpgrp<span class="op">(</span>STDIN_FILENO<span class="op">,</span> shell_pgid<span class="op">);</span></span>
<span id="lst-linux-job-control-63"><a href="#lst-linux-job-control-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-64"><a href="#lst-linux-job-control-64" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Salva atributos do terminal</span></span>
<span id="lst-linux-job-control-65"><a href="#lst-linux-job-control-65" aria-hidden="true" tabindex="-1"></a>            tcgetattr<span class="op">(</span>STDIN_FILENO<span class="op">,</span> <span class="op">&amp;</span>shell_tmodes<span class="op">);</span></span>
<span id="lst-linux-job-control-66"><a href="#lst-linux-job-control-66" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-linux-job-control-67"><a href="#lst-linux-job-control-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-job-control-68"><a href="#lst-linux-job-control-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-69"><a href="#lst-linux-job-control-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-linux-job-control-70"><a href="#lst-linux-job-control-70" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Executa um comando, opcionalmente em background.</span></span>
<span id="lst-linux-job-control-71"><a href="#lst-linux-job-control-71" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">args</span><span class="co"> Argumentos do comando</span></span>
<span id="lst-linux-job-control-72"><a href="#lst-linux-job-control-72" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">background</span><span class="co"> true para executar em background</span></span>
<span id="lst-linux-job-control-73"><a href="#lst-linux-job-control-73" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-linux-job-control-74"><a href="#lst-linux-job-control-74" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> execute_command<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;&amp;</span> args<span class="op">,</span> <span class="dt">bool</span> background<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-75"><a href="#lst-linux-job-control-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>args<span class="op">.</span>empty<span class="op">())</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-linux-job-control-76"><a href="#lst-linux-job-control-76" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-job-control-77"><a href="#lst-linux-job-control-77" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Converte argumentos para formato execvp</span></span>
<span id="lst-linux-job-control-78"><a href="#lst-linux-job-control-78" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;</span> argv<span class="op">;</span></span>
<span id="lst-linux-job-control-79"><a href="#lst-linux-job-control-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> arg <span class="op">:</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-80"><a href="#lst-linux-job-control-80" aria-hidden="true" tabindex="-1"></a>            argv<span class="op">.</span>push_back<span class="op">(</span><span class="kw">const_cast</span><span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;(</span>arg<span class="op">.</span>c_str<span class="op">()));</span></span>
<span id="lst-linux-job-control-81"><a href="#lst-linux-job-control-81" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-linux-job-control-82"><a href="#lst-linux-job-control-82" aria-hidden="true" tabindex="-1"></a>        argv<span class="op">.</span>push_back<span class="op">(</span><span class="kw">nullptr</span><span class="op">);</span></span>
<span id="lst-linux-job-control-83"><a href="#lst-linux-job-control-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-job-control-84"><a href="#lst-linux-job-control-84" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pid_t</span> <span class="op">**</span>PID<span class="op">**</span> <span class="op">=</span> fork<span class="op">();</span></span>
<span id="lst-linux-job-control-85"><a href="#lst-linux-job-control-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-job-control-86"><a href="#lst-linux-job-control-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pid <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-87"><a href="#lst-linux-job-control-87" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"fork"</span><span class="op">);</span></span>
<span id="lst-linux-job-control-88"><a href="#lst-linux-job-control-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-linux-job-control-89"><a href="#lst-linux-job-control-89" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-linux-job-control-90"><a href="#lst-linux-job-control-90" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-job-control-91"><a href="#lst-linux-job-control-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-92"><a href="#lst-linux-job-control-92" aria-hidden="true" tabindex="-1"></a>            <span class="co">// *** PROCESSO FILHO ***</span></span>
<span id="lst-linux-job-control-93"><a href="#lst-linux-job-control-93" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-94"><a href="#lst-linux-job-control-94" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Cria novo process group para o comando</span></span>
<span id="lst-linux-job-control-95"><a href="#lst-linux-job-control-95" aria-hidden="true" tabindex="-1"></a>            setpgid<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span>  <span class="co">// Define PGID como próprio PID</span></span>
<span id="lst-linux-job-control-96"><a href="#lst-linux-job-control-96" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-97"><a href="#lst-linux-job-control-97" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Se foreground, dá controle do terminal ao novo process group</span></span>
<span id="lst-linux-job-control-98"><a href="#lst-linux-job-control-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>background <span class="op">&amp;&amp;</span> isatty<span class="op">(</span>STDIN_FILENO<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-99"><a href="#lst-linux-job-control-99" aria-hidden="true" tabindex="-1"></a>                tcsetpgrp<span class="op">(</span>STDIN_FILENO<span class="op">,</span> getpid<span class="op">());</span></span>
<span id="lst-linux-job-control-100"><a href="#lst-linux-job-control-100" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-linux-job-control-101"><a href="#lst-linux-job-control-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-102"><a href="#lst-linux-job-control-102" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Restaura handlers de sinal padrão</span></span>
<span id="lst-linux-job-control-103"><a href="#lst-linux-job-control-103" aria-hidden="true" tabindex="-1"></a>            signal<span class="op">(</span>SIGINT<span class="op">,</span> SIG_DFL<span class="op">);</span></span>
<span id="lst-linux-job-control-104"><a href="#lst-linux-job-control-104" aria-hidden="true" tabindex="-1"></a>            signal<span class="op">(</span>SIGQUIT<span class="op">,</span> SIG_DFL<span class="op">);</span></span>
<span id="lst-linux-job-control-105"><a href="#lst-linux-job-control-105" aria-hidden="true" tabindex="-1"></a>            signal<span class="op">(</span>SIGTSTP<span class="op">,</span> SIG_DFL<span class="op">);</span></span>
<span id="lst-linux-job-control-106"><a href="#lst-linux-job-control-106" aria-hidden="true" tabindex="-1"></a>            signal<span class="op">(</span>SIGTTIN<span class="op">,</span> SIG_DFL<span class="op">);</span></span>
<span id="lst-linux-job-control-107"><a href="#lst-linux-job-control-107" aria-hidden="true" tabindex="-1"></a>            signal<span class="op">(</span>SIGTTOU<span class="op">,</span> SIG_DFL<span class="op">);</span></span>
<span id="lst-linux-job-control-108"><a href="#lst-linux-job-control-108" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-109"><a href="#lst-linux-job-control-109" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Executa o comando</span></span>
<span id="lst-linux-job-control-110"><a href="#lst-linux-job-control-110" aria-hidden="true" tabindex="-1"></a>            execvp<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">],</span> argv<span class="op">.</span>data<span class="op">());</span></span>
<span id="lst-linux-job-control-111"><a href="#lst-linux-job-control-111" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"execvp"</span><span class="op">);</span></span>
<span id="lst-linux-job-control-112"><a href="#lst-linux-job-control-112" aria-hidden="true" tabindex="-1"></a>            _exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="lst-linux-job-control-113"><a href="#lst-linux-job-control-113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-114"><a href="#lst-linux-job-control-114" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-115"><a href="#lst-linux-job-control-115" aria-hidden="true" tabindex="-1"></a>            <span class="co">// *** PROCESSO PAI (SHELL) ***</span></span>
<span id="lst-linux-job-control-116"><a href="#lst-linux-job-control-116" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-117"><a href="#lst-linux-job-control-117" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Define o process group do filho</span></span>
<span id="lst-linux-job-control-118"><a href="#lst-linux-job-control-118" aria-hidden="true" tabindex="-1"></a>            setpgid<span class="op">(</span>pid<span class="op">,</span> pid<span class="op">);</span></span>
<span id="lst-linux-job-control-119"><a href="#lst-linux-job-control-119" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-120"><a href="#lst-linux-job-control-120" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Cria registro do job</span></span>
<span id="lst-linux-job-control-121"><a href="#lst-linux-job-control-121" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>string cmd_str <span class="op">=</span> args<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="lst-linux-job-control-122"><a href="#lst-linux-job-control-122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> args<span class="op">.</span>size<span class="op">();</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-123"><a href="#lst-linux-job-control-123" aria-hidden="true" tabindex="-1"></a>                cmd_str <span class="op">+=</span> <span class="st">" "</span> <span class="op">+</span> args<span class="op">[</span>i<span class="op">];</span></span>
<span id="lst-linux-job-control-124"><a href="#lst-linux-job-control-124" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-linux-job-control-125"><a href="#lst-linux-job-control-125" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-126"><a href="#lst-linux-job-control-126" aria-hidden="true" tabindex="-1"></a>            jobs<span class="op">.</span>emplace_back<span class="op">(</span>pid<span class="op">,</span> cmd_str<span class="op">,</span> background<span class="op">);</span></span>
<span id="lst-linux-job-control-127"><a href="#lst-linux-job-control-127" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-linux-job-control-128"><a href="#lst-linux-job-control-128" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>background<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-129"><a href="#lst-linux-job-control-129" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"[</span><span class="sc">{}</span><span class="st">] </span><span class="sc">{}</span><span class="st"> (PID: </span><span class="sc">{}</span><span class="st">, PGID: </span><span class="sc">{}</span><span class="st">)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> </span>
<span id="lst-linux-job-control-130"><a href="#lst-linux-job-control-130" aria-hidden="true" tabindex="-1"></a>                                       jobs<span class="op">.</span>size<span class="op">(),</span> cmd_str<span class="op">,</span> pid<span class="op">,</span> pid<span class="op">);</span></span>
<span id="lst-linux-job-control-131"><a href="#lst-linux-job-control-131" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-132"><a href="#lst-linux-job-control-132" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Foreground: espera conclusão e retorna controle do terminal ao shell</span></span>
<span id="lst-linux-job-control-133"><a href="#lst-linux-job-control-133" aria-hidden="true" tabindex="-1"></a>                wait_for_job<span class="op">(</span>pid<span class="op">);</span></span>
<span id="lst-linux-job-control-134"><a href="#lst-linux-job-control-134" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>isatty<span class="op">(</span>STDIN_FILENO<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-135"><a href="#lst-linux-job-control-135" aria-hidden="true" tabindex="-1"></a>                    tcsetpgrp<span class="op">(</span>STDIN_FILENO<span class="op">,</span> shell_pgid<span class="op">);</span></span>
<span id="lst-linux-job-control-136"><a href="#lst-linux-job-control-136" aria-hidden="true" tabindex="-1"></a>                    tcsetattr<span class="op">(</span>STDIN_FILENO<span class="op">,</span> TCSADRAIN<span class="op">,</span> <span class="op">&amp;</span>shell_tmodes<span class="op">);</span></span>
<span id="lst-linux-job-control-137"><a href="#lst-linux-job-control-137" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="lst-linux-job-control-138"><a href="#lst-linux-job-control-138" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-linux-job-control-139"><a href="#lst-linux-job-control-139" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-linux-job-control-140"><a href="#lst-linux-job-control-140" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-job-control-141"><a href="#lst-linux-job-control-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-142"><a href="#lst-linux-job-control-142" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-linux-job-control-143"><a href="#lst-linux-job-control-143" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Espera por um job específico terminar.</span></span>
<span id="lst-linux-job-control-144"><a href="#lst-linux-job-control-144" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">pgid</span><span class="co"> Process Group ID do job</span></span>
<span id="lst-linux-job-control-145"><a href="#lst-linux-job-control-145" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-linux-job-control-146"><a href="#lst-linux-job-control-146" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> wait_for_job<span class="op">(</span><span class="dt">pid_t</span> pgid<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-147"><a href="#lst-linux-job-control-147" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> status<span class="op">;</span></span>
<span id="lst-linux-job-control-148"><a href="#lst-linux-job-control-148" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pid_t</span> pid<span class="op">;</span></span>
<span id="lst-linux-job-control-149"><a href="#lst-linux-job-control-149" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-job-control-150"><a href="#lst-linux-job-control-150" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-151"><a href="#lst-linux-job-control-151" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>PID<span class="op">**</span> <span class="op">=</span> waitpid<span class="op">(-</span>pgid<span class="op">,</span> <span class="op">&amp;</span>status<span class="op">,</span> WUNTRACED<span class="op">);</span></span>
<span id="lst-linux-job-control-152"><a href="#lst-linux-job-control-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>pid <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-153"><a href="#lst-linux-job-control-153" aria-hidden="true" tabindex="-1"></a>                mark_job_completed<span class="op">(</span>pgid<span class="op">);</span></span>
<span id="lst-linux-job-control-154"><a href="#lst-linux-job-control-154" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-linux-job-control-155"><a href="#lst-linux-job-control-155" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">while</span> <span class="op">(</span>pid <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>WIFEXITED<span class="op">(</span>status<span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>WIFSIGNALED<span class="op">(</span>status<span class="op">));</span></span>
<span id="lst-linux-job-control-156"><a href="#lst-linux-job-control-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-job-control-157"><a href="#lst-linux-job-control-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-158"><a href="#lst-linux-job-control-158" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-linux-job-control-159"><a href="#lst-linux-job-control-159" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Marca um job como concluído.</span></span>
<span id="lst-linux-job-control-160"><a href="#lst-linux-job-control-160" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">pgid</span><span class="co"> Process Group ID do job</span></span>
<span id="lst-linux-job-control-161"><a href="#lst-linux-job-control-161" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-linux-job-control-162"><a href="#lst-linux-job-control-162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> mark_job_completed<span class="op">(</span><span class="dt">pid_t</span> pgid<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-163"><a href="#lst-linux-job-control-163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span><span class="op">&amp;</span> job <span class="op">:</span> jobs<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-164"><a href="#lst-linux-job-control-164" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>job<span class="op">.</span>pgid <span class="op">==</span> pgid<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-165"><a href="#lst-linux-job-control-165" aria-hidden="true" tabindex="-1"></a>                job<span class="op">.</span>is_completed <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="lst-linux-job-control-166"><a href="#lst-linux-job-control-166" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-linux-job-control-167"><a href="#lst-linux-job-control-167" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-linux-job-control-168"><a href="#lst-linux-job-control-168" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-linux-job-control-169"><a href="#lst-linux-job-control-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-job-control-170"><a href="#lst-linux-job-control-170" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-171"><a href="#lst-linux-job-control-171" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-linux-job-control-172"><a href="#lst-linux-job-control-172" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Lista jobs ativos.</span></span>
<span id="lst-linux-job-control-173"><a href="#lst-linux-job-control-173" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-linux-job-control-174"><a href="#lst-linux-job-control-174" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> list_jobs<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-175"><a href="#lst-linux-job-control-175" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Jobs ativos:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-176"><a href="#lst-linux-job-control-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> jobs<span class="op">.</span>size<span class="op">();</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-177"><a href="#lst-linux-job-control-177" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> job <span class="op">=</span> jobs<span class="op">[</span>i<span class="op">];</span></span>
<span id="lst-linux-job-control-178"><a href="#lst-linux-job-control-178" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>job<span class="op">.</span>is_completed<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-179"><a href="#lst-linux-job-control-179" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"[</span><span class="sc">{}</span><span class="st">] </span><span class="sc">{}</span><span class="st"> </span><span class="sc">{}</span><span class="st"> (PGID: </span><span class="sc">{}</span><span class="st">)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> </span>
<span id="lst-linux-job-control-180"><a href="#lst-linux-job-control-180" aria-hidden="true" tabindex="-1"></a>                                       i <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> </span>
<span id="lst-linux-job-control-181"><a href="#lst-linux-job-control-181" aria-hidden="true" tabindex="-1"></a>                                       job<span class="op">.</span>is_background <span class="op">?</span> <span class="st">"Background"</span> <span class="op">:</span> <span class="st">"Foreground"</span><span class="op">,</span></span>
<span id="lst-linux-job-control-182"><a href="#lst-linux-job-control-182" aria-hidden="true" tabindex="-1"></a>                                       job<span class="op">.</span>command<span class="op">,</span></span>
<span id="lst-linux-job-control-183"><a href="#lst-linux-job-control-183" aria-hidden="true" tabindex="-1"></a>                                       job<span class="op">.</span>pgid<span class="op">);</span></span>
<span id="lst-linux-job-control-184"><a href="#lst-linux-job-control-184" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-linux-job-control-185"><a href="#lst-linux-job-control-185" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-linux-job-control-186"><a href="#lst-linux-job-control-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-job-control-187"><a href="#lst-linux-job-control-187" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-linux-job-control-188"><a href="#lst-linux-job-control-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-job-control-189"><a href="#lst-linux-job-control-189" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-job-control-190"><a href="#lst-linux-job-control-190" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstra criação de uma nova session (daemon-like).</span></span>
<span id="lst-linux-job-control-191"><a href="#lst-linux-job-control-191" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-job-control-192"><a href="#lst-linux-job-control-192" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_session_creation<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-193"><a href="#lst-linux-job-control-193" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Demonstrando criação de nova session:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-194"><a href="#lst-linux-job-control-194" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"PID atual: </span><span class="sc">{}</span><span class="st">, PGID: </span><span class="sc">{}</span><span class="st">, SID: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> </span>
<span id="lst-linux-job-control-195"><a href="#lst-linux-job-control-195" aria-hidden="true" tabindex="-1"></a>                             getpid<span class="op">(),</span> getpgrp<span class="op">(),</span> getsid<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="lst-linux-job-control-196"><a href="#lst-linux-job-control-196" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-197"><a href="#lst-linux-job-control-197" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pid_t</span> <span class="op">**</span>PID<span class="op">**</span> <span class="op">=</span> fork<span class="op">();</span></span>
<span id="lst-linux-job-control-198"><a href="#lst-linux-job-control-198" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-199"><a href="#lst-linux-job-control-199" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-200"><a href="#lst-linux-job-control-200" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"fork"</span><span class="op">);</span></span>
<span id="lst-linux-job-control-201"><a href="#lst-linux-job-control-201" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-linux-job-control-202"><a href="#lst-linux-job-control-202" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-job-control-203"><a href="#lst-linux-job-control-203" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-204"><a href="#lst-linux-job-control-204" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-205"><a href="#lst-linux-job-control-205" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Processo filho: cria nova session</span></span>
<span id="lst-linux-job-control-206"><a href="#lst-linux-job-control-206" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pid_t</span> new_sid <span class="op">=</span> setsid<span class="op">();</span></span>
<span id="lst-linux-job-control-207"><a href="#lst-linux-job-control-207" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>new_sid <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-208"><a href="#lst-linux-job-control-208" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"setsid"</span><span class="op">);</span></span>
<span id="lst-linux-job-control-209"><a href="#lst-linux-job-control-209" aria-hidden="true" tabindex="-1"></a>            _exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="lst-linux-job-control-210"><a href="#lst-linux-job-control-210" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-linux-job-control-211"><a href="#lst-linux-job-control-211" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-job-control-212"><a href="#lst-linux-job-control-212" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"Filho - Nova session criada!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="lst-linux-job-control-213"><a href="#lst-linux-job-control-213" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"PID: </span><span class="sc">{}</span><span class="st">, PGID: </span><span class="sc">{}</span><span class="st">, SID: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> </span>
<span id="lst-linux-job-control-214"><a href="#lst-linux-job-control-214" aria-hidden="true" tabindex="-1"></a>                                 getpid<span class="op">(),</span> getpgrp<span class="op">(),</span> getsid<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="lst-linux-job-control-215"><a href="#lst-linux-job-control-215" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Filho executando como session leader...</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-216"><a href="#lst-linux-job-control-216" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-job-control-217"><a href="#lst-linux-job-control-217" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Simula trabalho do daemon</span></span>
<span id="lst-linux-job-control-218"><a href="#lst-linux-job-control-218" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="lst-linux-job-control-219"><a href="#lst-linux-job-control-219" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Filho finalizando.</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-220"><a href="#lst-linux-job-control-220" aria-hidden="true" tabindex="-1"></a>        _exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="lst-linux-job-control-221"><a href="#lst-linux-job-control-221" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-job-control-222"><a href="#lst-linux-job-control-222" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-223"><a href="#lst-linux-job-control-223" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Processo pai: espera o filho</span></span>
<span id="lst-linux-job-control-224"><a href="#lst-linux-job-control-224" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> status<span class="op">;</span></span>
<span id="lst-linux-job-control-225"><a href="#lst-linux-job-control-225" aria-hidden="true" tabindex="-1"></a>        waitpid<span class="op">(</span>pid<span class="op">,</span> <span class="op">&amp;</span>status<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-linux-job-control-226"><a href="#lst-linux-job-control-226" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Demonstração de session concluída.</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-227"><a href="#lst-linux-job-control-227" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-job-control-228"><a href="#lst-linux-job-control-228" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-linux-job-control-229"><a href="#lst-linux-job-control-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-job-control-230"><a href="#lst-linux-job-control-230" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-job-control-231"><a href="#lst-linux-job-control-231" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Função principal - demonstra job control.</span></span>
<span id="lst-linux-job-control-232"><a href="#lst-linux-job-control-232" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-job-control-233"><a href="#lst-linux-job-control-233" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-linux-job-control-234"><a href="#lst-linux-job-control-234" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"=== Demonstração de Job Control no **Linux** ===</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-235"><a href="#lst-linux-job-control-235" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-236"><a href="#lst-linux-job-control-236" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Ignora sinais de controle de terminal no shell principal</span></span>
<span id="lst-linux-job-control-237"><a href="#lst-linux-job-control-237" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> SIG_IGN<span class="op">);</span></span>
<span id="lst-linux-job-control-238"><a href="#lst-linux-job-control-238" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGQUIT<span class="op">,</span> SIG_IGN<span class="op">);</span></span>
<span id="lst-linux-job-control-239"><a href="#lst-linux-job-control-239" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGTSTP<span class="op">,</span> SIG_IGN<span class="op">);</span></span>
<span id="lst-linux-job-control-240"><a href="#lst-linux-job-control-240" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGTTIN<span class="op">,</span> SIG_IGN<span class="op">);</span></span>
<span id="lst-linux-job-control-241"><a href="#lst-linux-job-control-241" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGTTOU<span class="op">,</span> SIG_IGN<span class="op">);</span></span>
<span id="lst-linux-job-control-242"><a href="#lst-linux-job-control-242" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-243"><a href="#lst-linux-job-control-243" aria-hidden="true" tabindex="-1"></a>    JobManager manager<span class="op">;</span></span>
<span id="lst-linux-job-control-244"><a href="#lst-linux-job-control-244" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-245"><a href="#lst-linux-job-control-245" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Demonstra execução em foreground</span></span>
<span id="lst-linux-job-control-246"><a href="#lst-linux-job-control-246" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"1. Executando 'sleep 2' em foreground:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-247"><a href="#lst-linux-job-control-247" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>execute_command<span class="op">({</span><span class="st">"sleep"</span><span class="op">,</span> <span class="st">"2"</span><span class="op">},</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="lst-linux-job-control-248"><a href="#lst-linux-job-control-248" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Comando foreground concluído.</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-249"><a href="#lst-linux-job-control-249" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-250"><a href="#lst-linux-job-control-250" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Demonstra execução em background</span></span>
<span id="lst-linux-job-control-251"><a href="#lst-linux-job-control-251" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"2. Executando 'sleep 5' em background:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-252"><a href="#lst-linux-job-control-252" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>execute_command<span class="op">({</span><span class="st">"sleep"</span><span class="op">,</span> <span class="st">"5"</span><span class="op">},</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-linux-job-control-253"><a href="#lst-linux-job-control-253" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-254"><a href="#lst-linux-job-control-254" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"3. Executando 'echo Hello World' em background:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-255"><a href="#lst-linux-job-control-255" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>execute_command<span class="op">({</span><span class="st">"echo"</span><span class="op">,</span> <span class="st">"Hello"</span><span class="op">,</span> <span class="st">"World"</span><span class="op">},</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-linux-job-control-256"><a href="#lst-linux-job-control-256" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-257"><a href="#lst-linux-job-control-257" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Lista jobs</span></span>
<span id="lst-linux-job-control-258"><a href="#lst-linux-job-control-258" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-259"><a href="#lst-linux-job-control-259" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>list_jobs<span class="op">();</span></span>
<span id="lst-linux-job-control-260"><a href="#lst-linux-job-control-260" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-261"><a href="#lst-linux-job-control-261" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Demonstra sessions</span></span>
<span id="lst-linux-job-control-262"><a href="#lst-linux-job-control-262" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st">4. Demonstração de Sessions:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-263"><a href="#lst-linux-job-control-263" aria-hidden="true" tabindex="-1"></a>    demonstrate_session_creation<span class="op">();</span></span>
<span id="lst-linux-job-control-264"><a href="#lst-linux-job-control-264" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-265"><a href="#lst-linux-job-control-265" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st">Aguardando jobs background terminarem...</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-job-control-266"><a href="#lst-linux-job-control-266" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">(</span><span class="dv">6</span><span class="op">);</span>  <span class="co">// Aguarda jobs background</span></span>
<span id="lst-linux-job-control-267"><a href="#lst-linux-job-control-267" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-job-control-268"><a href="#lst-linux-job-control-268" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-linux-job-control-269"><a href="#lst-linux-job-control-269" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</section>
</section>
<section id="variáveis-de-ambiente-herança-e-customização" class="level4" data-number="5.0.2.2">
<h4 data-number="5.0.2.2" class="anchored" data-anchor-id="variáveis-de-ambiente-herança-e-customização"><span class="header-section-number">5.0.2.2</span> Variáveis de Ambiente: Herança e Customização</h4>
<p>Todo processo no <strong>Linux</strong> herda uma cópia das variáveis de ambiente de seu processo pai. O ambiente é representado como um array de strings no formato <code>"NOME=valor"</code>, terminado por um ponteiro <code>NULL</code>.</p>
<p>Para controle preciso sobre o ambiente de um processo filho, a família <code>exec</code> oferece <code>execve()</code>, que aceita um array de ambiente customizado. O <a href="#lst-linux-environment" class="quarto-xref">Listing&nbsp;<span>5.3</span></a> demonstra manipulação avançada de variáveis de ambiente.</p>
<div id="lst-linux-environment" class="listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst quarto-uncaptioned" id="lst-linux-environment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;5.3
</figcaption>
<div aria-describedby="lst-linux-environment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="lst-linux-environment"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-linux-environment-1"><a href="#lst-linux-environment-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-environment-2"><a href="#lst-linux-environment-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@file</span><span class="co"> </span><span class="cv">linux_environment.cpp</span></span>
<span id="lst-linux-environment-3"><a href="#lst-linux-environment-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstração de manipulação de variáveis de ambiente no Linux.</span></span>
<span id="lst-linux-environment-4"><a href="#lst-linux-environment-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@author</span><span class="co"> Livro de Sistemas Operacionais</span></span>
<span id="lst-linux-environment-5"><a href="#lst-linux-environment-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@version</span><span class="co"> </span><span class="cv">1.0</span></span>
<span id="lst-linux-environment-6"><a href="#lst-linux-environment-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@date</span><span class="co"> 2025</span></span>
<span id="lst-linux-environment-7"><a href="#lst-linux-environment-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="lst-linux-environment-8"><a href="#lst-linux-environment-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * Este programa demonstra como processos podem herdar, modificar e </span></span>
<span id="lst-linux-environment-9"><a href="#lst-linux-environment-9" aria-hidden="true" tabindex="-1"></a><span class="co"> * customizar completamente o ambiente de processos filhos usando execve.</span></span>
<span id="lst-linux-environment-10"><a href="#lst-linux-environment-10" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-environment-11"><a href="#lst-linux-environment-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-environment-12"><a href="#lst-linux-environment-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-linux-environment-13"><a href="#lst-linux-environment-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span>
<span id="lst-linux-environment-14"><a href="#lst-linux-environment-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string&gt;</span></span>
<span id="lst-linux-environment-15"><a href="#lst-linux-environment-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="lst-linux-environment-16"><a href="#lst-linux-environment-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span></span>
<span id="lst-linux-environment-17"><a href="#lst-linux-environment-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdlib&gt;</span></span>
<span id="lst-linux-environment-18"><a href="#lst-linux-environment-18" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;format&gt;</span></span>
<span id="lst-linux-environment-19"><a href="#lst-linux-environment-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-environment-20"><a href="#lst-linux-environment-20" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-environment-21"><a href="#lst-linux-environment-21" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Classe para gerenciar ambientes de processo customizados.</span></span>
<span id="lst-linux-environment-22"><a href="#lst-linux-environment-22" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-environment-23"><a href="#lst-linux-environment-23" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EnvironmentManager <span class="op">{</span></span>
<span id="lst-linux-environment-24"><a href="#lst-linux-environment-24" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="lst-linux-environment-25"><a href="#lst-linux-environment-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> env_vars<span class="op">;</span> <span class="co">///&lt; Variáveis de ambiente</span></span>
<span id="lst-linux-environment-26"><a href="#lst-linux-environment-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-27"><a href="#lst-linux-environment-27" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-linux-environment-28"><a href="#lst-linux-environment-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-linux-environment-29"><a href="#lst-linux-environment-29" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Adiciona uma variável de ambiente.</span></span>
<span id="lst-linux-environment-30"><a href="#lst-linux-environment-30" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">name</span><span class="co"> Nome da variável</span></span>
<span id="lst-linux-environment-31"><a href="#lst-linux-environment-31" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">value</span><span class="co"> Valor da variável</span></span>
<span id="lst-linux-environment-32"><a href="#lst-linux-environment-32" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-linux-environment-33"><a href="#lst-linux-environment-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> set_variable<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> name<span class="op">,</span> <span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-34"><a href="#lst-linux-environment-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Remove variável existente se houver</span></span>
<span id="lst-linux-environment-35"><a href="#lst-linux-environment-35" aria-hidden="true" tabindex="-1"></a>        remove_variable<span class="op">(</span>name<span class="op">);</span></span>
<span id="lst-linux-environment-36"><a href="#lst-linux-environment-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-37"><a href="#lst-linux-environment-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Adiciona nova variável</span></span>
<span id="lst-linux-environment-38"><a href="#lst-linux-environment-38" aria-hidden="true" tabindex="-1"></a>        env_vars<span class="op">.</span>push_back<span class="op">(</span>name <span class="op">+</span> <span class="st">"="</span> <span class="op">+</span> value<span class="op">);</span></span>
<span id="lst-linux-environment-39"><a href="#lst-linux-environment-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-40"><a href="#lst-linux-environment-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-41"><a href="#lst-linux-environment-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-linux-environment-42"><a href="#lst-linux-environment-42" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Remove uma variável de ambiente.</span></span>
<span id="lst-linux-environment-43"><a href="#lst-linux-environment-43" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">name</span><span class="co"> Nome da variável a remover</span></span>
<span id="lst-linux-environment-44"><a href="#lst-linux-environment-44" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-linux-environment-45"><a href="#lst-linux-environment-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> remove_variable<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> name<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-46"><a href="#lst-linux-environment-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> it <span class="op">=</span> <span class="bu">std::</span>remove_if<span class="op">(</span>env_vars<span class="op">.</span>begin<span class="op">(),</span> env_vars<span class="op">.</span>end<span class="op">(),</span></span>
<span id="lst-linux-environment-47"><a href="#lst-linux-environment-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">[&amp;</span>name<span class="op">](</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> var<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-48"><a href="#lst-linux-environment-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> var<span class="op">.</span>substr<span class="op">(</span><span class="dv">0</span><span class="op">,</span> var<span class="op">.</span>find<span class="op">(</span><span class="ch">'='</span><span class="op">))</span> <span class="op">==</span> name<span class="op">;</span></span>
<span id="lst-linux-environment-49"><a href="#lst-linux-environment-49" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="lst-linux-environment-50"><a href="#lst-linux-environment-50" aria-hidden="true" tabindex="-1"></a>        env_vars<span class="op">.</span>erase<span class="op">(</span>it<span class="op">,</span> env_vars<span class="op">.</span>end<span class="op">());</span></span>
<span id="lst-linux-environment-51"><a href="#lst-linux-environment-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-52"><a href="#lst-linux-environment-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-53"><a href="#lst-linux-environment-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-linux-environment-54"><a href="#lst-linux-environment-54" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Carrega ambiente atual do processo.</span></span>
<span id="lst-linux-environment-55"><a href="#lst-linux-environment-55" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-linux-environment-56"><a href="#lst-linux-environment-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> load_current_environment<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-linux-environment-57"><a href="#lst-linux-environment-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">extern</span> <span class="dt">char</span><span class="op">**</span> environ<span class="op">;</span>  <span class="co">// Variável global do ambiente</span></span>
<span id="lst-linux-environment-58"><a href="#lst-linux-environment-58" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-59"><a href="#lst-linux-environment-59" aria-hidden="true" tabindex="-1"></a>        env_vars<span class="op">.</span>clear<span class="op">();</span></span>
<span id="lst-linux-environment-60"><a href="#lst-linux-environment-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">char</span><span class="op">**</span> env <span class="op">=</span> environ<span class="op">;</span> <span class="op">*</span>env <span class="op">!=</span> <span class="kw">nullptr</span><span class="op">;</span> <span class="op">++</span>env<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-61"><a href="#lst-linux-environment-61" aria-hidden="true" tabindex="-1"></a>            env_vars<span class="op">.</span>emplace_back<span class="op">(*</span>env<span class="op">);</span></span>
<span id="lst-linux-environment-62"><a href="#lst-linux-environment-62" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-linux-environment-63"><a href="#lst-linux-environment-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-64"><a href="#lst-linux-environment-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-65"><a href="#lst-linux-environment-65" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-linux-environment-66"><a href="#lst-linux-environment-66" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Converte para formato execve (array de char*).</span></span>
<span id="lst-linux-environment-67"><a href="#lst-linux-environment-67" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@return</span><span class="co"> Array de ponteiros para char, terminado com nullptr</span></span>
<span id="lst-linux-environment-68"><a href="#lst-linux-environment-68" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-linux-environment-69"><a href="#lst-linux-environment-69" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;</span> to_execve_format<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="lst-linux-environment-70"><a href="#lst-linux-environment-70" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;</span> envp<span class="op">;</span></span>
<span id="lst-linux-environment-71"><a href="#lst-linux-environment-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> var <span class="op">:</span> env_vars<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-72"><a href="#lst-linux-environment-72" aria-hidden="true" tabindex="-1"></a>            envp<span class="op">.</span>push_back<span class="op">(</span><span class="kw">const_cast</span><span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;(</span>var<span class="op">.</span>c_str<span class="op">()));</span></span>
<span id="lst-linux-environment-73"><a href="#lst-linux-environment-73" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-linux-environment-74"><a href="#lst-linux-environment-74" aria-hidden="true" tabindex="-1"></a>        envp<span class="op">.</span>push_back<span class="op">(</span><span class="kw">nullptr</span><span class="op">);</span></span>
<span id="lst-linux-environment-75"><a href="#lst-linux-environment-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> envp<span class="op">;</span></span>
<span id="lst-linux-environment-76"><a href="#lst-linux-environment-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-77"><a href="#lst-linux-environment-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-78"><a href="#lst-linux-environment-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-linux-environment-79"><a href="#lst-linux-environment-79" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Imprime todas as variáveis de ambiente.</span></span>
<span id="lst-linux-environment-80"><a href="#lst-linux-environment-80" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-linux-environment-81"><a href="#lst-linux-environment-81" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> print_environment<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="lst-linux-environment-82"><a href="#lst-linux-environment-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Variáveis de ambiente definidas:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-83"><a href="#lst-linux-environment-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> var <span class="op">:</span> env_vars<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-84"><a href="#lst-linux-environment-84" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"  "</span> <span class="op">&lt;&lt;</span> var <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-85"><a href="#lst-linux-environment-85" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-linux-environment-86"><a href="#lst-linux-environment-86" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">"Total: </span><span class="sc">{}</span><span class="st"> variáveis</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> env_vars<span class="op">.</span>size<span class="op">());</span></span>
<span id="lst-linux-environment-87"><a href="#lst-linux-environment-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-88"><a href="#lst-linux-environment-88" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-linux-environment-89"><a href="#lst-linux-environment-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-environment-90"><a href="#lst-linux-environment-90" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-environment-91"><a href="#lst-linux-environment-91" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstra execução com ambiente herdado.</span></span>
<span id="lst-linux-environment-92"><a href="#lst-linux-environment-92" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-environment-93"><a href="#lst-linux-environment-93" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_inherited_environment<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-linux-environment-94"><a href="#lst-linux-environment-94" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"=== Demonstração: Ambiente Herdado ===</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-95"><a href="#lst-linux-environment-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-96"><a href="#lst-linux-environment-96" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pid_t</span> <span class="op">**</span>PID<span class="op">**</span> <span class="op">=</span> fork<span class="op">();</span></span>
<span id="lst-linux-environment-97"><a href="#lst-linux-environment-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-98"><a href="#lst-linux-environment-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-99"><a href="#lst-linux-environment-99" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"fork"</span><span class="op">);</span></span>
<span id="lst-linux-environment-100"><a href="#lst-linux-environment-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-linux-environment-101"><a href="#lst-linux-environment-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-102"><a href="#lst-linux-environment-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-103"><a href="#lst-linux-environment-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-104"><a href="#lst-linux-environment-104" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Filho: executa 'env' para mostrar ambiente herdado</span></span>
<span id="lst-linux-environment-105"><a href="#lst-linux-environment-105" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Filho executando 'env' com ambiente herdado:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-106"><a href="#lst-linux-environment-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-107"><a href="#lst-linux-environment-107" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;</span> args <span class="op">=</span> <span class="op">{</span></span>
<span id="lst-linux-environment-108"><a href="#lst-linux-environment-108" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const_cast</span><span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;(</span><span class="st">"env"</span><span class="op">),</span></span>
<span id="lst-linux-environment-109"><a href="#lst-linux-environment-109" aria-hidden="true" tabindex="-1"></a>            <span class="kw">nullptr</span></span>
<span id="lst-linux-environment-110"><a href="#lst-linux-environment-110" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="lst-linux-environment-111"><a href="#lst-linux-environment-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-112"><a href="#lst-linux-environment-112" aria-hidden="true" tabindex="-1"></a>        execvp<span class="op">(</span>args<span class="op">[</span><span class="dv">0</span><span class="op">],</span> args<span class="op">.</span>data<span class="op">());</span></span>
<span id="lst-linux-environment-113"><a href="#lst-linux-environment-113" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"execvp"</span><span class="op">);</span></span>
<span id="lst-linux-environment-114"><a href="#lst-linux-environment-114" aria-hidden="true" tabindex="-1"></a>        _exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="lst-linux-environment-115"><a href="#lst-linux-environment-115" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-116"><a href="#lst-linux-environment-116" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-linux-environment-117"><a href="#lst-linux-environment-117" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Pai: espera o filho terminar</span></span>
<span id="lst-linux-environment-118"><a href="#lst-linux-environment-118" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> status<span class="op">;</span></span>
<span id="lst-linux-environment-119"><a href="#lst-linux-environment-119" aria-hidden="true" tabindex="-1"></a>        waitpid<span class="op">(</span>pid<span class="op">,</span> <span class="op">&amp;</span>status<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-linux-environment-120"><a href="#lst-linux-environment-120" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Demonstração de ambiente herdado concluída.</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-121"><a href="#lst-linux-environment-121" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-122"><a href="#lst-linux-environment-122" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-linux-environment-123"><a href="#lst-linux-environment-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-environment-124"><a href="#lst-linux-environment-124" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-environment-125"><a href="#lst-linux-environment-125" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstra execução com ambiente customizado.</span></span>
<span id="lst-linux-environment-126"><a href="#lst-linux-environment-126" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-environment-127"><a href="#lst-linux-environment-127" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_custom_environment<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-linux-environment-128"><a href="#lst-linux-environment-128" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"=== Demonstração: Ambiente Customizado ===</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-129"><a href="#lst-linux-environment-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-130"><a href="#lst-linux-environment-130" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cria ambiente minimalista customizado</span></span>
<span id="lst-linux-environment-131"><a href="#lst-linux-environment-131" aria-hidden="true" tabindex="-1"></a>    EnvironmentManager env_manager<span class="op">;</span></span>
<span id="lst-linux-environment-132"><a href="#lst-linux-environment-132" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">"PATH"</span><span class="op">,</span> <span class="st">"/usr/bin:/bin"</span><span class="op">);</span></span>
<span id="lst-linux-environment-133"><a href="#lst-linux-environment-133" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">"HOME"</span><span class="op">,</span> <span class="st">"/tmp"</span><span class="op">);</span></span>
<span id="lst-linux-environment-134"><a href="#lst-linux-environment-134" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">"USER"</span><span class="op">,</span> <span class="st">"processo_filho"</span><span class="op">);</span></span>
<span id="lst-linux-environment-135"><a href="#lst-linux-environment-135" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">"SHELL"</span><span class="op">,</span> <span class="st">"/bin/bash"</span><span class="op">);</span></span>
<span id="lst-linux-environment-136"><a href="#lst-linux-environment-136" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">"CUSTOM_VAR"</span><span class="op">,</span> <span class="st">"Valor personalizado!"</span><span class="op">);</span></span>
<span id="lst-linux-environment-137"><a href="#lst-linux-environment-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-138"><a href="#lst-linux-environment-138" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Ambiente customizado criado:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-139"><a href="#lst-linux-environment-139" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>print_environment<span class="op">();</span></span>
<span id="lst-linux-environment-140"><a href="#lst-linux-environment-140" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-141"><a href="#lst-linux-environment-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-142"><a href="#lst-linux-environment-142" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pid_t</span> <span class="op">**</span>PID<span class="op">**</span> <span class="op">=</span> fork<span class="op">();</span></span>
<span id="lst-linux-environment-143"><a href="#lst-linux-environment-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-144"><a href="#lst-linux-environment-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-145"><a href="#lst-linux-environment-145" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"fork"</span><span class="op">);</span></span>
<span id="lst-linux-environment-146"><a href="#lst-linux-environment-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-linux-environment-147"><a href="#lst-linux-environment-147" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-148"><a href="#lst-linux-environment-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-149"><a href="#lst-linux-environment-149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-150"><a href="#lst-linux-environment-150" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Filho: executa com ambiente customizado</span></span>
<span id="lst-linux-environment-151"><a href="#lst-linux-environment-151" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Filho executando com ambiente customizado:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-152"><a href="#lst-linux-environment-152" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-153"><a href="#lst-linux-environment-153" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;</span> args <span class="op">=</span> <span class="op">{</span></span>
<span id="lst-linux-environment-154"><a href="#lst-linux-environment-154" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const_cast</span><span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;(</span><span class="st">"env"</span><span class="op">),</span></span>
<span id="lst-linux-environment-155"><a href="#lst-linux-environment-155" aria-hidden="true" tabindex="-1"></a>            <span class="kw">nullptr</span></span>
<span id="lst-linux-environment-156"><a href="#lst-linux-environment-156" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="lst-linux-environment-157"><a href="#lst-linux-environment-157" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-158"><a href="#lst-linux-environment-158" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> envp <span class="op">=</span> env_manager<span class="op">.</span>to_execve_format<span class="op">();</span></span>
<span id="lst-linux-environment-159"><a href="#lst-linux-environment-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-160"><a href="#lst-linux-environment-160" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Usa execve para ambiente customizado</span></span>
<span id="lst-linux-environment-161"><a href="#lst-linux-environment-161" aria-hidden="true" tabindex="-1"></a>        execve<span class="op">(</span><span class="st">"/usr/bin/env"</span><span class="op">,</span> args<span class="op">.</span>data<span class="op">(),</span> envp<span class="op">.</span>data<span class="op">());</span></span>
<span id="lst-linux-environment-162"><a href="#lst-linux-environment-162" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"execve"</span><span class="op">);</span></span>
<span id="lst-linux-environment-163"><a href="#lst-linux-environment-163" aria-hidden="true" tabindex="-1"></a>        _exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="lst-linux-environment-164"><a href="#lst-linux-environment-164" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-165"><a href="#lst-linux-environment-165" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-linux-environment-166"><a href="#lst-linux-environment-166" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Pai: espera o filho terminar</span></span>
<span id="lst-linux-environment-167"><a href="#lst-linux-environment-167" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> status<span class="op">;</span></span>
<span id="lst-linux-environment-168"><a href="#lst-linux-environment-168" aria-hidden="true" tabindex="-1"></a>        waitpid<span class="op">(</span>pid<span class="op">,</span> <span class="op">&amp;</span>status<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-linux-environment-169"><a href="#lst-linux-environment-169" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Demonstração de ambiente customizado concluída.</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-170"><a href="#lst-linux-environment-170" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-171"><a href="#lst-linux-environment-171" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-linux-environment-172"><a href="#lst-linux-environment-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-environment-173"><a href="#lst-linux-environment-173" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-environment-174"><a href="#lst-linux-environment-174" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstra modificação seletiva do ambiente.</span></span>
<span id="lst-linux-environment-175"><a href="#lst-linux-environment-175" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-environment-176"><a href="#lst-linux-environment-176" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_selective_environment<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-linux-environment-177"><a href="#lst-linux-environment-177" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"=== Demonstração: Modificação Seletiva ===</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-178"><a href="#lst-linux-environment-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-179"><a href="#lst-linux-environment-179" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Carrega ambiente atual e faz modificações seletivas</span></span>
<span id="lst-linux-environment-180"><a href="#lst-linux-environment-180" aria-hidden="true" tabindex="-1"></a>    EnvironmentManager env_manager<span class="op">;</span></span>
<span id="lst-linux-environment-181"><a href="#lst-linux-environment-181" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>load_current_environment<span class="op">();</span></span>
<span id="lst-linux-environment-182"><a href="#lst-linux-environment-182" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-183"><a href="#lst-linux-environment-183" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Modifica variáveis específicas</span></span>
<span id="lst-linux-environment-184"><a href="#lst-linux-environment-184" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">"PATH"</span><span class="op">,</span> <span class="st">"/usr/local/bin:/usr/bin:/bin"</span><span class="op">);</span></span>
<span id="lst-linux-environment-185"><a href="#lst-linux-environment-185" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">"LANG"</span><span class="op">,</span> <span class="st">"pt_BR.UTF-8"</span><span class="op">);</span></span>
<span id="lst-linux-environment-186"><a href="#lst-linux-environment-186" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">"EDITOR"</span><span class="op">,</span> <span class="st">"nano"</span><span class="op">);</span></span>
<span id="lst-linux-environment-187"><a href="#lst-linux-environment-187" aria-hidden="true" tabindex="-1"></a>    env_manager<span class="op">.</span>remove_variable<span class="op">(</span><span class="st">"DISPLAY"</span><span class="op">);</span>  <span class="co">// Remove se existir</span></span>
<span id="lst-linux-environment-188"><a href="#lst-linux-environment-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-189"><a href="#lst-linux-environment-189" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Ambiente modificado seletivamente. Executando comando...</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-190"><a href="#lst-linux-environment-190" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-191"><a href="#lst-linux-environment-191" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pid_t</span> <span class="op">**</span>PID<span class="op">**</span> <span class="op">=</span> fork<span class="op">();</span></span>
<span id="lst-linux-environment-192"><a href="#lst-linux-environment-192" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-193"><a href="#lst-linux-environment-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-194"><a href="#lst-linux-environment-194" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"fork"</span><span class="op">);</span></span>
<span id="lst-linux-environment-195"><a href="#lst-linux-environment-195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-linux-environment-196"><a href="#lst-linux-environment-196" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-197"><a href="#lst-linux-environment-197" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-198"><a href="#lst-linux-environment-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-linux-environment-199"><a href="#lst-linux-environment-199" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Filho: executa comando que usa variáveis específicas</span></span>
<span id="lst-linux-environment-200"><a href="#lst-linux-environment-200" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;</span> args <span class="op">=</span> <span class="op">{</span></span>
<span id="lst-linux-environment-201"><a href="#lst-linux-environment-201" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const_cast</span><span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;(</span><span class="st">"sh"</span><span class="op">),</span></span>
<span id="lst-linux-environment-202"><a href="#lst-linux-environment-202" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const_cast</span><span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;(</span><span class="st">"-c"</span><span class="op">),</span></span>
<span id="lst-linux-environment-203"><a href="#lst-linux-environment-203" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const_cast</span><span class="op">&lt;</span><span class="dt">char</span><span class="op">*&gt;(</span><span class="st">"echo </span><span class="sc">\"</span><span class="st">PATH: $PATH</span><span class="sc">\"</span><span class="st">; echo </span><span class="sc">\"</span><span class="st">LANG: $LANG</span><span class="sc">\"</span><span class="st">; echo </span><span class="sc">\"</span><span class="st">EDITOR: $EDITOR</span><span class="sc">\"</span><span class="st">"</span><span class="op">),</span></span>
<span id="lst-linux-environment-204"><a href="#lst-linux-environment-204" aria-hidden="true" tabindex="-1"></a>            <span class="kw">nullptr</span></span>
<span id="lst-linux-environment-205"><a href="#lst-linux-environment-205" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="lst-linux-environment-206"><a href="#lst-linux-environment-206" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-207"><a href="#lst-linux-environment-207" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> envp <span class="op">=</span> env_manager<span class="op">.</span>to_execve_format<span class="op">();</span></span>
<span id="lst-linux-environment-208"><a href="#lst-linux-environment-208" aria-hidden="true" tabindex="-1"></a>        execve<span class="op">(</span><span class="st">"/bin/sh"</span><span class="op">,</span> args<span class="op">.</span>data<span class="op">(),</span> envp<span class="op">.</span>data<span class="op">());</span></span>
<span id="lst-linux-environment-209"><a href="#lst-linux-environment-209" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"execve"</span><span class="op">);</span></span>
<span id="lst-linux-environment-210"><a href="#lst-linux-environment-210" aria-hidden="true" tabindex="-1"></a>        _exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="lst-linux-environment-211"><a href="#lst-linux-environment-211" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-linux-environment-212"><a href="#lst-linux-environment-212" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-linux-environment-213"><a href="#lst-linux-environment-213" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Pai: espera o filho terminar</span></span>
<span id="lst-linux-environment-214"><a href="#lst-linux-environment-214" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> status<span class="op">;</span></span>
<span id="lst-linux-environment-215"><a href="#lst-linux-environment-215" aria-hidden="true" tabindex="-1"></a>        waitpid<span class="op">(</span>pid<span class="op">,</span> <span class="op">&amp;</span>status<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-linux-environment-216"><a href="#lst-linux-environment-216" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Demonstração de modificação seletiva concluída.</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-217"><a href="#lst-linux-environment-217" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-linux-environment-218"><a href="#lst-linux-environment-218" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-linux-environment-219"><a href="#lst-linux-environment-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-linux-environment-220"><a href="#lst-linux-environment-220" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-linux-environment-221"><a href="#lst-linux-environment-221" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Função principal.</span></span>
<span id="lst-linux-environment-222"><a href="#lst-linux-environment-222" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-linux-environment-223"><a href="#lst-linux-environment-223" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-linux-environment-224"><a href="#lst-linux-environment-224" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"=== Demonstração de Variáveis de Ambiente - **Linux** ===</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-225"><a href="#lst-linux-environment-225" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-226"><a href="#lst-linux-environment-226" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Demonstra diferentes cenários de ambiente</span></span>
<span id="lst-linux-environment-227"><a href="#lst-linux-environment-227" aria-hidden="true" tabindex="-1"></a>    demonstrate_inherited_environment<span class="op">();</span></span>
<span id="lst-linux-environment-228"><a href="#lst-linux-environment-228" aria-hidden="true" tabindex="-1"></a>    demonstrate_custom_environment<span class="op">();</span></span>
<span id="lst-linux-environment-229"><a href="#lst-linux-environment-229" aria-hidden="true" tabindex="-1"></a>    demonstrate_selective_environment<span class="op">();</span></span>
<span id="lst-linux-environment-230"><a href="#lst-linux-environment-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-linux-environment-231"><a href="#lst-linux-environment-231" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Todas as demonstrações concluídas.</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-linux-environment-232"><a href="#lst-linux-environment-232" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-linux-environment-233"><a href="#lst-linux-environment-233" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</section>
</section>
<section id="o-modelo-windows-a-configuração-com-createprocess" class="level3" data-number="5.0.3">
<h3 data-number="5.0.3" class="anchored" data-anchor-id="o-modelo-windows-a-configuração-com-createprocess"><span class="header-section-number">5.0.3</span> O Modelo Windows: A Configuração com CreateProcess</h3>
<p>O <strong>Windows</strong> adota uma abordagem fundamentalmente diferente. Em vez de um modelo composicional, ele oferece uma API monolítica e altamente configurável: <code>CreateProcess</code>. Este método é responsável por criar um novo processo e carregar a imagem do programa inicial em uma única operação atômica. Não há um estado intermediário onde o processo filho executa o código do pai.</p>
<p>Este é um modelo configuracional: o processo pai especifica o estado inicial completo do novo processo através de um conjunto abrangente de parâmetros. A chamada à função <code>CreateProcessW</code>, a versão Unicode, que é a preferida, aceita dez parâmetros, mas os mais importantes são:</p>
<ul>
<li><p><code>lpCommandLine</code>: uma string contendo o programa a ser executado e seus argumentos.</p></li>
<li><p><code>bInheritHandles</code>: um valor booleano que controla se o processo filho herda os <code>handles</code>, identificadores de recursos como arquivos, do pai.</p></li>
<li><p><code>dwCreationFlags</code>: <code>Flags</code> que controlam aspectos como prioridade e visibilidade da janela.</p></li>
<li><p><code>lpStartupInfo</code>: um ponteiro para uma estrutura <code>STARTUPINFOW</code> que o pai preenche para especificar como a janela principal do novo processo deve aparecer e quais são seus <code>handles</code> de entrada/saída padrão.</p></li>
<li><p><code>lpProcessInformation</code>: um ponteiro para uma estrutura <code>PROCESS_INFORMATION</code> que a função preenche com informações sobre o novo processo, mais importante, os <code>handles</code> para o novo processo (<code>hProcess</code>) e seu thread primário (<code>hThread</code>).</p></li>
</ul>
<p>Após uma chamada bem-sucedida, o pai usa o <code>handle</code> do processo retornado para interagir com o filho. A função <code>WaitForSingleObject</code> é usada para esperar que o processo filho termine. Uma etapa final, e de extrema importância, é que o pai deve chamar <code>CloseHandle()</code> nos handles do processo e do <code>thread</code> (<code>hProcess</code> e <code>hThread</code>) quando não precisar mais deles. Falhar em fechar esses <code>handles</code> resulta em um vazamento de recursos, pois o <strong>Sistema Operacional</strong> não liberará completamente as estruturas de dados do processo até que todos os <code>handles</code> abertos para ele sejam fechados.</p>
<p>Voltando a ideia de sedimentar por exemplos, o exemplo a seguir em C++23 demonstra a criação de um processo <code>notepad.exe</code>.</p>
<div id="lst-cppwindows-create" class="listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst quarto-uncaptioned" id="lst-cppwindows-create-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;5.4
</figcaption>
<div aria-describedby="lst-cppwindows-create-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="lst-cppwindows-create"><pre class="sourceCode c++ code-with-copy"><code class="sourceCode cpp"><span id="lst-cppwindows-create-1"><a href="#lst-cppwindows-create-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-2"><a href="#lst-cppwindows-create-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-cppwindows-create-3"><a href="#lst-cppwindows-create-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@file</span><span class="co"> </span><span class="cv">process_windows_create.cpp</span></span>
<span id="lst-cppwindows-create-4"><a href="#lst-cppwindows-create-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstração da criação de processos no **Windows** com CreateProcessW.</span></span>
<span id="lst-cppwindows-create-5"><a href="#lst-cppwindows-create-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@author</span><span class="co"> Livro de Sistemas Operacionais</span></span>
<span id="lst-cppwindows-create-6"><a href="#lst-cppwindows-create-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@version</span><span class="co"> </span><span class="cv">1.0</span></span>
<span id="lst-cppwindows-create-7"><a href="#lst-cppwindows-create-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@date</span><span class="co"> 2025</span></span>
<span id="lst-cppwindows-create-8"><a href="#lst-cppwindows-create-8" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="lst-cppwindows-create-9"><a href="#lst-cppwindows-create-9" aria-hidden="true" tabindex="-1"></a><span class="co"> * Este programa demonstra como usar a API CreateProcessW para iniciar uma</span></span>
<span id="lst-cppwindows-create-10"><a href="#lst-cppwindows-create-10" aria-hidden="true" tabindex="-1"></a><span class="co"> * nova instância do Bloco de Notas (notepad.exe). O processo pai então</span></span>
<span id="lst-cppwindows-create-11"><a href="#lst-cppwindows-create-11" aria-hidden="true" tabindex="-1"></a><span class="co"> * espera que o Bloco de Notas seja fechado e, em seguida, limpa os</span></span>
<span id="lst-cppwindows-create-12"><a href="#lst-cppwindows-create-12" aria-hidden="true" tabindex="-1"></a><span class="co"> * handles de recursos corretamente.</span></span>
<span id="lst-cppwindows-create-13"><a href="#lst-cppwindows-create-13" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-cppwindows-create-14"><a href="#lst-cppwindows-create-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-15"><a href="#lst-cppwindows-create-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-cppwindows-create-16"><a href="#lst-cppwindows-create-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string&gt;</span></span>
<span id="lst-cppwindows-create-17"><a href="#lst-cppwindows-create-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;windows.h&gt;</span><span class="pp"> </span><span class="co">// Cabeçalho principal da API do Windows</span></span>
<span id="lst-cppwindows-create-18"><a href="#lst-cppwindows-create-18" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;format&gt;</span><span class="pp">    </span><span class="co">// Para std::format</span></span>
<span id="lst-cppwindows-create-19"><a href="#lst-cppwindows-create-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-20"><a href="#lst-cppwindows-create-20" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-cppwindows-create-21"><a href="#lst-cppwindows-create-21" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Imprime a mensagem de erro formatada para a última falha da API do Windows.</span></span>
<span id="lst-cppwindows-create-22"><a href="#lst-cppwindows-create-22" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">functionName</span><span class="co"> O nome da função que falhou.</span></span>
<span id="lst-cppwindows-create-23"><a href="#lst-cppwindows-create-23" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-cppwindows-create-24"><a href="#lst-cppwindows-create-24" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> PrintError<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>wstring<span class="op">&amp;</span> functionName<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-cppwindows-create-25"><a href="#lst-cppwindows-create-25" aria-hidden="true" tabindex="-1"></a>    DWORD errorCode <span class="op">=</span> GetLastError<span class="op">();</span></span>
<span id="lst-cppwindows-create-26"><a href="#lst-cppwindows-create-26" aria-hidden="true" tabindex="-1"></a>    LPWSTR messageBuffer <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="lst-cppwindows-create-27"><a href="#lst-cppwindows-create-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> size <span class="op">=</span> FormatMessageW<span class="op">(</span></span>
<span id="lst-cppwindows-create-28"><a href="#lst-cppwindows-create-28" aria-hidden="true" tabindex="-1"></a>        FORMAT_MESSAGE_ALLOCATE_BUFFER <span class="op">|</span> FORMAT_MESSAGE_FROM_SYSTEM <span class="op">|</span> FORMAT_MESSAGE_IGNORE_INSERTS<span class="op">,</span></span>
<span id="lst-cppwindows-create-29"><a href="#lst-cppwindows-create-29" aria-hidden="true" tabindex="-1"></a>        NULL<span class="op">,</span></span>
<span id="lst-cppwindows-create-30"><a href="#lst-cppwindows-create-30" aria-hidden="true" tabindex="-1"></a>        errorCode<span class="op">,</span></span>
<span id="lst-cppwindows-create-31"><a href="#lst-cppwindows-create-31" aria-hidden="true" tabindex="-1"></a>        MAKELANGID<span class="op">(</span>LANG_NEUTRAL<span class="op">,</span> SUBLANG_DEFAULT<span class="op">),</span></span>
<span id="lst-cppwindows-create-32"><a href="#lst-cppwindows-create-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>LPWSTR<span class="op">)&amp;</span>messageBuffer<span class="op">,</span></span>
<span id="lst-cppwindows-create-33"><a href="#lst-cppwindows-create-33" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span></span>
<span id="lst-cppwindows-create-34"><a href="#lst-cppwindows-create-34" aria-hidden="true" tabindex="-1"></a>        NULL<span class="op">);</span></span>
<span id="lst-cppwindows-create-35"><a href="#lst-cppwindows-create-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-36"><a href="#lst-cppwindows-create-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcerr <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">L"Falha em </span><span class="sc">{}</span><span class="st"> com o erro </span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> functionName<span class="op">,</span> errorCode<span class="op">,</span> messageBuffer<span class="op">);</span></span>
<span id="lst-cppwindows-create-37"><a href="#lst-cppwindows-create-37" aria-hidden="true" tabindex="-1"></a>    LocalFree<span class="op">(</span>messageBuffer<span class="op">);</span> <span class="co">// Libera o buffer alocado por FormatMessageW.</span></span>
<span id="lst-cppwindows-create-38"><a href="#lst-cppwindows-create-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-cppwindows-create-39"><a href="#lst-cppwindows-create-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-40"><a href="#lst-cppwindows-create-40" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-cppwindows-create-41"><a href="#lst-cppwindows-create-41" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Ponto de entrada principal do programa.</span></span>
<span id="lst-cppwindows-create-42"><a href="#lst-cppwindows-create-42" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-cppwindows-create-43"><a href="#lst-cppwindows-create-43" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-cppwindows-create-44"><a href="#lst-cppwindows-create-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define o locale para a saída, permitindo caracteres Unicode.</span></span>
<span id="lst-cppwindows-create-45"><a href="#lst-cppwindows-create-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout<span class="op">.</span>imbue<span class="op">(</span><span class="bu">std::</span>locale<span class="op">(</span><span class="st">""</span><span class="op">));</span></span>
<span id="lst-cppwindows-create-46"><a href="#lst-cppwindows-create-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcerr<span class="op">.</span>imbue<span class="op">(</span><span class="bu">std::</span>locale<span class="op">(</span><span class="st">""</span><span class="op">));</span></span>
<span id="lst-cppwindows-create-47"><a href="#lst-cppwindows-create-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-48"><a href="#lst-cppwindows-create-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">L"Processo pai (PID: </span><span class="sc">{}</span><span class="st">) iniciando...</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> GetCurrentProcessId<span class="op">());</span></span>
<span id="lst-cppwindows-create-49"><a href="#lst-cppwindows-create-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-50"><a href="#lst-cppwindows-create-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Estruturas para CreateProcess. É necessário inicializá-las com zeros.</span></span>
<span id="lst-cppwindows-create-51"><a href="#lst-cppwindows-create-51" aria-hidden="true" tabindex="-1"></a>    STARTUPINFOW si<span class="op">;</span></span>
<span id="lst-cppwindows-create-52"><a href="#lst-cppwindows-create-52" aria-hidden="true" tabindex="-1"></a>    PROCESS_INFORMATION pi<span class="op">;</span></span>
<span id="lst-cppwindows-create-53"><a href="#lst-cppwindows-create-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-54"><a href="#lst-cppwindows-create-54" aria-hidden="true" tabindex="-1"></a>    ZeroMemory<span class="op">(&amp;</span>si<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>si<span class="op">));</span></span>
<span id="lst-cppwindows-create-55"><a href="#lst-cppwindows-create-55" aria-hidden="true" tabindex="-1"></a>    si<span class="op">.</span>cb <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span>si<span class="op">);</span> <span class="co">// O tamanho da estrutura deve ser definido.</span></span>
<span id="lst-cppwindows-create-56"><a href="#lst-cppwindows-create-56" aria-hidden="true" tabindex="-1"></a>    ZeroMemory<span class="op">(&amp;</span>pi<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>pi<span class="op">));</span></span>
<span id="lst-cppwindows-create-57"><a href="#lst-cppwindows-create-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-58"><a href="#lst-cppwindows-create-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Linha de comando para o novo processo.</span></span>
<span id="lst-cppwindows-create-59"><a href="#lst-cppwindows-create-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Para CreateProcessW, a string deve ser mutável, então criamos um buffer.</span></span>
<span id="lst-cppwindows-create-60"><a href="#lst-cppwindows-create-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wstring commandLine <span class="op">=</span> <span class="st">L"notepad.exe"</span><span class="op">;</span></span>
<span id="lst-cppwindows-create-61"><a href="#lst-cppwindows-create-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-62"><a href="#lst-cppwindows-create-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Pai tentando iniciar 'notepad.exe'...</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-cppwindows-create-63"><a href="#lst-cppwindows-create-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-64"><a href="#lst-cppwindows-create-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cria o processo filho.</span></span>
<span id="lst-cppwindows-create-65"><a href="#lst-cppwindows-create-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>CreateProcessW<span class="op">(</span></span>
<span id="lst-cppwindows-create-66"><a href="#lst-cppwindows-create-66" aria-hidden="true" tabindex="-1"></a>            NULL<span class="op">,</span>                  <span class="co">// lpApplicationName - Usa a linha de comando.</span></span>
<span id="lst-cppwindows-create-67"><a href="#lst-cppwindows-create-67" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span>commandLine<span class="op">[</span><span class="dv">0</span><span class="op">],</span>       <span class="co">// lpCommandLine - Deve ser um ponteiro para um buffer de escrita.</span></span>
<span id="lst-cppwindows-create-68"><a href="#lst-cppwindows-create-68" aria-hidden="true" tabindex="-1"></a>            NULL<span class="op">,</span>                  <span class="co">// lpProcessAttributes - Segurança padrão para o processo.</span></span>
<span id="lst-cppwindows-create-69"><a href="#lst-cppwindows-create-69" aria-hidden="true" tabindex="-1"></a>            NULL<span class="op">,</span>                  <span class="co">// lpThreadAttributes - Segurança padrão para o thread.</span></span>
<span id="lst-cppwindows-create-70"><a href="#lst-cppwindows-create-70" aria-hidden="true" tabindex="-1"></a>            FALSE<span class="op">,</span>                 <span class="co">// bInheritHandles - Não herda handles.</span></span>
<span id="lst-cppwindows-create-71"><a href="#lst-cppwindows-create-71" aria-hidden="true" tabindex="-1"></a>            <span class="dv">0</span><span class="op">,</span>                     <span class="co">// dwCreationFlags - Sem flags especiais.</span></span>
<span id="lst-cppwindows-create-72"><a href="#lst-cppwindows-create-72" aria-hidden="true" tabindex="-1"></a>            NULL<span class="op">,</span>                  <span class="co">// lpEnvironment - Usa o ambiente do pai.</span></span>
<span id="lst-cppwindows-create-73"><a href="#lst-cppwindows-create-73" aria-hidden="true" tabindex="-1"></a>            NULL<span class="op">,</span>                  <span class="co">// lpCurrentDirectory - Usa o diretório do pai.</span></span>
<span id="lst-cppwindows-create-74"><a href="#lst-cppwindows-create-74" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span>si<span class="op">,</span>                   <span class="co">// lpStartupInfo - Ponteiro para a estrutura STARTUPINFO.</span></span>
<span id="lst-cppwindows-create-75"><a href="#lst-cppwindows-create-75" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span>pi                    <span class="co">// lpProcessInformation - Ponteiro para a estrutura PROCESS_INFORMATION.</span></span>
<span id="lst-cppwindows-create-76"><a href="#lst-cppwindows-create-76" aria-hidden="true" tabindex="-1"></a>        <span class="op">))</span></span>
<span id="lst-cppwindows-create-77"><a href="#lst-cppwindows-create-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-cppwindows-create-78"><a href="#lst-cppwindows-create-78" aria-hidden="true" tabindex="-1"></a>        PrintError<span class="op">(</span><span class="st">L"CreateProcessW"</span><span class="op">);</span></span>
<span id="lst-cppwindows-create-79"><a href="#lst-cppwindows-create-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="lst-cppwindows-create-80"><a href="#lst-cppwindows-create-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-cppwindows-create-81"><a href="#lst-cppwindows-create-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-82"><a href="#lst-cppwindows-create-82" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">L"Pai criou o filho 'notepad.exe' com PID: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> pi<span class="op">.</span>dwProcessId<span class="op">);</span></span>
<span id="lst-cppwindows-create-83"><a href="#lst-cppwindows-create-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Pai esperando o filho terminar (feche a janela do Bloco de Notas)...</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-cppwindows-create-84"><a href="#lst-cppwindows-create-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-85"><a href="#lst-cppwindows-create-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Espera indefinidamente até que o objeto do processo filho seja sinalizado (termine).</span></span>
<span id="lst-cppwindows-create-86"><a href="#lst-cppwindows-create-86" aria-hidden="true" tabindex="-1"></a>    WaitForSingleObject<span class="op">(</span>pi<span class="op">.</span>hProcess<span class="op">,</span> INFINITE<span class="op">);</span></span>
<span id="lst-cppwindows-create-87"><a href="#lst-cppwindows-create-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-88"><a href="#lst-cppwindows-create-88" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Pai detectou que o processo filho terminou.</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-cppwindows-create-89"><a href="#lst-cppwindows-create-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-90"><a href="#lst-cppwindows-create-90" aria-hidden="true" tabindex="-1"></a>    <span class="co">// É ESSENCIAL fechar os handles do processo e do thread para evitar vazamentos de recursos.</span></span>
<span id="lst-cppwindows-create-91"><a href="#lst-cppwindows-create-91" aria-hidden="true" tabindex="-1"></a>    CloseHandle<span class="op">(</span>pi<span class="op">.</span>hProcess<span class="op">);</span></span>
<span id="lst-cppwindows-create-92"><a href="#lst-cppwindows-create-92" aria-hidden="true" tabindex="-1"></a>    CloseHandle<span class="op">(</span>pi<span class="op">.</span>hThread<span class="op">);</span></span>
<span id="lst-cppwindows-create-93"><a href="#lst-cppwindows-create-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-cppwindows-create-94"><a href="#lst-cppwindows-create-94" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Handles do processo e do thread foram fechados. Encerrando.</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-cppwindows-create-95"><a href="#lst-cppwindows-create-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-cppwindows-create-96"><a href="#lst-cppwindows-create-96" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<p>O código em <a href="#lst-cppwindows-create" class="quarto-xref">Listing&nbsp;<span>5.4</span></a> ilustra a abordagem do Windows. Primeiro, as estruturas <code>STARTUPINFOW</code> e <code>PROCESS_INFORMATION</code> são inicializadas com zeros usando <code>ZeroMemory</code>. A chamada a <code>CreateProcessW</code> é então feita, passando um ponteiro para a string da linha de comando. Se a chamada for bem-sucedida, a estrutura <code>pi</code> será preenchida com os handles e <strong>ID</strong>s do novo processo. O pai então chama <code>WaitForSingleObject</code> no <code>handle</code> do processo (<code>pi.hProcess</code>), bloqueando sua própria execução até que o usuário feche a janela do Bloco de Notas. Finalmente, e de forma indispensável, <code>CloseHandle</code> é chamado em <code>pi.hProcess</code> e <code>pi.hThread</code> para liberar os recursos associados a eles no <code>Kernel</code>.</p>
<section id="controle-de-ambiente-de-processos-no-windows" class="level4" data-number="5.0.3.1">
<h4 data-number="5.0.3.1" class="anchored" data-anchor-id="controle-de-ambiente-de-processos-no-windows"><span class="header-section-number">5.0.3.1</span> Controle de Ambiente de Processos no Windows</h4>
<p>No Windows, a manipulação de variáveis de ambiente segue uma abordagem diferente, mas igualmente poderosa. O sistema oferece controle granular sobre o ambiente através dos parâmetros de <code>CreateProcess</code>, permitindo herança seletiva ou definição completa de um ambiente customizado.</p>
<section id="herança-e-customização-de-ambiente" class="level5" data-number="5.0.3.1.1">
<h5 data-number="5.0.3.1.1" class="anchored" data-anchor-id="herança-e-customização-de-ambiente"><span class="header-section-number">5.0.3.1.1</span> Herança e Customização de Ambiente</h5>
<p>Por padrão, no Windows, processos filhos herdam todas as variáveis de ambiente do processo pai. Para controle preciso, <code>CreateProcess</code> aceita o parâmetro <code>lpEnvironment</code>, que pode conter um bloco de ambiente completamente novo. Este bloco deve ser formatado como uma sequência de strings terminadas em nulo, cada uma no formato <code>"NOME=valor"</code>, com o bloco inteiro terminado por um nulo adicional.</p>
<p>O <a href="#lst-windows-environment" class="quarto-xref">Listing&nbsp;<span>5.5</span></a> demonstra as técnicas de manipulação de ambiente no Windows.</p>
<div id="lst-windows-environment" class="listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst quarto-uncaptioned" id="lst-windows-environment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;5.5
</figcaption>
<div aria-describedby="lst-windows-environment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="lst-windows-environment"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-windows-environment-1"><a href="#lst-windows-environment-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-windows-environment-2"><a href="#lst-windows-environment-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@file</span><span class="co"> </span><span class="cv">windows_environment.cpp</span></span>
<span id="lst-windows-environment-3"><a href="#lst-windows-environment-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstração de manipulação de variáveis de ambiente no Windows.</span></span>
<span id="lst-windows-environment-4"><a href="#lst-windows-environment-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@author</span><span class="co"> Livro de Sistemas Operacionais</span></span>
<span id="lst-windows-environment-5"><a href="#lst-windows-environment-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@version</span><span class="co"> </span><span class="cv">1.0</span></span>
<span id="lst-windows-environment-6"><a href="#lst-windows-environment-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@date</span><span class="co"> 2025</span></span>
<span id="lst-windows-environment-7"><a href="#lst-windows-environment-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="lst-windows-environment-8"><a href="#lst-windows-environment-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * Este programa demonstra como processos no **Windows** podem herdar e</span></span>
<span id="lst-windows-environment-9"><a href="#lst-windows-environment-9" aria-hidden="true" tabindex="-1"></a><span class="co"> * customizar ambientes usando CreateProcess com lpEnvironment.</span></span>
<span id="lst-windows-environment-10"><a href="#lst-windows-environment-10" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-windows-environment-11"><a href="#lst-windows-environment-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-windows-environment-12"><a href="#lst-windows-environment-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-windows-environment-13"><a href="#lst-windows-environment-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string&gt;</span></span>
<span id="lst-windows-environment-14"><a href="#lst-windows-environment-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span>
<span id="lst-windows-environment-15"><a href="#lst-windows-environment-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;map&gt;</span></span>
<span id="lst-windows-environment-16"><a href="#lst-windows-environment-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;windows.h&gt;</span></span>
<span id="lst-windows-environment-17"><a href="#lst-windows-environment-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;format&gt;</span></span>
<span id="lst-windows-environment-18"><a href="#lst-windows-environment-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-windows-environment-19"><a href="#lst-windows-environment-19" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-windows-environment-20"><a href="#lst-windows-environment-20" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Classe para gerenciar ambientes de processo no Windows.</span></span>
<span id="lst-windows-environment-21"><a href="#lst-windows-environment-21" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-windows-environment-22"><a href="#lst-windows-environment-22" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WindowsEnvironmentManager <span class="op">{</span></span>
<span id="lst-windows-environment-23"><a href="#lst-windows-environment-23" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="lst-windows-environment-24"><a href="#lst-windows-environment-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>map<span class="op">&lt;</span><span class="bu">std::</span>wstring<span class="op">,</span> <span class="bu">std::</span>wstring<span class="op">&gt;</span> env_vars<span class="op">;</span> <span class="co">///&lt; Variáveis de ambiente</span></span>
<span id="lst-windows-environment-25"><a href="#lst-windows-environment-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-26"><a href="#lst-windows-environment-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-windows-environment-27"><a href="#lst-windows-environment-27" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Imprime erro formatado da API do Windows.</span></span>
<span id="lst-windows-environment-28"><a href="#lst-windows-environment-28" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">functionName</span><span class="co"> Nome da função que falhou</span></span>
<span id="lst-windows-environment-29"><a href="#lst-windows-environment-29" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-windows-environment-30"><a href="#lst-windows-environment-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> print_error<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>wstring<span class="op">&amp;</span> functionName<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-31"><a href="#lst-windows-environment-31" aria-hidden="true" tabindex="-1"></a>        DWORD errorCode <span class="op">=</span> GetLastError<span class="op">();</span></span>
<span id="lst-windows-environment-32"><a href="#lst-windows-environment-32" aria-hidden="true" tabindex="-1"></a>        LPWSTR messageBuffer <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="lst-windows-environment-33"><a href="#lst-windows-environment-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-34"><a href="#lst-windows-environment-34" aria-hidden="true" tabindex="-1"></a>        FormatMessageW<span class="op">(</span></span>
<span id="lst-windows-environment-35"><a href="#lst-windows-environment-35" aria-hidden="true" tabindex="-1"></a>            FORMAT_MESSAGE_ALLOCATE_BUFFER <span class="op">|</span> FORMAT_MESSAGE_FROM_SYSTEM<span class="op">,</span></span>
<span id="lst-windows-environment-36"><a href="#lst-windows-environment-36" aria-hidden="true" tabindex="-1"></a>            NULL<span class="op">,</span> errorCode<span class="op">,</span> MAKELANGID<span class="op">(</span>LANG_NEUTRAL<span class="op">,</span> SUBLANG_DEFAULT<span class="op">),</span></span>
<span id="lst-windows-environment-37"><a href="#lst-windows-environment-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">(</span>LPWSTR<span class="op">)&amp;</span>messageBuffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="lst-windows-environment-38"><a href="#lst-windows-environment-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-39"><a href="#lst-windows-environment-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcerr <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">L"Falha em </span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> functionName<span class="op">,</span> messageBuffer<span class="op">);</span></span>
<span id="lst-windows-environment-40"><a href="#lst-windows-environment-40" aria-hidden="true" tabindex="-1"></a>        LocalFree<span class="op">(</span>messageBuffer<span class="op">);</span></span>
<span id="lst-windows-environment-41"><a href="#lst-windows-environment-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-windows-environment-42"><a href="#lst-windows-environment-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-43"><a href="#lst-windows-environment-43" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-windows-environment-44"><a href="#lst-windows-environment-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-windows-environment-45"><a href="#lst-windows-environment-45" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Define uma variável de ambiente.</span></span>
<span id="lst-windows-environment-46"><a href="#lst-windows-environment-46" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">name</span><span class="co"> Nome da variável</span></span>
<span id="lst-windows-environment-47"><a href="#lst-windows-environment-47" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">value</span><span class="co"> Valor da variável</span></span>
<span id="lst-windows-environment-48"><a href="#lst-windows-environment-48" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-windows-environment-49"><a href="#lst-windows-environment-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> set_variable<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>wstring<span class="op">&amp;</span> name<span class="op">,</span> <span class="at">const</span> <span class="bu">std::</span>wstring<span class="op">&amp;</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-50"><a href="#lst-windows-environment-50" aria-hidden="true" tabindex="-1"></a>        env_vars<span class="op">[</span>name<span class="op">]</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="lst-windows-environment-51"><a href="#lst-windows-environment-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-windows-environment-52"><a href="#lst-windows-environment-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-53"><a href="#lst-windows-environment-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-windows-environment-54"><a href="#lst-windows-environment-54" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Remove uma variável de ambiente.</span></span>
<span id="lst-windows-environment-55"><a href="#lst-windows-environment-55" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">name</span><span class="co"> Nome da variável</span></span>
<span id="lst-windows-environment-56"><a href="#lst-windows-environment-56" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-windows-environment-57"><a href="#lst-windows-environment-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> remove_variable<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>wstring<span class="op">&amp;</span> name<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-58"><a href="#lst-windows-environment-58" aria-hidden="true" tabindex="-1"></a>        env_vars<span class="op">.</span>erase<span class="op">(</span>name<span class="op">);</span></span>
<span id="lst-windows-environment-59"><a href="#lst-windows-environment-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-windows-environment-60"><a href="#lst-windows-environment-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-61"><a href="#lst-windows-environment-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-windows-environment-62"><a href="#lst-windows-environment-62" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Carrega ambiente atual do processo.</span></span>
<span id="lst-windows-environment-63"><a href="#lst-windows-environment-63" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-windows-environment-64"><a href="#lst-windows-environment-64" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> load_current_environment<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-windows-environment-65"><a href="#lst-windows-environment-65" aria-hidden="true" tabindex="-1"></a>        env_vars<span class="op">.</span>clear<span class="op">();</span></span>
<span id="lst-windows-environment-66"><a href="#lst-windows-environment-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-67"><a href="#lst-windows-environment-67" aria-hidden="true" tabindex="-1"></a>        LPWCH envStrings <span class="op">=</span> GetEnvironmentStringsW<span class="op">();</span></span>
<span id="lst-windows-environment-68"><a href="#lst-windows-environment-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>envStrings <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-69"><a href="#lst-windows-environment-69" aria-hidden="true" tabindex="-1"></a>            print_error<span class="op">(</span><span class="st">L"GetEnvironmentStringsW"</span><span class="op">);</span></span>
<span id="lst-windows-environment-70"><a href="#lst-windows-environment-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-windows-environment-71"><a href="#lst-windows-environment-71" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-windows-environment-72"><a href="#lst-windows-environment-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-73"><a href="#lst-windows-environment-73" aria-hidden="true" tabindex="-1"></a>        LPWCH current <span class="op">=</span> envStrings<span class="op">;</span></span>
<span id="lst-windows-environment-74"><a href="#lst-windows-environment-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(*</span>current <span class="op">!=</span> <span class="ch">L'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-75"><a href="#lst-windows-environment-75" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>wstring envVar<span class="op">(</span>current<span class="op">);</span></span>
<span id="lst-windows-environment-76"><a href="#lst-windows-environment-76" aria-hidden="true" tabindex="-1"></a>            <span class="dt">size_t</span> equalPos <span class="op">=</span> envVar<span class="op">.</span>find<span class="op">(</span><span class="ch">L'='</span><span class="op">);</span></span>
<span id="lst-windows-environment-77"><a href="#lst-windows-environment-77" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-windows-environment-78"><a href="#lst-windows-environment-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>equalPos <span class="op">!=</span> <span class="bu">std::</span>wstring::npos <span class="op">&amp;&amp;</span> equalPos <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-79"><a href="#lst-windows-environment-79" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>wstring name <span class="op">=</span> envVar<span class="op">.</span>substr<span class="op">(</span><span class="dv">0</span><span class="op">,</span> equalPos<span class="op">);</span></span>
<span id="lst-windows-environment-80"><a href="#lst-windows-environment-80" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>wstring value <span class="op">=</span> envVar<span class="op">.</span>substr<span class="op">(</span>equalPos <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="lst-windows-environment-81"><a href="#lst-windows-environment-81" aria-hidden="true" tabindex="-1"></a>                env_vars<span class="op">[</span>name<span class="op">]</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="lst-windows-environment-82"><a href="#lst-windows-environment-82" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-windows-environment-83"><a href="#lst-windows-environment-83" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-windows-environment-84"><a href="#lst-windows-environment-84" aria-hidden="true" tabindex="-1"></a>            current <span class="op">+=</span> envVar<span class="op">.</span>length<span class="op">()</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="lst-windows-environment-85"><a href="#lst-windows-environment-85" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-windows-environment-86"><a href="#lst-windows-environment-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-87"><a href="#lst-windows-environment-87" aria-hidden="true" tabindex="-1"></a>        FreeEnvironmentStringsW<span class="op">(</span>envStrings<span class="op">);</span></span>
<span id="lst-windows-environment-88"><a href="#lst-windows-environment-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-windows-environment-89"><a href="#lst-windows-environment-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-90"><a href="#lst-windows-environment-90" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-windows-environment-91"><a href="#lst-windows-environment-91" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Cria bloco de ambiente para CreateProcess.</span></span>
<span id="lst-windows-environment-92"><a href="#lst-windows-environment-92" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@return</span><span class="co"> Ponteiro para bloco de ambiente (deve ser liberado com delete[])</span></span>
<span id="lst-windows-environment-93"><a href="#lst-windows-environment-93" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-windows-environment-94"><a href="#lst-windows-environment-94" aria-hidden="true" tabindex="-1"></a>    LPWCH create_environment_block<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="lst-windows-environment-95"><a href="#lst-windows-environment-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>env_vars<span class="op">.</span>empty<span class="op">())</span> <span class="op">{</span></span>
<span id="lst-windows-environment-96"><a href="#lst-windows-environment-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="lst-windows-environment-97"><a href="#lst-windows-environment-97" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-windows-environment-98"><a href="#lst-windows-environment-98" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-99"><a href="#lst-windows-environment-99" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Calcula tamanho necessário</span></span>
<span id="lst-windows-environment-100"><a href="#lst-windows-environment-100" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> totalSize <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-windows-environment-101"><a href="#lst-windows-environment-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> <span class="op">[</span>name<span class="op">,</span> value<span class="op">]</span> <span class="op">:</span> env_vars<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-102"><a href="#lst-windows-environment-102" aria-hidden="true" tabindex="-1"></a>            totalSize <span class="op">+=</span> name<span class="op">.</span>length<span class="op">()</span> <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> value<span class="op">.</span>length<span class="op">()</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// "NAME=value\0"</span></span>
<span id="lst-windows-environment-103"><a href="#lst-windows-environment-103" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-windows-environment-104"><a href="#lst-windows-environment-104" aria-hidden="true" tabindex="-1"></a>        totalSize <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// Terminador final</span></span>
<span id="lst-windows-environment-105"><a href="#lst-windows-environment-105" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-106"><a href="#lst-windows-environment-106" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Aloca e constrói o bloco</span></span>
<span id="lst-windows-environment-107"><a href="#lst-windows-environment-107" aria-hidden="true" tabindex="-1"></a>        LPWCH envBlock <span class="op">=</span> <span class="kw">new</span> WCHAR<span class="op">[</span>totalSize<span class="op">];</span></span>
<span id="lst-windows-environment-108"><a href="#lst-windows-environment-108" aria-hidden="true" tabindex="-1"></a>        LPWCH current <span class="op">=</span> envBlock<span class="op">;</span></span>
<span id="lst-windows-environment-109"><a href="#lst-windows-environment-109" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-110"><a href="#lst-windows-environment-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> <span class="op">[</span>name<span class="op">,</span> value<span class="op">]</span> <span class="op">:</span> env_vars<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-111"><a href="#lst-windows-environment-111" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>wstring envString <span class="op">=</span> name <span class="op">+</span> <span class="st">L"="</span> <span class="op">+</span> value<span class="op">;</span></span>
<span id="lst-windows-environment-112"><a href="#lst-windows-environment-112" aria-hidden="true" tabindex="-1"></a>            wcscpy_s<span class="op">(</span>current<span class="op">,</span> envString<span class="op">.</span>length<span class="op">()</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> envString<span class="op">.</span>c_str<span class="op">());</span></span>
<span id="lst-windows-environment-113"><a href="#lst-windows-environment-113" aria-hidden="true" tabindex="-1"></a>            current <span class="op">+=</span> envString<span class="op">.</span>length<span class="op">()</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="lst-windows-environment-114"><a href="#lst-windows-environment-114" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-windows-environment-115"><a href="#lst-windows-environment-115" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>current <span class="op">=</span> <span class="ch">L'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span> <span class="co">// Terminador final</span></span>
<span id="lst-windows-environment-116"><a href="#lst-windows-environment-116" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-117"><a href="#lst-windows-environment-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> envBlock<span class="op">;</span></span>
<span id="lst-windows-environment-118"><a href="#lst-windows-environment-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-windows-environment-119"><a href="#lst-windows-environment-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-120"><a href="#lst-windows-environment-120" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-windows-environment-121"><a href="#lst-windows-environment-121" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Imprime todas as variáveis de ambiente.</span></span>
<span id="lst-windows-environment-122"><a href="#lst-windows-environment-122" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-windows-environment-123"><a href="#lst-windows-environment-123" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> print_environment<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="lst-windows-environment-124"><a href="#lst-windows-environment-124" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Variáveis de ambiente definidas:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-125"><a href="#lst-windows-environment-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> <span class="op">[</span>name<span class="op">,</span> value<span class="op">]</span> <span class="op">:</span> env_vars<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-126"><a href="#lst-windows-environment-126" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">L"  </span><span class="sc">{}</span><span class="st">=</span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">,</span> value<span class="op">);</span></span>
<span id="lst-windows-environment-127"><a href="#lst-windows-environment-127" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-windows-environment-128"><a href="#lst-windows-environment-128" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">L"Total: </span><span class="sc">{}</span><span class="st"> variáveis</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> env_vars<span class="op">.</span>size<span class="op">());</span></span>
<span id="lst-windows-environment-129"><a href="#lst-windows-environment-129" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-windows-environment-130"><a href="#lst-windows-environment-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-131"><a href="#lst-windows-environment-131" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="lst-windows-environment-132"><a href="#lst-windows-environment-132" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@brief</span><span class="co"> Executa processo com ambiente customizado.</span></span>
<span id="lst-windows-environment-133"><a href="#lst-windows-environment-133" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">commandLine</span><span class="co"> Linha de comando do processo</span></span>
<span id="lst-windows-environment-134"><a href="#lst-windows-environment-134" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">useCustomEnv</span><span class="co"> true para usar ambiente customizado</span></span>
<span id="lst-windows-environment-135"><a href="#lst-windows-environment-135" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@return</span><span class="co"> true se processo foi criado com sucesso</span></span>
<span id="lst-windows-environment-136"><a href="#lst-windows-environment-136" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="lst-windows-environment-137"><a href="#lst-windows-environment-137" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> execute_with_environment<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>wstring<span class="op">&amp;</span> commandLine<span class="op">,</span> <span class="dt">bool</span> useCustomEnv<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-138"><a href="#lst-windows-environment-138" aria-hidden="true" tabindex="-1"></a>        STARTUPINFOW si<span class="op">;</span></span>
<span id="lst-windows-environment-139"><a href="#lst-windows-environment-139" aria-hidden="true" tabindex="-1"></a>        PROCESS_INFORMATION pi<span class="op">;</span></span>
<span id="lst-windows-environment-140"><a href="#lst-windows-environment-140" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-141"><a href="#lst-windows-environment-141" aria-hidden="true" tabindex="-1"></a>        ZeroMemory<span class="op">(&amp;</span>si<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>si<span class="op">));</span></span>
<span id="lst-windows-environment-142"><a href="#lst-windows-environment-142" aria-hidden="true" tabindex="-1"></a>        si<span class="op">.</span>cb <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span>si<span class="op">);</span></span>
<span id="lst-windows-environment-143"><a href="#lst-windows-environment-143" aria-hidden="true" tabindex="-1"></a>        ZeroMemory<span class="op">(&amp;</span>pi<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>pi<span class="op">));</span></span>
<span id="lst-windows-environment-144"><a href="#lst-windows-environment-144" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-145"><a href="#lst-windows-environment-145" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Cria bloco de ambiente se necessário</span></span>
<span id="lst-windows-environment-146"><a href="#lst-windows-environment-146" aria-hidden="true" tabindex="-1"></a>        LPWCH envBlock <span class="op">=</span> useCustomEnv <span class="op">?</span> create_environment_block<span class="op">()</span> <span class="op">:</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="lst-windows-environment-147"><a href="#lst-windows-environment-147" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-148"><a href="#lst-windows-environment-148" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wstring mutableCmdLine <span class="op">=</span> commandLine<span class="op">;</span></span>
<span id="lst-windows-environment-149"><a href="#lst-windows-environment-149" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-150"><a href="#lst-windows-environment-150" aria-hidden="true" tabindex="-1"></a>        BOOL success <span class="op">=</span> CreateProcessW<span class="op">(</span></span>
<span id="lst-windows-environment-151"><a href="#lst-windows-environment-151" aria-hidden="true" tabindex="-1"></a>            NULL<span class="op">,</span>                    <span class="co">// lpApplicationName</span></span>
<span id="lst-windows-environment-152"><a href="#lst-windows-environment-152" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span>mutableCmdLine<span class="op">[</span><span class="dv">0</span><span class="op">],</span>      <span class="co">// lpCommandLine</span></span>
<span id="lst-windows-environment-153"><a href="#lst-windows-environment-153" aria-hidden="true" tabindex="-1"></a>            NULL<span class="op">,</span>                    <span class="co">// lpProcessAttributes</span></span>
<span id="lst-windows-environment-154"><a href="#lst-windows-environment-154" aria-hidden="true" tabindex="-1"></a>            NULL<span class="op">,</span>                    <span class="co">// lpThreadAttributes</span></span>
<span id="lst-windows-environment-155"><a href="#lst-windows-environment-155" aria-hidden="true" tabindex="-1"></a>            FALSE<span class="op">,</span>                   <span class="co">// bInheritHandles</span></span>
<span id="lst-windows-environment-156"><a href="#lst-windows-environment-156" aria-hidden="true" tabindex="-1"></a>            useCustomEnv <span class="op">?</span> CREATE_UNICODE_ENVIRONMENT <span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// dwCreationFlags</span></span>
<span id="lst-windows-environment-157"><a href="#lst-windows-environment-157" aria-hidden="true" tabindex="-1"></a>            envBlock<span class="op">,</span>                <span class="co">// lpEnvironment</span></span>
<span id="lst-windows-environment-158"><a href="#lst-windows-environment-158" aria-hidden="true" tabindex="-1"></a>            NULL<span class="op">,</span>                    <span class="co">// lpCurrentDirectory</span></span>
<span id="lst-windows-environment-159"><a href="#lst-windows-environment-159" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span>si<span class="op">,</span>                     <span class="co">// lpStartupInfo</span></span>
<span id="lst-windows-environment-160"><a href="#lst-windows-environment-160" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span>pi                      <span class="co">// lpProcessInformation</span></span>
<span id="lst-windows-environment-161"><a href="#lst-windows-environment-161" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="lst-windows-environment-162"><a href="#lst-windows-environment-162" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-163"><a href="#lst-windows-environment-163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>success<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-windows-environment-164"><a href="#lst-windows-environment-164" aria-hidden="true" tabindex="-1"></a>            print_error<span class="op">(</span><span class="st">L"CreateProcessW"</span><span class="op">);</span></span>
<span id="lst-windows-environment-165"><a href="#lst-windows-environment-165" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>envBlock<span class="op">)</span> <span class="kw">delete</span><span class="op">[]</span> envBlock<span class="op">;</span></span>
<span id="lst-windows-environment-166"><a href="#lst-windows-environment-166" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="lst-windows-environment-167"><a href="#lst-windows-environment-167" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-windows-environment-168"><a href="#lst-windows-environment-168" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-169"><a href="#lst-windows-environment-169" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">L"Processo criado com PID: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> pi<span class="op">.</span>dwProcessId<span class="op">);</span></span>
<span id="lst-windows-environment-170"><a href="#lst-windows-environment-170" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Aguardando conclusão...</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-171"><a href="#lst-windows-environment-171" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-172"><a href="#lst-windows-environment-172" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Espera o processo terminar</span></span>
<span id="lst-windows-environment-173"><a href="#lst-windows-environment-173" aria-hidden="true" tabindex="-1"></a>        WaitForSingleObject<span class="op">(</span>pi<span class="op">.</span>hProcess<span class="op">,</span> INFINITE<span class="op">);</span></span>
<span id="lst-windows-environment-174"><a href="#lst-windows-environment-174" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-175"><a href="#lst-windows-environment-175" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Obtém código de saída</span></span>
<span id="lst-windows-environment-176"><a href="#lst-windows-environment-176" aria-hidden="true" tabindex="-1"></a>        DWORD exitCode<span class="op">;</span></span>
<span id="lst-windows-environment-177"><a href="#lst-windows-environment-177" aria-hidden="true" tabindex="-1"></a>        GetExitCodeProcess<span class="op">(</span>pi<span class="op">.</span>hProcess<span class="op">,</span> <span class="op">&amp;</span>exitCode<span class="op">);</span></span>
<span id="lst-windows-environment-178"><a href="#lst-windows-environment-178" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="bu">std::</span>format<span class="op">(</span><span class="st">L"Processo terminou com código: </span><span class="sc">{}\n</span><span class="st">"</span><span class="op">,</span> exitCode<span class="op">);</span></span>
<span id="lst-windows-environment-179"><a href="#lst-windows-environment-179" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-180"><a href="#lst-windows-environment-180" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Limpa recursos</span></span>
<span id="lst-windows-environment-181"><a href="#lst-windows-environment-181" aria-hidden="true" tabindex="-1"></a>        CloseHandle<span class="op">(</span>pi<span class="op">.</span>hProcess<span class="op">);</span></span>
<span id="lst-windows-environment-182"><a href="#lst-windows-environment-182" aria-hidden="true" tabindex="-1"></a>        CloseHandle<span class="op">(</span>pi<span class="op">.</span>hThread<span class="op">);</span></span>
<span id="lst-windows-environment-183"><a href="#lst-windows-environment-183" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>envBlock<span class="op">)</span> <span class="kw">delete</span><span class="op">[]</span> envBlock<span class="op">;</span></span>
<span id="lst-windows-environment-184"><a href="#lst-windows-environment-184" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-windows-environment-185"><a href="#lst-windows-environment-185" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="lst-windows-environment-186"><a href="#lst-windows-environment-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-windows-environment-187"><a href="#lst-windows-environment-187" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-windows-environment-188"><a href="#lst-windows-environment-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-windows-environment-189"><a href="#lst-windows-environment-189" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-windows-environment-190"><a href="#lst-windows-environment-190" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstra herança de ambiente padrão.</span></span>
<span id="lst-windows-environment-191"><a href="#lst-windows-environment-191" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-windows-environment-192"><a href="#lst-windows-environment-192" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_inherited_environment<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-windows-environment-193"><a href="#lst-windows-environment-193" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"=== Demonstração: Ambiente Herdado ===</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-194"><a href="#lst-windows-environment-194" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-195"><a href="#lst-windows-environment-195" aria-hidden="true" tabindex="-1"></a>    WindowsEnvironmentManager manager<span class="op">;</span></span>
<span id="lst-windows-environment-196"><a href="#lst-windows-environment-196" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Executando 'cmd /c set' com ambiente herdado:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-197"><a href="#lst-windows-environment-197" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-198"><a href="#lst-windows-environment-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>manager<span class="op">.</span>execute_with_environment<span class="op">(</span><span class="st">L"cmd /c set"</span><span class="op">,</span> <span class="kw">false</span><span class="op">))</span> <span class="op">{</span></span>
<span id="lst-windows-environment-199"><a href="#lst-windows-environment-199" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcerr <span class="op">&lt;&lt;</span> <span class="st">L"Falha ao executar comando.</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-200"><a href="#lst-windows-environment-200" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-windows-environment-201"><a href="#lst-windows-environment-201" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-202"><a href="#lst-windows-environment-202" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Demonstração de ambiente herdado concluída.</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-203"><a href="#lst-windows-environment-203" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-windows-environment-204"><a href="#lst-windows-environment-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-windows-environment-205"><a href="#lst-windows-environment-205" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-windows-environment-206"><a href="#lst-windows-environment-206" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstra ambiente completamente customizado.</span></span>
<span id="lst-windows-environment-207"><a href="#lst-windows-environment-207" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-windows-environment-208"><a href="#lst-windows-environment-208" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_custom_environment<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-windows-environment-209"><a href="#lst-windows-environment-209" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"=== Demonstração: Ambiente Customizado ===</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-210"><a href="#lst-windows-environment-210" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-211"><a href="#lst-windows-environment-211" aria-hidden="true" tabindex="-1"></a>    WindowsEnvironmentManager manager<span class="op">;</span></span>
<span id="lst-windows-environment-212"><a href="#lst-windows-environment-212" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-213"><a href="#lst-windows-environment-213" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define ambiente minimalista</span></span>
<span id="lst-windows-environment-214"><a href="#lst-windows-environment-214" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">L"PATH"</span><span class="op">,</span> <span class="st">L"C:</span><span class="sc">\\</span><span class="st">Windows</span><span class="sc">\\</span><span class="st">System32;C:</span><span class="sc">\\</span><span class="st">Windows"</span><span class="op">);</span></span>
<span id="lst-windows-environment-215"><a href="#lst-windows-environment-215" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">L"TEMP"</span><span class="op">,</span> <span class="st">L"C:</span><span class="sc">\\</span><span class="st">Temp"</span><span class="op">);</span></span>
<span id="lst-windows-environment-216"><a href="#lst-windows-environment-216" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">L"TMP"</span><span class="op">,</span> <span class="st">L"C:</span><span class="sc">\\</span><span class="st">Temp"</span><span class="op">);</span></span>
<span id="lst-windows-environment-217"><a href="#lst-windows-environment-217" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">L"USERNAME"</span><span class="op">,</span> <span class="st">L"ProcessoCustomizado"</span><span class="op">);</span></span>
<span id="lst-windows-environment-218"><a href="#lst-windows-environment-218" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">L"COMPUTERNAME"</span><span class="op">,</span> <span class="st">L"AMBIENTE-TESTE"</span><span class="op">);</span></span>
<span id="lst-windows-environment-219"><a href="#lst-windows-environment-219" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">L"CUSTOM_VAR"</span><span class="op">,</span> <span class="st">L"Valor Personalizado Windows!"</span><span class="op">);</span></span>
<span id="lst-windows-environment-220"><a href="#lst-windows-environment-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-221"><a href="#lst-windows-environment-221" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Ambiente customizado criado:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-222"><a href="#lst-windows-environment-222" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>print_environment<span class="op">();</span></span>
<span id="lst-windows-environment-223"><a href="#lst-windows-environment-223" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-224"><a href="#lst-windows-environment-224" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-225"><a href="#lst-windows-environment-225" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Executando 'cmd /c set' com ambiente customizado:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-226"><a href="#lst-windows-environment-226" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>manager<span class="op">.</span>execute_with_environment<span class="op">(</span><span class="st">L"cmd /c set"</span><span class="op">,</span> <span class="kw">true</span><span class="op">))</span> <span class="op">{</span></span>
<span id="lst-windows-environment-227"><a href="#lst-windows-environment-227" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcerr <span class="op">&lt;&lt;</span> <span class="st">L"Falha ao executar comando.</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-228"><a href="#lst-windows-environment-228" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-windows-environment-229"><a href="#lst-windows-environment-229" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-230"><a href="#lst-windows-environment-230" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Demonstração de ambiente customizado concluída.</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-231"><a href="#lst-windows-environment-231" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-windows-environment-232"><a href="#lst-windows-environment-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-windows-environment-233"><a href="#lst-windows-environment-233" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-windows-environment-234"><a href="#lst-windows-environment-234" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Demonstra modificação seletiva do ambiente.</span></span>
<span id="lst-windows-environment-235"><a href="#lst-windows-environment-235" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-windows-environment-236"><a href="#lst-windows-environment-236" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_selective_environment<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-windows-environment-237"><a href="#lst-windows-environment-237" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"=== Demonstração: Modificação Seletiva ===</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-238"><a href="#lst-windows-environment-238" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-239"><a href="#lst-windows-environment-239" aria-hidden="true" tabindex="-1"></a>    WindowsEnvironmentManager manager<span class="op">;</span></span>
<span id="lst-windows-environment-240"><a href="#lst-windows-environment-240" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-241"><a href="#lst-windows-environment-241" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Carrega ambiente atual</span></span>
<span id="lst-windows-environment-242"><a href="#lst-windows-environment-242" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>load_current_environment<span class="op">();</span></span>
<span id="lst-windows-environment-243"><a href="#lst-windows-environment-243" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-244"><a href="#lst-windows-environment-244" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Faz modificações seletivas</span></span>
<span id="lst-windows-environment-245"><a href="#lst-windows-environment-245" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">L"PATH"</span><span class="op">,</span> <span class="st">L"C:</span><span class="sc">\\</span><span class="st">CustomTools;C:</span><span class="sc">\\</span><span class="st">Windows</span><span class="sc">\\</span><span class="st">System32;C:</span><span class="sc">\\</span><span class="st">Windows"</span><span class="op">);</span></span>
<span id="lst-windows-environment-246"><a href="#lst-windows-environment-246" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">L"EDITOR"</span><span class="op">,</span> <span class="st">L"notepad.exe"</span><span class="op">);</span></span>
<span id="lst-windows-environment-247"><a href="#lst-windows-environment-247" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>set_variable<span class="op">(</span><span class="st">L"CUSTOM_MSG"</span><span class="op">,</span> <span class="st">L"Ambiente modificado seletivamente"</span><span class="op">);</span></span>
<span id="lst-windows-environment-248"><a href="#lst-windows-environment-248" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span>remove_variable<span class="op">(</span><span class="st">L"OneDrive"</span><span class="op">);</span> <span class="co">// Remove se existir</span></span>
<span id="lst-windows-environment-249"><a href="#lst-windows-environment-249" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-250"><a href="#lst-windows-environment-250" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Executando comando que usa variáveis específicas:</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-251"><a href="#lst-windows-environment-251" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-252"><a href="#lst-windows-environment-252" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wstring command <span class="op">=</span> <span class="st">L"cmd /c </span><span class="sc">\"</span><span class="st">echo PATH: %PATH% &amp; echo EDITOR: </span><span class="sc">%E</span><span class="st">DITOR% &amp; echo MSG: %CUSTOM_MSG%</span><span class="sc">\"</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-253"><a href="#lst-windows-environment-253" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-254"><a href="#lst-windows-environment-254" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>manager<span class="op">.</span>execute_with_environment<span class="op">(</span>command<span class="op">,</span> <span class="kw">true</span><span class="op">))</span> <span class="op">{</span></span>
<span id="lst-windows-environment-255"><a href="#lst-windows-environment-255" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcerr <span class="op">&lt;&lt;</span> <span class="st">L"Falha ao executar comando.</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-256"><a href="#lst-windows-environment-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-windows-environment-257"><a href="#lst-windows-environment-257" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-258"><a href="#lst-windows-environment-258" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Demonstração de modificação seletiva concluída.</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-259"><a href="#lst-windows-environment-259" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-windows-environment-260"><a href="#lst-windows-environment-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-windows-environment-261"><a href="#lst-windows-environment-261" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="lst-windows-environment-262"><a href="#lst-windows-environment-262" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Função principal.</span></span>
<span id="lst-windows-environment-263"><a href="#lst-windows-environment-263" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="lst-windows-environment-264"><a href="#lst-windows-environment-264" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-windows-environment-265"><a href="#lst-windows-environment-265" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Configura locale para Unicode</span></span>
<span id="lst-windows-environment-266"><a href="#lst-windows-environment-266" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout<span class="op">.</span>imbue<span class="op">(</span><span class="bu">std::</span>locale<span class="op">(</span><span class="st">""</span><span class="op">));</span></span>
<span id="lst-windows-environment-267"><a href="#lst-windows-environment-267" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcerr<span class="op">.</span>imbue<span class="op">(</span><span class="bu">std::</span>locale<span class="op">(</span><span class="st">""</span><span class="op">));</span></span>
<span id="lst-windows-environment-268"><a href="#lst-windows-environment-268" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-269"><a href="#lst-windows-environment-269" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"=== Demonstração de Variáveis de Ambiente - **Windows** ===</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-270"><a href="#lst-windows-environment-270" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-271"><a href="#lst-windows-environment-271" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Demonstra diferentes cenários</span></span>
<span id="lst-windows-environment-272"><a href="#lst-windows-environment-272" aria-hidden="true" tabindex="-1"></a>    demonstrate_inherited_environment<span class="op">();</span></span>
<span id="lst-windows-environment-273"><a href="#lst-windows-environment-273" aria-hidden="true" tabindex="-1"></a>    demonstrate_custom_environment<span class="op">();</span></span>
<span id="lst-windows-environment-274"><a href="#lst-windows-environment-274" aria-hidden="true" tabindex="-1"></a>    demonstrate_selective_environment<span class="op">();</span></span>
<span id="lst-windows-environment-275"><a href="#lst-windows-environment-275" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-windows-environment-276"><a href="#lst-windows-environment-276" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wcout <span class="op">&lt;&lt;</span> <span class="st">L"Todas as demonstrações concluídas.</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-windows-environment-277"><a href="#lst-windows-environment-277" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-windows-environment-278"><a href="#lst-windows-environment-278" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<p>A implementação <strong>Windows</strong> demonstra três padrões fundamentais: herança completa do ambiente (passando <code>nullptr</code> para <code>lpEnvironment</code>), criação de ambiente completamente customizado (construindo um bloco de ambiente próprio), e modificação seletiva (carregando o ambiente atual e fazendo alterações específicas). A flag <code>CREATE_UNICODE_ENVIRONMENT</code> deve ser usada quando o bloco de ambiente contém strings Unicode, garantindo interpretação correta das variáveis pelo processo filho.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/frankalcantara\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./gerproc.html" class="pagination-link" aria-label="Gerenciamento de Processos: Introdução">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Gerenciamento de Processos: Introdução</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./gerproc2.html" class="pagination-link" aria-label="Processos de Sistema: **Linux** vs. Windows">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Processos de Sistema: <strong>Linux</strong> vs.&nbsp;Windows</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright © 2025 Frank de Alcantara</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/frankalcantara/linefollower/edit/main/gerproc1.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/frankalcantara/linefollower/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>